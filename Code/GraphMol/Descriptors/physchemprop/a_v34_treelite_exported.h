#pragma once
// Auto-generated Treelite model for A (v3.4 XGBoost)
// Trees: 300, Features: 529
// Target normalization: mean=0.2294552415, scale=0.3842960135
// Library: a_v34_treelite.so

#include <vector>
#include <cmath>
#include <algorithm>
#include <dlfcn.h>  // For loading shared library
#include <limits>

namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadeA {

constexpr int N_TREES = 300;
constexpr int N_FEATURES = 529;
constexpr double TARGET_MEAN = 0.2294552415;
constexpr double TARGET_SCALE = 0.3842960135;

// Normalization stats
constexpr int N_NORM_FEATURES = 529;
static const double COL_MEANS[N_NORM_FEATURES] = {
    0.0293030262,    0.0030124606,    0.0168423935,    0.0105436122,    0.0095851020,    0.2567438039,    0.1128303437,    0.0686019444,    0.0125975626,    0.0616185129,
    0.0442283993,    0.0102697522,    0.0031493907,    0.0210872244,    0.1293988772,    0.0183486239,    0.0031493907,    0.0614815829,    0.0120498425,    0.0042448309,
    0.0082158017,    0.0119129125,    0.0093112420,    0.0286183760,    1.5159523483,    2.6176913597,    0.0334109270,    0.1545940025,    0.6286457620,    0.3818978502,
    0.0243735451,    0.6754758318,    0.3524578940,    0.0080788717,    0.0046556210,    0.0983157606,    2.0844858277,    0.0182116938,    0.4218814186,    0.0160208134,
    0.0028755306,    0.1155689443,    0.9011365192,    0.2845405998,    0.6877995344,    0.7213473915,    8.3238892235,    0.5395333629,    -0.2593218891,    0.5401693411,
    14.7040882217,    208.7878397386,    208.4201970098,    76.4433794331,    0.1739216763,    -0.3245795033,    0.1717443300,    1.1366601869,    1.7011320437,    2.1386533602,
    10.1891769065,    -2.0464025387,    2.1254640075,    2.7425627026,    11.5101531844,    5.6927294942,    26.0721519369,    8.1185509033,    12.9340101586,    2.3421437391,
    2.2530382766,    33.6085485417,    5.8058196761,    9.4171215981,    13.8773925426,    6.7058504901,    7.4693210165,    7.8262420878,    5.2097240903,    -0.2456849182,
    0.7454470765,    0.6613720389,    0.3435574421,    4.1314707329,    2.6692295290,    56.2110218403,    0.1541832124,    0.0034232507,    0.1043406819,    1.2051795230,
    210.5745530061,    155.3647815966,    4206.7729258779,    52.0196524107,    10036.3359285983,    3.5753368757,    2.2909814511,    1.5956625668,    3.5377035746,    3.3804551935,
    1.6714878970,    88.9174411662,    7.7660406425,    1.1769304185,    146.3785080639,    159.6119059004,    159.9083205320,    133.1648495514,    0.4550593627,    -0.0069588794,
    -0.0088087931,    -0.0163299120,    -0.0099478973,    90.5246180371,    -15.5311797443,    -2.0402356107,    -4.4176561014,    -4.1189737323,    -1.8933919812,    8.1236719671,
    -3.3239507661,    -1.7320287220,    4.7615753692,    -48.0680867443,    -273.6127792874,    28.8279471762,    0.3400138354,    -0.1942905450,    -0.1427239532,    -0.0771431873,
    -0.1163127073,    0.5056840424,    -0.2976676811,    -0.4423070008,    -0.2555462870,    -0.1590801486,    -1.4267709944,    -2.7194559614,    -1.7870757715,    0.4610913755,
    -0.0086270971,    0.0003472391,    -0.0001125939,    -0.0000979986,    -0.0001048193,    0.0002941289,    0.0010269904,    -0.0616030418,    -0.0768077134,    0.0530721939,
    -0.1966305988,    -0.1185096490,    -0.1124210169,    -1.4833792596,    -1.7248220210,    4.2011695711,    -0.0048836917,    -0.0053158599,    -0.0090257888,    -0.0112546278,
    0.2877157792,    -0.0007279777,    -0.1242299233,    -0.1652166692,    0.1059118576,    -0.0125808381,    -0.1224967479,    0.0213789520,    0.0366212768,    -0.0247310221,
    -0.0201870815,    -0.0800579342,    -0.0273546032,    -0.0276159131,    -0.0835546612,    -0.0282542296,    -0.1121003343,    0.0719308315,    -0.0716910588,    -0.0418327650,
    0.0425620702,    0.0717788222,    0.0831697002,    0.9885013472,    1.0397268936,    0.9464520272,    0.7155270982,    0.5265365652,    1.1827220567,    0.6567032013,
    0.9480830934,    0.7154562796,    0.9804757780,    0.8479016019,    0.9124879210,    1.0632562117,    0.8333084742,    0.8541085880,    0.8395619966,    1.0553077497,
    1.1057216431,    0.8239995631,    1.0925898370,    0.9101037127,    0.5153724246,    1.2887634349,    0.8526401105,    0.4627652092,    1.1234649621,    1.0055179055,
    2.4749810839,    2.2157987292,    13.8672286251,    0.9819718129,    3.5666066922,    0.2884587332,    1.4540012325,    64.1684752451,    3.9706162256,    4.0580404820,
    87.9520331481,    44.3832817242,    66.1998927942,    88.7218073802,    5.1949013250,    44.3875853000,    0.9933398094,    3.5666309121,    0.2884545834,    1.4539997735,
    64.1595754091,    3.9701179832,    4.0579531808,    107.1293533854,    53.0720990266,    79.0509464448,    106.4827004120,    6.2498735785,    53.0731534911,    -0.9550074197,
    3.5622593139,    0.2881973756,    1.4528721101,    91.2646222972,    5.3705587308,    45.6735344376,    0.7042493498,    28.5548404765,    3.8807339450,    2.2132232089,
    4.4521493772,    0.4820480939,    0.2178549924,    0.1409209682,    0.0874686290,    0.0571503454,    0.0351877372,    8.8452121520,    5.1784291891,    4.0398971167,
    2.7485122372,    1.8790394829,    1.2148901018,    0.7431593476,    0.4177250990,    0.6507715541,    0.3828036325,    0.2365596690,    0.1417557812,    0.0846271648,
    0.0480986517,    0.0298740328,    0.0166195860,    18.4262403578,    17.3829833607,    17.1928129771,    28.3477589401,    27.2500374544,    27.5785737368,    18.7360097798,
    31.9840690250,    0.7056082792,    0.6748333600,    0.6223139384,    1.0111158541,    0.9746084279,    0.9855136060,    0.6750786398,    1.1332778534,    198.7418795879,
    98.7813682197,    134.4984961293,    198.7418795879,    11.1589727484,    98.7819103129,    0.0000000000,    3.5881790563,    0.2900963326,    1.4598374561,    62.4946404289,
    3.8730834110,    4.0350653324,    1121.1996439819,    110.2670573969,    55.1196878032,    81.4330655462,    110.2670573969,    6.5364581777,    55.1202864922,    3.5695250279,
    0.2888042960,    1.4549842549,    64.2735421856,    3.9748926552,    4.0584735183,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0002738601,
    0.0000000000,    1.5158154183,    0.0618923730,    2.6127618787,    0.0072572915,    0.2876899904,    2.7277831028,    0.6285088320,    0.0047925510,    0.0377926879,
    0.6369984938,    1.5740106805,    0.2954950021,    0.3085033548,    0.0000000000,    0.0907846091,    0.0000000000,    0.0031493907,    0.1396686293,    0.0388881282,
    0.0206764343,    0.0000000000,    0.0420375188,    0.1545940025,    0.1224154457,    0.0549089415,    0.0446391894,    0.0001369300,    0.3817609202,    0.6754758318,
    0.4425578529,    0.0243735451,    0.3154867863,    0.0000000000,    0.0000000000,    0.0023278105,    0.0227303848,    0.0000000000,    0.0000000000,    0.0013693003,
    0.0164316035,    0.0000000000,    0.0068465014,    0.0089004519,    0.0436806792,    0.0214980145,    0.0049294810,    0.0247843352,    0.3524578940,    0.0000000000,
    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,
    0.0002738601,    0.0000000000,    0.0000000000,    0.0000000000,    0.0547720115,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0167054635,
    0.0000000000,    4.9927442981,    -0.0707868220,    0.3754047321,    0.1118364172,    0.1558529182,    0.0606798691,    0.2060129187,    0.1775470176,    1.0715358215,
    0.6358345622,    1.3111407500,    0.4326768746,    0.7944833516,    0.1046964441,    0.1511670361,    0.1987748802,    0.8202728872,    0.6932113725,    1.4264945979,
    -0.0310427155,    0.2813803651,    0.3002820922,    2.3255299820,    -0.0868363206,    0.1959313933,    0.8156670291,    0.5667257745,    0.2843670843,    0.0185896186,
    0.8505336980,    0.0273749844,    -2.9886463303,    1.3818330410,    0.3088597367,    0.4992725185,    0.6838230882,    0.4791609886,    0.6574126778,    2.3684300331,
    0.8676155404,    15.3447441045,    25.0312971351,    29.5457446738,    30.5032849610,    25.2362350903,    0.3738353058,    1.9844845839,    0.2185757200,    0.0251269735,
    0.0853664825,    1.4264761178,    0.0993971680,    32.1901958099,    32.0758592359,    32.8360947556,    33.9908256881,    34.5537450363,    33.5041763659,    297.0510749007,
    3.6202215004,    0.1069423525,    0.0376557579,    0.0856821437,    0.0497257015,    0.0407458926,    0.4536386765,    4.2293577982,    0.8667675878,    0.0057158190,
    0.1149908152,    0.0499489626,    0.0206233222,    0.5734784606,    0.1427196201,    0.4783246795,    0.2228036225,    0.1617021988,    1.1244888678,    0.6086028751,
    0.0159814358,    0.1706555968,    0.1638773147,    0.1855717105,    0.0698741391,    0.0299417041,    0.0038349626,    0.0431725399,    0.0157888159,    0.0867631789,
    0.0571781079,    0.3944469655,    0.0748386293,    0.0986596019,    0.0972329034,    0.1423617015,    0.0590278646,    0.9495516622,    0.0335962276,    0.0120143324,
    0.0547558432,    0.0168355235,    2.1597609712,    0.0813078465,    0.2092486649,    0.6815100644,    2.4723211942,    3.8140273974,    2.3286220522,    0.0386142681,
    0.0062987813,    0.0609338628,    0.1432288101,    1.5963853884,    148.4268207984,    7.0286299130,    0.9987102473,    0.7000070371,    1.1347302498,    1.5162847438,
    1.1666317174,    56.2110218403,    184.6194293935,    0.3006255072,    185.0567137357,    56.1441792811,    37.1067051996,    1.3531150484,    1.7578541846,    1.3616279964,
    2.6046990287,    0.5615709661,    0.5796545456,    -2.9507175238,    10.5412423747,    1.2591086908,    2.4930538443,    6.9145983058,    2.1008457252
};

static const double COL_STDS[N_NORM_FEATURES] = {
    0.3010159329,    0.0548031542,    0.1456514617,    0.1250431348,    0.1330752778,    0.7929241168,    0.4138879947,    0.4024147341,    0.1198160443,    0.4074265511,
    0.2644468071,    0.1579643234,    0.0629368904,    0.1546896056,    0.8782301783,    0.1523656554,    0.0650762033,    0.4072791679,    0.1243576478,    0.0650139393,
    0.1268473255,    0.1238191252,    0.0960444831,    0.2360785683,    1.6159334140,    3.8217971795,    0.1929355281,    0.5066264140,    1.5929328083,    0.9207905575,
    0.1603012658,    0.9042081940,    1.1192594883,    0.0996525159,    0.0700557366,    0.3632074627,    2.0347815081,    0.1867065923,    1.1619028615,    0.1380234313,
    0.0560457134,    0.4108050114,    1.9105930181,    0.9087283959,    1.6915421752,    2.4609212425,    3.6452499329,    0.6495423661,    1.5320247799,    0.1467469961,
    10.1760531182,    109.8742398366,    109.6506479077,    40.7086722096,    0.1421357997,    0.1512450527,    0.1224322966,    0.3595299935,    0.4551064130,    0.5484523732,
    0.9188373150,    0.2814639259,    0.4612728994,    0.6757545254,    282.2336017419,    8.0162452580,    25.4874397022,    9.5680369065,    15.7589413257,    5.0848515072,
    4.2798319108,    36.9343111079,    8.6781385435,    11.8632444258,    20.9199824314,    10.1914745356,    13.3678623942,    10.5428762496,    9.7399011697,    4.3292770232,
    1.3268824449,    1.1480548745,    1.3094948335,    3.5061430024,    2.0027683830,    28.8514739041,    0.6931117535,    0.0584083220,    0.3923987471,    0.0985667472,
    271.9207363696,    164.0134520813,    3918.2850262063,    30.6956547693,    10934.1975827121,    4.3135624934,    4.1277930197,    0.7867417584,    3.3235273946,    4.4256840907,
    3.1149066288,    69.6786184834,    0.8111317482,    0.4702454230,    6.9561063686,    18.1570543041,    37.7606428047,    71.2651628823,    0.4510669275,    0.2307432627,
    0.2259682723,    0.1941182419,    0.1595449002,    61.2910432571,    38.9186774040,    4.1245790926,    6.3541590032,    6.5946894919,    5.8635495282,    21.6539361684,
    18.8477295423,    16.8449347329,    108.0540641345,    180.6947846003,    619.5397145723,    587.0965657892,    1.0823284053,    1.1267501728,    0.8836355007,    0.7692290032,
    0.6134590235,    1.5293112042,    1.7088619668,    1.6396720851,    1.4441390574,    0.7539894700,    2.8240229274,    7.7226278921,    15.7624567967,    13.4521812380,
    0.0095712768,    0.0052734011,    0.0046870024,    0.0059620330,    0.0094210448,    0.0074617836,    1.8461487653,    0.0925131041,    0.0966179391,    0.1644273469,
    0.3893911436,    0.7473528769,    1.3546105221,    7.9234722962,    13.6110579184,    18.4696280713,    0.0197025495,    0.0238222181,    0.0399306031,    0.0614249998,
    0.2334504058,    0.1588461182,    0.3634703287,    0.3839730446,    0.4308122186,    0.2018574054,    0.1932703726,    0.4313825668,    0.2551018381,    0.3627508397,
    0.3929052718,    0.2718427505,    0.3723099708,    0.1384849595,    0.1870836309,    0.4067008847,    0.1797863094,    0.3369784905,    0.2014268703,    0.1823500365,
    0.2784099222,    0.3162636226,    0.2755402265,    0.3245261558,    0.3461741335,    0.4676394768,    0.7090952878,    0.6743295299,    0.3437374386,    0.4963722331,
    0.4081560396,    0.2883627955,    0.3452732190,    0.9973369658,    0.2496779442,    0.3279968812,    0.5143456063,    0.3176858843,    0.3349756031,    0.3588142642,
    0.4277624388,    0.8709708233,    0.2960633600,    0.4356535726,    0.6322654582,    0.3463303111,    0.3560328190,    0.4947466833,    0.6536720875,    0.1455892626,
    0.0781715442,    0.6302301192,    1.4482177027,    1.0912779742,    0.8923625637,    0.0717599167,    0.7306784758,    61.9034348562,    1.2220072640,    1.2847714517,
    116.7692572381,    58.4952296809,    87.2058539546,    117.0538520311,    2.7521815066,    58.4921314559,    1.2702118396,    0.8924120814,    0.0717315527,    0.7307256587,
    61.8998325015,    1.2217130518,    1.2845563569,    138.2256939769,    68.7639097135,    102.4794567092,    137.6991577963,    3.1118643426,    68.7631279764,    1.2834647442,
    0.8915096001,    0.0722087529,    0.7300399108,    117.6786035991,    2.7068974721,    58.8208929183,    0.7984692598,    16.8015284380,    3.8800147529,    2.5468464883,
    3.2399146022,    0.0516416434,    0.0585490449,    0.0532500604,    0.0428963386,    0.0332631818,    0.0246211904,    4.5512193936,    3.0729397046,    2.9511038160,
    2.4862324343,    2.3513483776,    1.6514858907,    1.4637157851,    0.9705813207,    0.1129534731,    0.1303462811,    0.1415561206,    0.1137871033,    0.0902935471,
    0.0705347921,    0.0665014003,    0.0654241124,    9.5531217937,    9.1478643516,    9.2346692565,    15.8570943683,    15.1482494120,    15.3844635970,    10.1794556811,
    18.2449219791,    0.3060304521,    0.3446779988,    0.0940747348,    0.0529970971,    0.0694096211,    0.0720130929,    0.1011835181,    0.0371400367,    271.0753033876,
    131.8830076930,    171.9920454312,    271.0753033876,    6.8021767011,    131.8826108782,    1.0000000000,    0.9006923976,    0.0720318152,    0.7314385501,    59.9334028548,
    1.1689918516,    1.2802103020,    3293.1473546193,    132.4183803734,    66.1831031328,    97.9991925182,    132.4183803734,    2.8874439114,    66.1826256661,    0.8912761505,
    0.0722657985,    0.7298916069,    61.9325471669,    1.2285579990,    1.2877088526,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    0.0165464515,
    1.0000000000,    1.6159347600,    0.2783985834,    3.8207991539,    0.0925954833,    0.7553327986,    3.1377353464,    1.5929438609,    0.0729198366,    0.2327344075,
    1.0252650510,    1.9514070533,    0.9726030541,    0.9400736437,    1.0000000000,    0.3523769183,    1.0000000000,    0.0650762033,    0.4418132627,    0.2192176633,
    0.1551868558,    1.0000000000,    0.2293339670,    0.5066264140,    0.4154619093,    0.2791248021,    0.2497287654,    0.0117009093,    0.9206242602,    0.9042081940,
    0.9057798961,    0.1603012658,    1.6616065685,    1.0000000000,    1.0000000000,    0.0985728834,    0.3175083477,    1.0000000000,    1.0000000000,    0.0369787142,
    0.1452277070,    1.0000000000,    0.0903821174,    0.0981978309,    0.2485245695,    0.1459784571,    0.0700369992,    0.1648712606,    1.1192594883,    1.0000000000,
    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,
    0.0165464515,    1.0000000000,    1.0000000000,    1.0000000000,    0.3367351351,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    0.1498376196,
    1.0000000000,    6.0999675356,    1.7208377772,    1.1794502765,    0.6721864371,    0.8824080118,    0.3523939041,    1.1467724645,    0.8473561704,    3.9676301314,
    2.4760729093,    4.5702393165,    1.2647586448,    1.9784115128,    0.7170441310,    0.6587162451,    0.6912286981,    2.6712122322,    1.7208933367,    3.7531238038,
    0.5586633161,    0.5272862704,    0.8596762792,    4.0048952441,    0.5751103938,    0.6816512829,    2.6556340777,    0.0676204767,    0.0997365090,    0.0169287728,
    0.1375988371,    0.0446687788,    2.0659396573,    0.2911780293,    0.0975520686,    0.1382891008,    0.1351390051,    0.1271066457,    0.1244341509,    0.8629916093,
    0.6479733179,    8.4516757955,    9.3899436901,    10.1942462514,    15.6479791785,    11.9751732474,    1.0839810469,    2.2318889160,    0.6218245027,    0.1842494169,
    0.3885585695,    2.4882139726,    0.1641639117,    39.3591356705,    48.8775082621,    61.1403084239,    75.1520767596,    89.3301273330,    101.4791398870,    478.9845033507,
    2.0783845493,    0.3229074288,    0.1981167899,    0.0369076127,    0.0265813361,    0.0258622692,    0.1641353180,    4.2651543046,    2.1312619276,    0.1189778892,
    0.4501883856,    0.2817174496,    0.0982850197,    0.9819878278,    0.4030657212,    0.4271906191,    0.1590308982,    0.1608760348,    0.7397923808,    0.4113938252,
    0.1696881996,    0.5582910903,    0.5440060430,    0.5462023888,    0.3634655184,    0.6745244143,    0.0903229391,    0.2907135948,    0.2421777867,    0.3715839598,
    0.4041466388,    1.5430928323,    0.7227313549,    0.6342984252,    0.2859900836,    0.3710677952,    0.4398415644,    0.9831681343,    0.2025309301,    0.1604561173,
    0.3826122074,    0.1929100911,    2.3150719685,    0.7412111452,    0.3563072942,    0.7374251313,    1.3917716132,    0.5398495982,    0.1817366630,    0.2180135055,
    0.0888946963,    0.2813000742,    0.4642767252,    0.8025754782,    73.9509063302,    4.1015807644,    0.8632211182,    0.6751701110,    0.2882832173,    0.0919315638,
    0.8338393611,    28.8514739041,    89.4629390504,    0.0456283981,    89.4101753711,    29.1772682239,    18.4877265825,    0.2675022705,    0.3590102979,    0.2780881810,
    0.5180003228,    0.5140939560,    1.5314974885,    1.3544402791,    13.3971066776,    2.6449972043,    5.3783106875,    55.3761818766,    2.8045142869
};

// Selected feature indices
constexpr int N_SELECTED_FEATURES = 503;
static const int SELECTED_FEATURES[N_SELECTED_FEATURES] = {
    0,    7,    12,    13,    14,    15,    16,    17,    19,    26,    27,    32,    33,    34,    35,    37,    40,    41,    45,    46,
    47,    50,    51,    60,    66,    67,    73,    75,    78,    82,    85,    86,    97,    102,    105,    106,    122,    124,    133,    135,
    136,    141,    155,    157,    232,    233,    291,    293,    294,    295,    296,    297,    299,    300,    302,    303,    305,    306,    307,    308,
    310,    314,    317,    318,    336,    338,    348,    350,    353,    361,    362,    374,    378,    380,    381,    382,    385,    388,    389,    391,
    398,    410,    418,    419,    421,    422,    425,    486,    489,    516,    546,    556,    582,    625,    638,    645,    647,    657,    662,    664,
    668,    694,    698,    727,    733,    735,    737,    739,    741,    744,    745,    746,    748,    750,    753,    761,    762,    763,    764,    770,
    775,    776,    779,    781,    799,    803,    806,    807,    811,    812,    814,    815,    816,    818,    820,    823,    834,    841,    842,    848,
    850,    851,    852,    854,    856,    857,    865,    869,    870,    874,    877,    879,    883,    888,    908,    911,    913,    922,    924,    935,
    939,    945,    949,    951,    956,    958,    967,    971,    978,    986,    987,    1017,    1018,    1021,    1023,    1026,    1039,    1044,    1045,    1046,
    1050,    1051,    1052,    1054,    1055,    1057,    1059,    1068,    1071,    1074,    1077,    1078,    1079,    1083,    1086,    1088,    1106,    1109,    1110,    1111,
    1112,    1123,    1135,    1137,    1140,    1141,    1145,    1148,    1152,    1154,    1164,    1169,    1171,    1180,    1181,    1182,    1183,    1184,    1185,    1186,
    1187,    1188,    1189,    1190,    1191,    1192,    1193,    1194,    1195,    1196,    1197,    1198,    1199,    1200,    1201,    1202,    1203,    1204,    1205,    1206,
    1207,    1208,    1209,    1229,    1230,    1231,    1232,    1279,    1293,    1319,    1328,    1334,    1336,    1337,    1338,    1339,    1340,    1341,    1342,    1343,
    1344,    1345,    1346,    1347,    1348,    1349,    1350,    1351,    1352,    1353,    1354,    1355,    1356,    1357,    1358,    1359,    1360,    1361,    1362,    1363,
    1364,    1365,    1366,    1367,    1368,    1369,    1370,    1371,    1372,    1373,    1374,    1375,    1376,    1377,    1378,    1379,    1380,    1381,    1382,    1383,
    1384,    1385,    1386,    1387,    1388,    1389,    1390,    1391,    1392,    1393,    1394,    1395,    1396,    1397,    1398,    1399,    1400,    1401,    1402,    1403,
    1404,    1405,    1406,    1407,    1408,    1409,    1410,    1411,    1412,    1413,    1414,    1415,    1416,    1417,    1418,    1419,    1420,    1421,    1422,    1423,
    1424,    1425,    1426,    1427,    1428,    1429,    1430,    1431,    1432,    1433,    1434,    1435,    1436,    1437,    1438,    1439,    1440,    1441,    1442,    1443,
    1444,    1445,    1446,    1447,    1448,    1449,    1450,    1451,    1452,    1453,    1454,    1455,    1456,    1457,    1458,    1459,    1460,    1461,    1462,    1463,
    1464,    1465,    1466,    1467,    1468,    1469,    1470,    1471,    1472,    1473,    1474,    1511,    1512,    1523,    1524,    1527,    1531,    1580,    1582,    1590,
    1591,    1595,    1629,    1654,    1682,    1683,    1685,    1691,    1694,    1698,    1714,    1718,    1725,    1735,    1754,    1786,    1792,    1812,    1820,    1830,
    1836,    1843,    1853,    1854,    1866,    1867,    1868,    1873,    1874,    1879,    1883,    1884,    1885,    1886,    1892,    1894,    1956,    1957,    1966,    1970,
    1972,    1981,    1982,    1990,    1991,    1992,    1993,    1994,    1995,    1996,    2002,    2050,    2088,    2165,    2166,    2167,    2174,    2235,    2237,    2238,
    2240,    2242,    2250,    2257,    2261,    2269,    2271,    2272,    2274,    2275,    2276,    2298,    2346,    2347,    2378,    2412,    2413,    2414,    2434,    2472,
    2480,    2512,    2525,    2526,    3076,    3077,    3095,    3135,    3144,    3164,    3210,    3291,    3399,    3523,    3765,    3767,    3801,    3848,    3868,    3993,
    4001,    4086,    4088
};

// Feature order metadata
constexpr int N_CASCADE_FEATURES = 8;
constexpr int N_PHYSICS_FEATURES = 10;
// Cascade feature names (in order)
static const char* CASCADE_FEATURE_NAMES[N_CASCADE_FEATURES] = {
    "V",
    "Polarizability",
    "L",
    "E",
    "B",
    "Density",
    "RI",
    "S",
};

// Physics feature names (in order)
static const char* PHYSICS_FEATURE_NAMES[N_PHYSICS_FEATURES] = {
    "phys_MR",
    "phys_Vm",
    "phys_fn",
    "phys_Parachor",
    "phys_epsCM",
    "phys_alpha",
    "phys_dD",
    "phys_dH",
    "phys_dP",
    "phys_delta",
};

// Prediction function using Treelite compiled library
// TL2cgen generates: size_t predict(union Entry* data, size_t num_row, float* result)
// Library path: /Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/a_v34_treelite.dylib
extern "C" {
    // Forward declaration of TL2cgen prediction function
    typedef struct {
        float missing_value;
        float fvalue;
    } Entry;
    
    // Function pointer type for prediction
    typedef size_t (*PredictFunc)(Entry* data, size_t num_row, float* result);
}

// Load library and get prediction function (called once at initialization)
static void* lib_handle = nullptr;
static PredictFunc predict_func = nullptr;

static bool load_treelite_library() {
    if (lib_handle != nullptr) return true;  // Already loaded
    
    const char* lib_path = "/Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/a_v34_treelite.dylib";
    lib_handle = dlopen(lib_path, RTLD_LAZY);
    if (!lib_handle) {
        return false;
    }
    
    // Get prediction function
    predict_func = (PredictFunc)dlsym(lib_handle, "predict");
    if (!predict_func) {
        dlclose(lib_handle);
        lib_handle = nullptr;
        return false;
    }
    
    return true;
}

inline double predict(const double* features) {
    // Ensure library is loaded
    if (!load_treelite_library()) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Normalize features
    double normalized[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        normalized[i] = (features[i] - COL_MEANS[i]) / COL_STDS[i];
    }
    
    // Convert to TL2cgen Entry format
    Entry data[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        data[i].missing_value = -1.0f;  // No missing values
        data[i].fvalue = static_cast<float>(normalized[i]);
    }
    
    // Call Treelite prediction
    float result[1];
    size_t num_output = predict_func(data, 1, result);
    if (num_output == 0) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Denormalize target
    double pred_norm = static_cast<double>(result[0]);
    double pred = pred_norm * TARGET_SCALE + TARGET_MEAN;
    
    return pred;
}

} // namespace CascadeA
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit

// Wrapper struct for template parameter (C++ doesn't allow namespaces as template parameters)
// Must be outside the namespace to reference it
namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadeA {
struct Model {
    using Namespace = CascadeA;
};
} // namespace CascadeA
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit
