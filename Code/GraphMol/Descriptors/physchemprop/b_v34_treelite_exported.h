#pragma once
// Auto-generated Treelite model for B (v3.4 XGBoost)
// Trees: 300, Features: 506
// Target normalization: mean=0.7137663993, scale=0.6844816395
// Library: b_v34_treelite.so

#include <vector>
#include <cmath>
#include <algorithm>
#include <dlfcn.h>  // For loading shared library
#include <limits>

namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadeB {

constexpr int N_TREES = 300;
constexpr int N_FEATURES = 506;
constexpr double TARGET_MEAN = 0.7137663993;
constexpr double TARGET_SCALE = 0.6844816395;

// Normalization stats
constexpr int N_NORM_FEATURES = 506;
static const double COL_MEANS[N_NORM_FEATURES] = {
    0.0291549504,    0.0102116324,    0.0084356963,    0.2714222288,    0.1198756845,    0.0739973361,    0.0239751369,    0.0147994672,    0.0053278082,    0.0393665828,
    0.0118395738,    0.0575699275,    0.0124315525,    0.0328548172,    1.4999260027,    2.6933550392,    0.0855409205,    0.0229391742,    0.0365546840,    0.6357851117,
    0.3540032559,    0.0050318189,    2.9743969217,    2.0911647181,    0.2384194169,    0.3529672932,    0.1133639189,    0.1562823738,    0.0090276750,    0.0350747373,
    0.0073997336,    0.2980612698,    0.2061565784,    3.3442356075,    8.4266633469,    0.5152615079,    0.5425520179,    14.8215178618,    209.9051200237,    209.5356958705,
    0.1770346322,    -0.3284984774,    0.3371343069,    0.1749767557,    1.1422787143,    2.1496092907,    24.3853760182,    10.2055179423,    2.1687011646,    -2.0509891134,
    0.3415295353,    2.1276522064,    2.7294113227,    10.7896635465,    9.9456137725,    5.8677411858,    3.4527989767,    2.6183417143,    3.2580333253,    1.1609611176,
    25.9693027794,    22.5809373135,    8.2403164371,    5.8528765202,    25.7780750207,    5.8247731375,    25.1820075387,    2.3448903609,    2.3611861288,    15.5077770446,
    5.0067459579,    4.8474621721,    19.7890296969,    34.7805002220,    5.9505838909,    9.4919129741,    6.7960387110,    8.9187085228,    7.4690841864,    2.3883231784,
    8.0773108908,    5.4696782978,    1.2908882651,    -0.2132903772,    0.1618657153,    0.7814118692,    2.3741305313,    2.0701494746,    2.6316349341,    56.4341335504,
    0.0202752701,    0.2749741009,    0.0066597602,    0.0017759361,    0.0535740713,    1.6362290958,    220.2316428282,    174.2003637786,    131.4780227912,    154.6033137569,
    191.9257863801,    197.1084951845,    140.9845165874,    85.8746522075,    1039.8534852745,    825.5953825662,    4233.4584067373,    2240.2822150959,    498.2024489547,    406.9763440580,
    7828.0377491610,    2.7285842319,    2.2476084689,    3.1322472854,    2.2302067291,    37.2892335813,    21.1198312033,    17.8318054402,    15.5086777756,    163.9087724419,
    257.9929686920,    209.8376497101,    177.0994528738,    129.5266971221,    90.2973194108,    7.5850807186,    5.3426694987,    1.5907925318,    1.5545182161,    1.3525637764,
    164.5305718551,    146.4148941848,    155.4503638336,    159.7443416466,    0.0229246954,    -0.0079356209,    -0.0089260556,    -0.0157170729,    0.0185366596,    0.0018367583,
    91.3773039359,    23.4085440606,    -15.4278866922,    -21.1418496680,    -16.5510527188,    -10.1724244922,    -8.2426328300,    -2.5859815263,    4.7641333869,    -2.0537794169,
    -1.9180279349,    0.1643089040,    44.7783250767,    -4.5560470182,    -2.4624050241,    -5.1990409844,    -5.7217967324,    -3.4761871079,    -1.6889822595,    7.3226889244,
    4.6849066472,    -46.0912848264,    -39.6953630441,    -3.2290983420,    16.4568994162,    -17.4519895666,    -3.0517464367,    -273.1057206900,    -81.2340859794,    2.1260048868,
    -0.1187710477,    -0.1939648648,    -0.2926928490,    -0.0785047901,    -0.1223109743,    0.5160079483,    -0.2964708508,    -0.0950744691,    -0.1658806509,    0.5843118810,
    7.8584605107,    -0.1714952680,    -1.4023686980,    -0.2548098835,    -2.7037013734,    -1.8211878826,    -7.3930332208,    0.0175461284,    0.0004682937,    0.0003166305,
    0.7631379894,    0.1063894455,    -0.4387138599,    -0.1621440982,    -0.0119417080,    -0.0587319394,    0.0215812432,    0.0481772539,    -0.1226940031,    -0.0191364219,
    -1.4872710712,    -0.0577410063,    49.2291470017,    -0.0050389727,    -0.0059691095,    -0.0029681536,    -0.0049534221,    0.1258945072,    -0.0069134214,    0.0115526795,
    0.2876072351,    -0.0089906169,    -0.0009461720,    0.0166917622,    1.5735799819,    -0.0653752926,    -0.1597628065,    0.1032005870,    -0.4141963125,    0.0269502919,
    0.2259333039,    -0.1204343796,    -0.0746429568,    0.0508831698,    -0.1048297621,    0.0347843282,    0.0834305310,    -0.0631755805,    0.0075015995,    -0.0869478427,
    -0.0328510962,    0.0793841344,    -0.0374488786,    -0.0793072097,    -0.0884332024,    -0.0874572445,    -0.0378081861,    0.0698207185,    -0.0433245095,    1.4178238953,
    0.9797392003,    1.0370760964,    0.9963889084,    0.9492827428,    0.8223095409,    0.5478557918,    1.1123319353,    1.0771345870,    1.0039725451,    0.8751007977,
    0.5424969677,    1.0615790552,    1.4316699916,    0.7086306889,    0.9765910694,    1.1065290882,    0.9736369185,    0.8959536722,    0.9110402007,    1.0594079071,
    1.0573748248,    0.6193155280,    1.0916136004,    0.8313737318,    0.5456490799,    0.8557419861,    1.0490571961,    1.0402786044,    0.8330759101,    0.8685790881,
    0.8351345110,    1.0460318853,    1.0897982377,    1.0882730408,    0.9815605903,    0.8545168512,    0.4727403225,    0.3863879732,    -0.3778740294,    5.4275218632,
    5.4560641224,    1.2101931206,    11.5040966071,    5.7556434393,    15.9119596415,    2.4755981179,    3.3748768979,    2.2770126680,    3.3928060064,    2.2229053970,
    2.2184615720,    0.9021064410,    13.8607690802,    10.8947780030,    2.3591548220,    88.4475850838,    44.6311456937,    66.7390785625,    89.2095110199,    5.2395837612,
    44.6354305758,    0.9940968008,    3.5751282379,    3.5751429442,    0.2879043690,    1.4609304903,    64.3361708539,    3.9774041329,    4.0688214594,    107.9024765639,
    53.4569917696,    79.8209280383,    107.2518097511,    6.3049120069,    7.0422794095,    0.5749584535,    0.3255123009,    0.2006369627,    0.6600562380,    3.8490454344,
    0.0062699777,    0.1166525895,    1.0852450793,    0.0695820962,    0.3312260233,    0.4823572727,    0.3316992042,    0.3836345917,    0.2369030398,    0.1418727915,
    0.0167834285,    17.2703736382,    3.9830681072,    4.0693506727,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0002959893,    0.0000000000,
    1.4997780080,    0.0599378422,    2.6889151991,    0.0073997336,    0.2949533817,    2.6798875240,    0.6357851117,    0.0053278082,    0.0393665828,    0.6579843126,
    1.5505401806,    0.2813378718,    0.3059049874,    0.0000000000,    0.0950125795,    0.0000000000,    0.0441024123,    0.1482906615,    0.1303833062,    0.0578659168,
    0.0466183217,    0.4021015243,    0.7028266982,    0.4445759953,    0.0260470623,    0.2829658132,    0.0000000000,    0.0000000000,    0.0023679148,    0.0236791476,
    0.0000000000,    0.0000000000,    0.0014799467,    0.0146514725,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,
    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0590498742,    0.0000000000,    0.0000000000,    0.0000000000,
    0.0316708598,    -0.0512503057,    0.0981102600,    0.6002297832,    0.1311743145,    0.0753294923,    0.6838549326,    8.5381325022,    1.3618965256,    -0.0275007303,
    0.0530169878,    0.0679204132,    5.3303073409,    1.2889997534,    2.4684826887,    5.2281070575,    1.4537355100,    0.9007169391,    5.2465902422,    0.4904438982,
    1.0168857701,    0.2861264555,    0.5612113616,    0.4330897493,    0.1624051089,    0.0447603441,    0.0286215601,    -1.6847713482,    1.3870597597,    3.1574929842,
    3.7624677808,    38.6986134983,    65.8690354143,    0.3094298747,    0.4815693738,    0.7824100777,    1.0279464498,    15.4310165602,    51.1344149612,    30.3481940287,
    6.3160659185,    7.1140517908,    0.0875070644,    1.9360509208,    5.9553410431,    0.4245911171,    1.5114598037,    1.4695328535,    0.1005444619,    1.2127875662,
    0.0976750548,    33.1540624538,    2.7179908728,    17.8997099725,    37.3583720586,    0.1846257765,    0.2254937299,    0.0237024510,    0.0073416201,    0.4531919739,
    1.3176728653,    113.9425123576,    1.5320408465,    0.9126709756,    0.1206179481,    2.2815244804,    1.4555558007,    0.4450423690,    5.0921257678,    3.5304994231,
    0.2264702991,    0.2072634282,    0.4409992007,    0.0006197428,    2.7115779979,    0.0488415039,    0.1024516217,    0.3962641762,    -0.0249974100,    10.9530624442,
    1.5132455232,    2.7800799171,    0.1941873208,    0.7219985596,    0.1532498240,    0.0526577221,    0.1999702546,    0.0621271262,    0.0561780893,    0.3741770581,
    0.0162252781,    0.5204823549,    0.0594491204,    0.1934757101,    0.0157904699,    4.3134005040,    0.7023590351,    0.6956557644,    1.1869983721,    7.0121916531,
    1.4222706534,    60.6510157452,    0.1810107410,    123.0382540482,    2.1037015922,    1.9212867563,    0.4992091313,    0.0164274086,    0.0250110996,    0.1469587095,
    0.2003847861,    0.1151398550,    1.6039326929,    149.1538219784,    7.0834074626,    1.0080140722
};

static const double COL_STDS[N_NORM_FEATURES] = {
    0.3085425921,    0.1230413500,    0.1255558400,    0.8086233871,    0.4271565688,    0.4205399272,    0.1548945073,    0.1290440560,    0.0875633337,    0.2140293607,
    0.1222917865,    0.2655843461,    0.1258128813,    0.1971778955,    1.5759237251,    3.8008869228,    0.3274608789,    0.1564764963,    0.2035539617,    1.5866594184,
    0.7269952934,    0.0707566227,    3.0194125674,    2.0092225770,    0.8192325519,    0.7758349926,    0.4007472741,    0.4173543695,    0.1077500821,    0.1979199543,
    0.1057962146,    0.9325089686,    0.9493479287,    6.1905429454,    3.6188171865,    0.6057503016,    0.1480738973,    10.2570699492,    108.8891459825,    108.6568027821,
    0.1421174995,    0.1514467206,    0.1517734181,    0.1227779587,    0.3544540620,    0.5411939192,    18.7038560510,    1.7206595556,    0.2422125016,    0.2855751780,
    0.6254673097,    0.4625297803,    0.6755667135,    5.6409657662,    261.2697713286,    8.0488971098,    6.8012468185,    5.4968819521,    5.1091887939,    4.2547926728,
    24.9463303808,    18.7782257651,    9.8344881465,    8.4068049776,    28.9591044771,    9.1545540935,    22.4485141909,    5.0449977937,    4.3408320853,    18.7073089542,
    6.6109686528,    8.1739194404,    18.7099778380,    37.5881381632,    9.1804138589,    11.7068145216,    10.2760187941,    13.1667631452,    13.2940551253,    6.6233497533,
    10.6377890317,    9.8251124809,    2.5986764084,    4.2249821561,    1.4739341163,    1.3527112165,    2.5146661128,    2.1651083384,    1.9678613022,    28.2245519337,
    0.1419865235,    0.8646014172,    0.0813351575,    0.0421044192,    0.2385784283,    1.9154795429,    201.7109658234,    251.2426534982,    162.8871304129,    115.2583021650,
    209.1353123242,    220.6337966396,    208.7042068852,    180.4540668548,    696.5907242490,    960.3865001418,    3910.0071103603,    3323.5462232047,    364.3592624589,    358.1495111645,
    4959.2654429912,    3.9705159955,    3.8626449683,    1.2498311781,    3.3357643125,    68.8041300341,    24.3770612216,    23.6057190532,    28.5334126272,    375.0491720906,
    44.9421952269,    58.3473779832,    58.2928934734,    61.4395858147,    69.7532304747,    1.3647317146,    2.0476605046,    0.7152327881,    0.5146389485,    0.4493588636,
    11.7708228305,    6.8956220580,    12.6839032098,    37.4540822741,    0.2194423868,    0.2327867046,    0.2273940985,    0.1976121598,    0.1901781108,    0.1319393471,
    61.0156128048,    24.6861825052,    39.0662714043,    38.2325376357,    41.3127253287,    39.4351344241,    39.3645349873,    33.1097045798,    6.1389315313,    3.9831999921,
    5.7740817983,    4.2021973385,    48.3993870415,    7.6039091012,    22.2318495061,    22.2986320508,    21.5473679971,    18.9991366191,    17.5079539238,    42.5383742757,
    106.7194376397,    151.7379253753,    145.1818371239,    134.5381441171,    548.7307079799,    684.5452063383,    127.7834951352,    622.3783349283,    560.7035354934,    1.9737838160,
    0.5053052264,    1.1185577079,    1.0893789713,    0.7649722534,    0.6170100906,    1.5148542958,    1.7046248617,    1.2182582542,    0.7579792949,    1.7158500026,
    8.0724595643,    2.9208271491,    2.8627180199,    5.2458577901,    7.7583785732,    15.6258175153,    15.5440221268,    0.0148914732,    0.0051841822,    0.0079786157,
    0.6527498087,    0.6943900672,    0.9620637042,    1.5681381918,    1.8422020044,    0.1000864840,    0.1525126995,    0.1385498553,    0.7571293991,    3.8149981768,
    11.9152239607,    44.1419787268,    9.2778288351,    0.0195727871,    0.0268118744,    0.0489785631,    0.0702973450,    0.1164577606,    0.0283471058,    0.0412852875,
    0.2331555612,    0.0507007708,    0.1578583949,    0.1068130493,    1.0504557458,    0.3839908176,    0.3677381172,    0.4337478037,    0.2415681659,    0.2722236039,
    0.1881342331,    0.1913796365,    0.2782941762,    0.3728854985,    0.1694284105,    0.2522759376,    0.2615785335,    0.1780494824,    0.0926732071,    0.1907015703,
    0.2655406122,    0.3603791950,    0.1468777928,    0.1692204834,    0.2036918594,    0.2123357553,    0.1456247401,    0.3315895419,    0.1807376036,    0.3035361165,
    0.3237489408,    0.3490229548,    0.3492687264,    0.4610383201,    0.5897416633,    0.6711941350,    0.3330919917,    0.3630524753,    0.5067712439,    0.6291236756,
    0.6739524646,    0.3455025802,    0.3751372836,    0.2873805340,    0.3464929118,    0.6588535145,    0.8425601734,    0.2925289339,    0.2488474304,    0.3250814621,
    0.3217196970,    0.7851812494,    0.3000424078,    0.5028674305,    0.5776212378,    0.3187191509,    0.3557599867,    0.3334764308,    0.8675533907,    0.3204771569,
    0.3195350872,    0.3423192581,    0.4062475283,    0.2580900455,    0.2846507706,    0.3539058881,    0.4924625482,    0.0900146943,    0.0924096298,    1.1490168317,
    2.1763752118,    0.3141677814,    7.9843093494,    0.7045404089,    2.3917353401,    0.0773433125,    0.3030675553,    0.0809993398,    0.3659918239,    0.0882794197,
    0.6360046766,    0.2905620312,    1.4328374681,    0.3574084354,    0.6915302425,    110.7350311620,    55.4845595247,    83.3296208358,    111.0244385497,    2.7137565064,
    55.4812862124,    1.0391657716,    0.8890925896,    0.8891525966,    0.0723077812,    0.7334986365,    59.8787783349,    1.2186784900,    1.2895140712,    131.8990476750,
    65.6035393668,    98.4764198754,    131.3751668781,    3.0950976308,    3.6192668563,    0.7022443272,    0.1650383066,    0.1088796500,    0.9709521819,    3.8560379425,
    0.0456517363,    0.2982288275,    1.0423856242,    0.1893019215,    0.7217584694,    0.0517346346,    0.0596080909,    0.1473177812,    0.1469473019,    0.1123857395,
    0.0675187883,    9.0553563010,    1.2284068141,    1.2934485170,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    0.0172017945,    1.0000000000,
    1.5759237112,    0.2705858273,    3.7999030184,    0.0890895967,    0.7697051661,    3.0815130160,    1.5866594184,    0.0786599688,    0.2357460829,    1.0378797038,
    1.9228108329,    0.9288891701,    0.9007827480,    1.0000000000,    0.3675859361,    1.0000000000,    0.2291659150,    0.5073695111,    0.4273698705,    0.2874655461,
    0.2581554854,    0.9305059770,    0.9201730096,    0.9086183731,    0.1629495941,    1.5196882331,    1.0000000000,    1.0000000000,    0.1002897337,    0.3228304909,
    1.0000000000,    1.0000000000,    0.0384415983,    0.1363108863,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,
    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    0.3570551740,    1.0000000000,    1.0000000000,    1.0000000000,
    0.1825697691,    0.8517486572,    0.5959397612,    2.0584079014,    0.6419551002,    0.3772346872,    2.5784583674,    11.7632082287,    0.9639860767,    0.1329956771,
    0.2821019464,    0.3198379446,    5.6186902389,    0.9196251521,    4.0843570660,    5.5195140776,    2.2977330606,    3.2001734123,    5.5195803761,    0.0607615737,
    0.3503005463,    0.1016607454,    0.3170144644,    0.0081653178,    0.1568137804,    0.0469601637,    0.0440736689,    4.9145587611,    0.2944434044,    0.6949436160,
    0.8455451448,    22.1174037208,    44.2916892207,    0.0983853550,    0.1281711131,    0.1277764787,    0.6792379973,    8.5568964898,    26.0788232115,    15.2771619323,
    7.1175723207,    7.2166780309,    0.3973733454,    0.0944770907,    5.5509788743,    0.3006021681,    0.3402419576,    2.5462240260,    0.1629368479,    3.2790187508,
    0.2363463776,    60.6801133912,    2.8632999817,    12.6340039960,    39.4278984583,    0.3370411812,    0.1188042029,    0.0190302076,    0.0089932605,    0.1646522997,
    2.7358883511,    74.4228444140,    1.9517000841,    2.1554316612,    0.4712941899,    2.6910252700,    2.1683466956,    0.5846352159,    4.0921887702,    3.6632694718,
    0.1596622007,    0.7902069771,    1.2340660271,    0.0251532710,    3.3053515370,    0.3127416083,    0.4926660960,    1.5235418055,    0.1854356189,    12.4693509099,
    2.0701070691,    3.3277215571,    0.7715806518,    0.7298774190,    0.4763173673,    0.1784889186,    0.4003056042,    0.2558872375,    0.4322843764,    1.1598921954,
    0.1467627273,    0.7923001666,    0.2835267349,    0.7327392186,    0.2015495275,    3.1565885039,    0.7408311941,    0.7451015145,    0.8510883088,    3.9374708398,
    0.3556070163,    32.5233860660,    0.0830441590,    175.2547066684,    0.4319693715,    28.6116880422,    0.2239393672,    0.1637472603,    0.1653645607,    0.6631006944,
    0.5314831351,    0.4349707178,    0.7862262338,    73.0931032546,    4.0459894460,    0.8613295217
};

// Selected feature indices
constexpr int N_SELECTED_FEATURES = 502;
static const int SELECTED_FEATURES[N_SELECTED_FEATURES] = {
    0,    13,    14,    15,    16,    17,    18,    19,    25,    38,    45,    49,    50,    63,    66,    67,    70,    71,    73,    78,
    83,    105,    111,    122,    131,    140,    141,    148,    149,    151,    154,    157,    214,    215,    291,    293,    295,    296,    297,    299,
    302,    303,    304,    305,    306,    308,    309,    310,    313,    314,    316,    317,    318,    334,    336,    338,    339,    343,    344,    347,
    348,    349,    350,    351,    357,    358,    359,    361,    362,    366,    367,    368,    370,    374,    376,    380,    382,    383,    385,    387,
    388,    389,    390,    391,    395,    398,    399,    409,    421,    422,    443,    449,    456,    479,    496,    535,    545,    547,    557,    563,
    564,    565,    567,    569,    572,    575,    582,    585,    600,    619,    635,    646,    647,    661,    667,    669,    672,    673,    674,    678,
    688,    689,    690,    692,    694,    700,    711,    723,    725,    726,    732,    733,    734,    737,    743,    744,    745,    746,    747,    749,
    750,    751,    753,    754,    755,    756,    757,    758,    760,    761,    764,    767,    768,    769,    771,    772,    773,    775,    776,    778,
    779,    780,    782,    785,    788,    794,    796,    799,    802,    804,    805,    807,    808,    812,    814,    815,    816,    821,    823,    824,
    831,    833,    834,    837,    841,    842,    843,    849,    851,    857,    859,    860,    862,    864,    865,    871,    873,    875,    879,    886,
    889,    902,    903,    913,    915,    918,    927,    930,    931,    932,    939,    940,    945,    947,    948,    950,    951,    956,    957,    964,
    965,    967,    969,    972,    976,    978,    979,    983,    997,    1008,    1009,    1012,    1013,    1015,    1016,    1032,    1037,    1044,    1046,    1053,
    1054,    1055,    1056,    1057,    1058,    1060,    1063,    1064,    1065,    1066,    1068,    1069,    1070,    1078,    1079,    1081,    1082,    1085,    1086,    1088,
    1096,    1100,    1101,    1106,    1108,    1109,    1111,    1119,    1123,    1125,    1126,    1127,    1128,    1143,    1144,    1145,    1148,    1149,    1150,    1151,
    1155,    1156,    1157,    1158,    1162,    1164,    1165,    1166,    1167,    1168,    1169,    1170,    1171,    1172,    1173,    1174,    1175,    1176,    1177,    1178,
    1179,    1180,    1181,    1194,    1195,    1196,    1197,    1198,    1199,    1200,    1201,    1202,    1203,    1204,    1256,    1271,    1288,    1289,    1292,    1293,
    1302,    1310,    1311,    1312,    1313,    1334,    1335,    1350,    1351,    1352,    1356,    1359,    1397,    1398,    1399,    1400,    1401,    1402,    1403,    1404,
    1405,    1406,    1407,    1408,    1409,    1410,    1411,    1412,    1413,    1414,    1415,    1416,    1417,    1418,    1419,    1425,    1426,    1427,    1428,    1429,
    1430,    1432,    1433,    1434,    1435,    1436,    1437,    1438,    1439,    1440,    1441,    1442,    1443,    1444,    1454,    1457,    1458,    1459,    1460,    1461,
    1462,    1463,    1464,    1465,    1466,    1467,    1468,    1469,    1470,    1471,    1485,    1515,    1524,    1528,    1583,    1587,    1591,    1594,    1607,    1631,
    1632,    1688,    1695,    1708,    1735,    1736,    1737,    1739,    1796,    1805,    1810,    1820,    1826,    1837,    1840,    1841,    1843,    1844,    1854,    1856,
    1858,    1860,    1861,    1866,    1873,    1877,    1881,    1884,    1890,    1892,    1960,    1961,    1972,    1976,    1977,    1978,    1980,    1981,    1982,    1985,
    1986,    1992,    2005,    2009,    2153,    2159,    2164,    2168,    2170,    2174,    2199,    2210,    2232,    2237,    2240,    2249,    2251,    2252,    2254,    2255,
    2271,    2310,    2344,    2363,    2406,    2410,    2501,    2512,    2519,    2669,    2770,    3034,    3053,    3136,    3137,    3202,    3229,    3231,    3243,    3250,
    3257,    3401,    3473,    3504,    3602,    3764,    3766,    3767,    3768,    3770,    3812,    3819,    3840,    3844,    3845,    3847,    3852,    4002,    4004,    4033,
    4050,    4058
};

// Feature order metadata
constexpr int N_CASCADE_FEATURES = 4;
constexpr int N_PHYSICS_FEATURES = 0;
// Cascade feature names (in order)
static const char* CASCADE_FEATURE_NAMES[N_CASCADE_FEATURES] = {
    "V",
    "Polarizability",
    "L",
    "E",
};

// Prediction function using Treelite compiled library
// TL2cgen generates: size_t predict(union Entry* data, size_t num_row, float* result)
// Library path: /Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/b_v34_treelite.dylib
extern "C" {
    // Forward declaration of TL2cgen prediction function
    typedef struct {
        float missing_value;
        float fvalue;
    } Entry;
    
    // Function pointer type for prediction
    typedef size_t (*PredictFunc)(Entry* data, size_t num_row, float* result);
}

// Load library and get prediction function (called once at initialization)
static void* lib_handle = nullptr;
static PredictFunc predict_func = nullptr;

static bool load_treelite_library() {
    if (lib_handle != nullptr) return true;  // Already loaded
    
    const char* lib_path = "/Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/b_v34_treelite.dylib";
    lib_handle = dlopen(lib_path, RTLD_LAZY);
    if (!lib_handle) {
        return false;
    }
    
    // Get prediction function
    predict_func = (PredictFunc)dlsym(lib_handle, "predict");
    if (!predict_func) {
        dlclose(lib_handle);
        lib_handle = nullptr;
        return false;
    }
    
    return true;
}

inline double predict(const double* features) {
    // Ensure library is loaded
    if (!load_treelite_library()) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Normalize features
    double normalized[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        normalized[i] = (features[i] - COL_MEANS[i]) / COL_STDS[i];
    }
    
    // Convert to TL2cgen Entry format
    Entry data[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        data[i].missing_value = -1.0f;  // No missing values
        data[i].fvalue = static_cast<float>(normalized[i]);
    }
    
    // Call Treelite prediction
    float result[1];
    size_t num_output = predict_func(data, 1, result);
    if (num_output == 0) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Denormalize target
    double pred_norm = static_cast<double>(result[0]);
    double pred = pred_norm * TARGET_SCALE + TARGET_MEAN;
    
    return pred;
}

} // namespace CascadeB
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit

// Wrapper struct for template parameter (C++ doesn't allow namespaces as template parameters)
// Must be outside the namespace to reference it
namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadeB {
struct Model {
    using Namespace = CascadeB;
};
} // namespace CascadeB
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit
