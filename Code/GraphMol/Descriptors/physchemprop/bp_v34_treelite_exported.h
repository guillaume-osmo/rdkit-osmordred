#pragma once
// Auto-generated Treelite model for BP (v3.4 XGBoost)
// Trees: 300, Features: 581
// Target normalization: mean=234.7689085702, scale=124.3265917617
// Library: bp_v34_treelite.so

#include <vector>
#include <cmath>
#include <algorithm>
#include <dlfcn.h>  // For loading shared library
#include <limits>

namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadeBP {

constexpr int N_TREES = 300;
constexpr int N_FEATURES = 581;
constexpr double TARGET_MEAN = 234.7689085702;
constexpr double TARGET_SCALE = 124.3265917617;

// Normalization stats
constexpr int N_NORM_FEATURES = 581;
static const double COL_MEANS[N_NORM_FEATURES] = {
    0.0029698770,    0.0008485363,    0.2318625371,    0.0575943997,    0.0212134069,    0.0043487484,    0.0074246924,    0.1007636826,    0.0318201103,    0.0012728044,
    0.0035002121,    0.0712770471,    0.0654433602,    1.7246499788,    3.3359142978,    0.0624734832,    0.6480695800,    0.3429147221,    0.0540941875,    0.3709164192,
    0.1050063640,    0.2340899448,    0.0694739075,    1.9424056003,    1.3920237590,    0.0394569368,    0.4954391175,    4.3545820959,    0.3830080611,    0.0494272380,
    4.2514849385,    0.0762621977,    0.0612006788,    0.2485150615,    7.9718824441,    0.5677447063,    -0.2333882928,    0.5112616607,    15.0686867941,    185.3810825202,
    185.0732934723,    0.1589170622,    -0.3114146070,    0.3233921811,    1.1738812323,    2.0635882285,    23.6443627106,    10.1975509114,    -2.0509106366,    2.1387446690,
    5.9175199923,    0.2930711941,    1.9989885700,    5.4145139211,    4.3002595341,    0.5400241882,    0.4118717240,    2.1502981957,    1.2194318020,    1.3116330338,
    19.1978817171,    5.4957947502,    4.4350865328,    9.3689609993,    32.4086479294,    16.6029920741,    1.3119887731,    1.1363630960,    12.0389915395,    4.4807164029,
    30.4923024055,    24.0008792957,    8.6617487548,    1.7234719695,    5.6015984514,    3.5250572347,    3.7132774708,    3.7984288378,    1.6001272804,    0.4455876114,
    4.8171509517,    2.7923931661,    50.3172457573,    0.0044548154,    0.0031820110,    0.0125159101,    3.0720796596,    15.1477513789,    163.3357737772,    84.2250742469,
    120.7238422776,    109.2277754426,    59.3769189300,    731.5669282987,    877.6623886296,    927.4778319898,    589.7729104794,    243.4621340687,    2266.3859782231,    8352.2346968439,
    481.2622066002,    47.0958473659,    68.1998702804,    3.1035619328,    1.4537969628,    2.1982182124,    1.5957783522,    3.6526316188,    3.5998133196,    1.4674517432,
    36.2863270803,    23.0147260951,    15.5469562971,    159.2686303696,    111.7614936083,    7.5302744599,    6.2110619418,    5.6356986693,    5.5830566410,    1.4399291246,
    0.6481358592,    162.4404025580,    125.2407579695,    101.5008469656,    -0.1719359540,    -0.0028145199,    -0.0003588307,    -0.0050256311,    0.0113344821,    74.9604899532,
    19.5119371217,    2.9075331185,    -6.7644085905,    -0.0058611355,    3.1903761842,    -3.0778752969,    -0.4183183362,    -3.6485807241,    6.6309080887,    -3.7944965983,
    -5.1783039087,    -1.7130210406,    317.0271122862,    -55.1627368342,    -272.8599855378,    -38.3255663342,    -114.5331752864,    -88.0017690072,    -52.0852056658,    65.8793404771,
    -0.0786569096,    -0.1971460588,    -0.2837921202,    -0.3803710119,    0.4249682968,    -0.4481008383,    -0.2183015847,    -0.2805744945,    -0.6521354629,    -0.3670296066,
    0.2740739328,    40.9093385205,    -2.8492261511,    -4.2366587008,    -9.2513793380,    -1.3686106351,    1.4480537033,    -0.0076257401,    0.0000600923,    -0.0003143765,
    0.0004006970,    0.0001474376,    3.0313392445,    0.7158784744,    -0.0002439934,    0.0917993044,    -0.0784937534,    0.0257926219,    1.8369295609,    -0.2032818581,
    0.1673673168,    -0.2037551745,    -0.5328512904,    -3.1097486678,    -1.8913789119,    -3.8042283313,    4.5196124875,    -0.0074522805,    -0.0043856089,    0.0089814611,
    -0.0113211279,    -0.0370023659,    -0.0220854704,    0.0192690953,    -0.1546148651,    -0.0978640915,    0.0758023116,    0.0697823604,    -0.3872278565,    -0.0324562661,
    0.0362223276,    -0.0377729499,    -0.1177222219,    -0.0242380004,    0.0193951974,    0.2062162761,    -0.1693066425,    0.0385293369,    -0.1306514561,    -0.0009913289,
    -0.0442947927,    -0.1289559783,    -0.0746437324,    0.0446233854,    -0.0891242452,    0.0411727551,    -0.0994157771,    -0.0959150891,    0.0430056730,    -0.0690600006,
    -0.0133659114,    -0.0844951239,    -0.0602363158,    0.0833961538,    1.4163388174,    1.0024992871,    1.0434930642,    0.7708321207,    0.6630366333,    0.4621131184,
    1.1398523091,    0.4403825653,    1.2053604887,    1.5529592749,    0.9019576619,    0.4142982140,    1.0177114472,    0.7389733939,    1.0083369742,    1.0585377364,
    0.7915491368,    1.0884878094,    0.4866279836,    1.2031664238,    1.0693206582,    0.9806696636,    0.8884402566,    0.8693532160,    1.0803823162,    1.0795810865,
    1.0385549627,    0.8707118703,    0.5002228016,    1.0794660813,    0.8709470275,    0.9168049316,    1.1396807421,    0.3658003844,    5.3021248394,    1.0929204978,
    1.2192401613,    11.1194750852,    5.7741925722,    16.0302766332,    3.3763347460,    2.2510147896,    10.9518648417,    40.8630777996,    0.5695405732,    -2.2982427657,
    0.1530249730,    0.9531562622,    0.0819633183,    0.2905091065,    0.0875886293,    0.5741270558,    0.0528181307,    0.1089770231,    0.0221300083,    1.7188249454,
    2.2296962698,    3.0270991692,    0.8850588869,    1.0920599424,    1.4019272824,    9.3007240424,    5.7709581965,    4.9780347972,    3.4819487537,    2.3980164864,
    1.6085600909,    0.9546427442,    0.5439336227,    0.7726626572,    0.4955282327,    0.3493283562,    0.2333718586,    0.1515928345,    0.0926501162,    0.0585871258,
    0.0347066593,    8.0882604763,    4.6811865374,    3.5897826146,    2.2838032401,    1.4509476176,    0.9018113383,    0.5497842867,    0.3110276941,    0.6773857398,
    0.4070661874,    0.2622927048,    0.1632554802,    0.0993573090,    0.0567764227,    0.0338407283,    0.0188490425,    16.5359036911,    15.4342754575,    15.7907567775,
    27.2747977465,    8.9462942041,    0.0000000000,    3.3650853723,    0.3053696332,    1.2847495498,    49.1414337872,    3.5468877611,    3.7237941794,    644.8711285532,
    95.0261825060,    47.5072718655,    71.2337604965,    95.0261825060,    6.3175661413,    47.5078495747,    3.3536893704,    0.3044442481,    1.2815196614,    50.0613700879,
    3.6113804544,    3.7400456691,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    1.7245439118,    0.4072974120,
    1.5350021213,    0.6480695800,    0.0066822232,    0.0464573611,    0.5680950361,    0.8619007213,    0.0000000000,    0.0006364022,    0.0618370810,    0.0169707255,
    0.0624734832,    0.0433814171,    0.0328807807,    0.0124098430,    0.0000000000,    0.2971998303,    0.7379327870,    0.0862576487,    0.1089086616,    0.0243654695,
    0.0621944507,    2.0185453497,    0.0259763786,    0.0801279732,    0.0192343477,    0.4161295650,    0.2918990258,    0.0333587113,    -0.0157125508,    0.0647061256,
    0.3810547004,    0.0033536086,    0.8858445848,    0.8572023156,    0.4300804108,    0.8280088626,    0.0231734618,    -0.2226009150,    0.5986709018,    22.0705377599,
    1.3014912126,    2.0598431962,    3.3982355149,    3.5504281456,    33.9827517066,    54.6566813563,    80.9821633135,    1.0330043612,    22.7845730497,    29.2704965751,
    29.2467909651,    46.1604915256,    0.8931904964,    0.3370810352,    148.3061837081,    2.1502981957,    1.2194318020,    2.2360768585,    1.3116330338,    28.7438388715,
    19.1978817171,    5.4957947502,    4.4350865328,    2.2579126330,    1.0242916991,    0.5400241882,    0.4118717240,    7.9063521847,    0.1234368250,    3.0169204569,
    32.4086479294,    4.5385841345,    16.6029920741,    0.0000000000,    1.3119887731,    1.1363630960,    3.9804957980,    4.5447376451,    5.5980623141,    8.6617487548,
    16.3267113057,    4.3388945000,    7.0757281105,    14.8665689658,    5.5900849921,    5.0794938792,    7.8675590783,    5.6015984514,    3.5250572347,    0.8990996065,
    -0.2190416435,    2.7470728056,    3.7132774708,    3.7984288378,    0.4348094511,    1.4553078071,    0.1325348767,    0.1651431565,    0.0568597637,    2.2948643222,
    0.1891706294,    2.6050607780,    2.9116693142,    1.4023765732,    17.6635699290,    0.0033941451,    0.0019092066,    26.1230303352,    0.2435541025,    0.0200276942,
    0.0093714188,    0.0029077189,    6.8949144702,    8.5843853550,    118.6094493000,    0.1341747985,    0.0641155146,    0.1774631251,    0.9761376479,    0.0330502147,
    0.1753690527,    0.0374072542,    0.0184902782,    0.0354134569,    0.0590167916,    0.2356636152,    7.3669532604,    0.0403054731,    0.1998042256,    0.1469361663,
    0.1336718837,    0.0362443836,    0.0612614542,    3.6901777710,    0.1414554518,    0.4902483029,    0.8214014637,    0.6164827111,    5.7632092703,    5.7277133649,
    7.3315003279,    8.1934635775,    5.6462136479,    0.6161997075,    1.3992176534,    52.2280652121,    8.5451634954,    1.2080401710,    3.7227614995,    427.8116166809,
    0.0003182011,    0.0041366143,    1.4831419639,    133.4220859527,    5.8172978264,    0.6099451025,    0.5268494383,    1.0650216169,    1.4766706265,    0.8236654059,
    0.1518434535,    0.4018605674,    19.4365272746,    17.1050520184,    5.8299171009,    5.3853525776,    1.4831419639,    0.6099451025,    5.8172978264,    0.5268494383,
    0.8236654059,    0.1518434535,    1.0650216169,    1.4766706265,    133.4220859527,    2.7631515153,    0.7886648488,    44.1986858626,    0.4522830319,    1.0179396496,
    0.1020119558,    1.2242927229,    2.1881948254,    22343.1673337512,    1.0214158950,    10.8389878633,    0.8856768255,    1.3274776723,    0.2318595336,    1.5520188196,
    2.2022071997,    247.7678229700,    4.7577769199,    0.4284183083,    0.7964886510,    0.1399260078,    0.7157227852,    0.9479452295,    97.7668749738,    3.7273971406,
    5.8510097125,    1.0534310260,    6.2283414970,    8.7253309030,    982.3807905187,    0.5976751725,    0.1373335163,    0.5617919538,    0.7879562053,    79.7133460573,
    0.1909603740,    0.9330862154,    1.2504104287,    122.5712717060,    0.1741072317,    0.2300310381,    20.7661584870,    1.5807082299,    140.7842868846,    198.8220835608,
    4.3894667985,    50.3172457573,    178.0451295784,    0.2809801578,    178.3672660772,    50.3038593029,    33.3555214882,    1.3316979245,    1.7864804227,    1.3838017851,
    2.6247893881
};

static const double COL_STDS[N_NORM_FEATURES] = {
    0.0634170887,    0.0291172846,    0.5969044469,    0.3089195593,    0.2130045779,    0.0704715475,    0.0929643521,    0.4619913297,    0.1992918006,    0.0436759269,
    0.0705187857,    0.4906964115,    0.2884830497,    1.5475489861,    4.9186763578,    0.3283072510,    1.1051185951,    0.6781920786,    0.3048908295,    0.9839562202,
    0.3996768555,    0.8789942166,    0.4077493134,    2.6186264978,    1.6667363925,    0.2192772725,    1.4554916955,    41.5608412430,    1.0949782145,    0.2390954233,
    6.2187763061,    0.3453072700,    0.2728110724,    0.8911201740,    3.5200720992,    0.6728349105,    1.6376949600,    0.1341730754,    9.7637027325,    92.9379464196,
    92.7094620487,    0.1463814570,    0.1493827428,    0.1504599913,    0.3849648473,    0.5611682483,    18.8326380274,    0.9504157760,    0.1969440967,    0.2321914030,
    1.5235733450,    0.5688039202,    0.4048663089,    4.7685016342,    5.4217072388,    2.1385691144,    1.8058736586,    3.7141977589,    3.1813576489,    4.7269043628,
    16.1071367742,    6.8306128779,    6.9292437767,    13.5035463815,    33.9159897222,    19.8424734641,    3.8645314966,    3.0418434556,    12.3922159866,    7.2580183107,
    33.8726828617,    26.2777916194,    9.8658889857,    5.2192895858,    7.8811979056,    6.9083272421,    7.7447069625,    3.6386524898,    1.7290009232,    0.8243668225,
    4.7917443358,    2.1346839077,    25.9966350585,    0.0681696716,    0.0770040826,    0.1280226908,    0.5927459805,    11.0322029410,    184.9821198651,    52.5350241703,
    126.2111178572,    171.6407961343,    130.3439775405,    726.6856300771,    591.0604101094,    802.7129889276,    689.5749973751,    560.4197824589,    1224.5048508042,    7242.8232054537,
    391.3477668511,    27.5669500982,    43.6222594929,    5.3764659279,    4.8622604302,    0.6603016820,    0.6550823899,    4.3473420142,    5.0153536955,    4.1582468559,
    68.0548223271,    41.9882210188,    24.2372628201,    55.0083906941,    56.6737387822,    1.6270361044,    1.3181857815,    1.9605360491,    2.0058101149,    0.5332258467,
    0.5171536160,    19.9937667929,    77.4055422419,    85.9909034428,    0.2023681289,    0.1570418887,    0.1589061467,    0.1521764755,    0.1276142290,    45.2459730701,
    19.7725523256,    27.2644186433,    31.3909445889,    27.0878650848,    4.5455092860,    3.4264937788,    4.3784402454,    6.2661196004,    21.2281725057,    21.5096295936,
    23.7831865408,    20.9810259721,    439.9369012794,    164.4564290999,    884.4048034916,    88.8041677247,    507.9913504087,    473.8136683419,    493.7591371950,    471.0538073856,
    0.2993993952,    0.8717058017,    0.9863690790,    1.4669615126,    1.4646479706,    1.6302931376,    1.2869364238,    0.8173433779,    2.5285315047,    2.3707595225,
    1.9716725594,    28.9044779143,    6.1071648710,    16.2684733723,    17.1403827826,    14.3552122051,    11.0598003665,    0.0096576464,    0.0048483707,    0.0051871997,
    0.0080138131,    0.0086921811,    1.6188174444,    0.6881563058,    1.6122158668,    0.1695578994,    0.0924889377,    0.1442844075,    2.4557682809,    0.4853640635,
    0.7660511738,    1.1053433660,    10.4724968665,    60.1038326742,    3.8147768300,    10.5023239275,    15.9716654126,    0.0496536035,    0.0477368665,    0.0404666859,
    0.0543656074,    0.1110222395,    0.0982846826,    0.0795087626,    0.3717311160,    0.4196361090,    0.6407675683,    0.5171476892,    0.2316673024,    0.1840347598,
    0.2440377796,    0.1878276902,    0.2276476681,    0.3542731064,    0.3729765752,    0.2294418900,    0.1407417935,    0.2287790100,    0.1615683118,    0.4185598992,
    0.0965770239,    0.1866729077,    0.2049365350,    0.1875763223,    0.1810460085,    0.1845873534,    0.1946514738,    0.2365372235,    0.1890860937,    0.2011968671,
    0.2551708910,    0.1804750585,    0.1877710156,    0.2559595528,    0.2872160958,    0.3207573566,    0.3431028584,    0.6196866489,    0.7461352543,    0.6805102976,
    0.3271402698,    0.6287048645,    0.3515105245,    0.4416088158,    0.3978250240,    0.4811285602,    0.4532267113,    0.2969175757,    0.3575100515,    0.4775617232,
    1.0170301297,    0.2896827592,    0.6758250231,    0.2912997371,    0.2231638454,    0.2881769416,    0.3180416610,    0.3419355898,    0.3740792178,    0.4557925783,
    0.6661607359,    0.8102082148,    0.8464610057,    0.3357864456,    0.7531323783,    0.3161415255,    0.2222507707,    0.0979658766,    1.2170050564,    0.6111027532,
    0.2591063466,    8.0272344100,    0.4068657027,    2.4913810641,    0.3898235111,    0.0698827931,    0.2354580518,    65.1609596628,    0.6996950307,    4.1018885720,
    0.3723736198,    1.0027612637,    0.1899351382,    0.7743082275,    0.3953058703,    0.9085640064,    0.3144433288,    0.3159496397,    0.1215168846,    2.2435678745,
    3.3157114007,    5.6444448241,    1.7213955010,    6.3586618783,    17.8329525941,    4.4720456605,    3.0041110357,    2.7689002180,    2.3645577451,    1.9755580878,
    1.6369697661,    1.1919972428,    0.8632450808,    0.0481022056,    0.0493489544,    0.0585627398,    0.0613650155,    0.0592833716,    0.0501896940,    0.0391900695,
    0.0287355414,    4.0276291417,    2.6819004287,    2.2957631589,    1.9870258412,    2.6484908514,    3.4390107658,    6.1463895400,    5.4252879900,    0.1247854819,
    0.1253614241,    0.1500828210,    0.1228830986,    0.1010122531,    0.0815743593,    0.0716826953,    0.0802807388,    8.1391271300,    7.7377359437,    8.4466017691,
    15.4365920248,    5.1007643965,    1.0000000000,    0.7810207053,    0.0692572585,    0.6724514223,    45.3218199880,    0.9814216271,    1.1737798807,    1976.2955318239,
    137.4363317442,    68.7116899253,    103.3088707566,    137.4363317442,    3.2640736352,    68.7113135080,    0.7767950638,    0.0693988433,    0.6716364214,    46.0465612423,
    1.0183687222,    1.1786466322,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.5475643796,    0.9434575838,
    2.5793608484,    1.1051185951,    0.0901249662,    0.2716352521,    0.8754223774,    1.5673331399,    1.0000000000,    0.0252189849,    0.2907404599,    0.1511112437,
    0.3283072510,    0.2418061108,    0.2283955024,    0.1573904345,    1.0000000000,    0.6901979077,    1.8602783643,    1.2109456636,    0.6799795343,    0.9269183335,
    0.5683685922,    3.8705916561,    0.4368212076,    0.5379202349,    0.2167160754,    2.6401865271,    2.6874264773,    0.5660775514,    0.1095538676,    0.4028271078,
    0.7520530592,    0.6716585325,    3.0147756452,    0.3336382759,    0.0074387061,    0.1605969500,    0.0456292850,    0.2910324047,    0.1450663166,    40.4319360881,
    0.2729763945,    0.4734037550,    0.6765035369,    0.7341151278,    17.6814423971,    30.5212631534,    47.8599213086,    0.6835929897,    9.1574478253,    11.2367788252,
    11.3671023350,    23.0426085571,    0.3088709011,    0.4727128208,    75.6208518150,    3.7141977589,    3.1813576489,    8.1720603705,    4.7269043628,    31.5651714026,
    16.1071367742,    6.8306128779,    6.9292437767,    4.6434315221,    3.2521561925,    2.1385691144,    1.8058736586,    10.4236003510,    0.9167077629,    6.1145032182,
    33.9159897222,    7.3295237909,    19.8424734641,    1.0000000000,    3.8645314966,    3.0418434556,    9.5164780059,    6.8578410084,    7.4214211916,    9.8658889857,
    28.3345833054,    8.0622145754,    11.7495331711,    16.5192298522,    10.5907817092,    9.2319281433,    23.7422252856,    7.8811979056,    6.9083272421,    2.0492311328,
    4.3816909511,    4.9959191251,    7.7447069625,    3.6386524898,    1.3061838656,    2.9435612795,    0.4633419855,    0.4698348893,    0.1318111309,    2.6680712463,
    0.1993812747,    0.4885841258,    0.6534079815,    2.2336912248,    10.9196178975,    0.0617000244,    0.0482683093,    27.7248591323,    0.1380957623,    0.0194960323,
    0.0115885218,    0.0053861440,    0.9296352415,    1.0728581288,    81.4572854127,    0.5119767194,    0.2780822249,    0.3257622747,    0.7525640946,    0.3444182269,
    0.7178998506,    0.2456947135,    0.2341285189,    0.1973744049,    0.6738189599,    1.2458849193,    8.9131416961,    0.2363552442,    0.5259712376,    0.6651711769,
    0.3422822270,    0.2353117433,    0.3189641010,    3.1103884162,    0.2786961479,    0.4400345410,    0.6038668281,    0.6344529556,    3.1956566951,    3.6356169318,
    30.7936773539,    2.0776936620,    1.2225352736,    0.3544150554,    0.3963473390,    26.4211158598,    1.0756824781,    0.9421431971,    0.6292051587,    1665.3730899264,
    0.0178353540,    0.0674074988,    0.7506273577,    67.3922422374,    3.2183430304,    0.6454702323,    0.4179864845,    0.3000361285,    0.0873995770,    0.5826791131,
    0.2809902516,    0.1204642234,    3.6657274540,    1.7380124943,    4.2719481561,    3.7689609525,    0.7506273577,    0.6454702323,    3.2183430304,    0.4179864845,
    0.5826791131,    0.2809902516,    0.3000361285,    0.0873995770,    67.3922422374,    4.1983460204,    1.5932163893,    70.0709475454,    1.1133273339,    1.6754362829,
    0.3603080343,    0.8488451540,    0.2613277093,    31225.6960047263,    1.6680815778,    16.5919625477,    1.4550930805,    1.8005122597,    0.6089473802,    0.8276263484,
    1.1361219249,    359.9418284815,    8.3934179189,    1.0389224122,    1.4468933433,    0.4846744700,    0.9591466673,    1.0334313769,    159.3665380755,    7.0806771796,
    8.9488499755,    3.0857830284,    4.0859913635,    5.0505581103,    1438.2764859234,    1.1987018941,    0.4739254316,    0.5086014282,    0.6471789742,    130.0674510052,
    0.5645048051,    0.8222504166,    0.9322851723,    165.5675289719,    0.3523301038,    0.4344301628,    53.9505408348,    0.4929271142,    79.7201313969,    103.7154905758,
    3.2869942163,    25.9966350585,    87.3494180192,    0.0438951458,    88.3893690597,    26.0587867131,    16.8480605593,    0.2712584817,    0.3552502016,    0.2751756229,
    0.5155823933
};

// Selected feature indices
constexpr int N_SELECTED_FEATURES = 502;
static const int SELECTED_FEATURES[N_SELECTED_FEATURES] = {
    4,    7,    15,    16,    17,    19,    24,    26,    27,    31,    34,    35,    64,    66,    67,    75,    78,    83,    87,    89,
    93,    97,    98,    111,    122,    138,    155,    159,    183,    193,    215,    223,    225,    230,    291,    293,    294,    295,    296,    297,
    299,    302,    303,    304,    306,    308,    309,    310,    312,    313,    315,    316,    317,    335,    338,    341,    342,    344,    345,    347,
    349,    350,    351,    353,    357,    359,    361,    362,    366,    368,    369,    374,    380,    387,    388,    389,    393,    394,    399,    410,
    419,    421,    422,    443,    468,    477,    518,    531,    545,    553,    561,    567,    569,    570,    572,    573,    575,    578,    580,    592,
    601,    625,    626,    645,    648,    654,    656,    662,    663,    668,    669,    671,    673,    690,    692,    700,    708,    710,    719,    725,
    730,    735,    739,    740,    742,    743,    744,    746,    747,    750,    751,    752,    756,    758,    760,    761,    765,    769,    770,    771,
    772,    774,    777,    780,    789,    796,    797,    800,    802,    803,    805,    807,    808,    818,    824,    826,    829,    832,    833,    836,
    839,    840,    841,    842,    843,    845,    848,    850,    852,    853,    855,    856,    858,    859,    865,    868,    869,    873,    876,    877,
    878,    880,    887,    896,    904,    907,    911,    917,    919,    923,    933,    942,    943,    947,    949,    950,    954,    955,    957,    958,
    964,    966,    968,    970,    971,    973,    974,    978,    981,    995,    1005,    1007,    1008,    1014,    1015,    1022,    1023,    1024,    1030,    1040,
    1041,    1045,    1048,    1052,    1053,    1054,    1055,    1058,    1059,    1060,    1063,    1068,    1069,    1070,    1072,    1075,    1077,    1078,    1079,    1080,
    1083,    1087,    1092,    1101,    1102,    1104,    1109,    1110,    1111,    1112,    1113,    1114,    1116,    1119,    1122,    1125,    1142,    1149,    1151,    1152,
    1156,    1157,    1158,    1162,    1167,    1168,    1172,    1188,    1219,    1258,    1305,    1311,    1312,    1313,    1314,    1315,    1316,    1317,    1318,    1319,
    1320,    1321,    1322,    1323,    1324,    1325,    1326,    1327,    1328,    1329,    1330,    1331,    1332,    1333,    1334,    1335,    1336,    1337,    1338,    1339,
    1340,    1341,    1342,    1343,    1344,    1345,    1346,    1347,    1348,    1349,    1350,    1351,    1352,    1353,    1354,    1355,    1356,    1357,    1358,    1359,
    1360,    1377,    1379,    1380,    1381,    1382,    1383,    1384,    1385,    1386,    1387,    1388,    1389,    1390,    1391,    1392,    1393,    1394,    1395,    1396,
    1397,    1398,    1399,    1400,    1401,    1402,    1403,    1404,    1405,    1409,    1410,    1411,    1412,    1413,    1414,    1415,    1420,    1421,    1422,    1426,
    1427,    1428,    1429,    1430,    1431,    1432,    1510,    1512,    1514,    1515,    1527,    1535,    1548,    1584,    1586,    1598,    1600,    1616,    1631,    1685,
    1712,    1714,    1797,    1810,    1837,    1839,    1843,    1845,    1846,    1849,    1854,    1855,    1857,    1858,    1860,    1861,    1862,    1882,    1885,    1888,
    1889,    1890,    1899,    1900,    1901,    1904,    1905,    1906,    1907,    1908,    1909,    1910,    1911,    1912,    1913,    1914,    1915,    1916,    1917,    1919,
    1920,    1921,    1922,    1923,    1924,    1925,    1936,    1937,    1938,    1939,    1940,    1941,    1942,    1943,    1944,    1945,    1946,    1947,    1948,    1949,
    1950,    1951,    1952,    1953,    1962,    1963,    1966,    1967,    1982,    1983,    1984,    1997,    1998,    2006,    2009,    2027,    2033,    2153,    2164,    2168,
    2169,    2171,    2186,    2200,    2210,    2230,    2261,    2268,    2274,    2373,    2377,    2379,    2430,    2472,    2495,    2512,    2669,    2780,    3040,    3053,
    3076,    3092,    3502,    3764,    3765,    3766,    3768,    3769,    3770,    3774,    3782,    3783,    3785,    3800,    3812,    3819,    3829,    3835,    3848,    3849,
    3989,    4030
};

// Feature order metadata
constexpr int N_CASCADE_FEATURES = 14;
constexpr int N_PHYSICS_FEATURES = 65;
// Cascade feature names (in order)
static const char* CASCADE_FEATURE_NAMES[N_CASCADE_FEATURES] = {
    "V",
    "Polarizability",
    "L",
    "E",
    "B",
    "Density",
    "RI",
    "S",
    "A",
    "Modularity",
    "HansenTotal",
    "dD",
    "dH",
    "dP",
};

// Physics feature names (in order)
static const char* PHYSICS_FEATURE_NAMES[N_PHYSICS_FEATURES] = {
    "lsfer_0",
    "lsfer_1",
    "lsfer_2",
    "lsfer_3",
    "lsfer_4",
    "lsfer_5",
    "lsfer_6",
    "lsfer_7",
    "lsfer_8",
    "lsfer_9",
    "lsfer_10",
    "lsfer_11",
    "lsfer_12",
    "lsfer_13",
    "lsfer_14",
    "lsfer_15",
    "lsfer_16",
    "lsfer_17",
    "lsfer_18",
    "lsfer_19",
    "lsfer_20",
    "lsfer_21",
    "lsfer_22",
    "lsfer_23",
    "lsfer_24",
    "lsfer_25",
    "lsfer_26",
    "lsfer_27",
    "lsfer_28",
    "lsfer_29",
    "lsfer_30",
    "lsfer_31",
    "lsfer_32",
    "lsfer_33",
    "lsfer_34",
    "lsfer_35",
    "lsfer_36",
    "lsfer_37",
    "lsfer_38",
    "lsfer_39",
    "lsfer_40",
    "lsfer_41",
    "lsfer_42",
    "lsfer_43",
    "lsfer_44",
    "lsfer_45",
    "lsfer_46",
    "lsfer_47",
    "lsfer_48",
    "lsfer_49",
    "lsfer_50",
    "lsfer_51",
    "lsfer_52",
    "lsfer_53",
    "abraham_odt_eq",
    "phys_MR",
    "phys_Vm",
    "phys_fn",
    "phys_Parachor",
    "phys_epsCM",
    "phys_alpha",
    "phys_dD",
    "phys_dH",
    "phys_dP",
    "phys_delta",
};

// Prediction function using Treelite compiled library
// TL2cgen generates: size_t predict(union Entry* data, size_t num_row, float* result)
// Library path: /Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/bp_v34_treelite.dylib
extern "C" {
    // Forward declaration of TL2cgen prediction function
    typedef struct {
        float missing_value;
        float fvalue;
    } Entry;
    
    // Function pointer type for prediction
    typedef size_t (*PredictFunc)(Entry* data, size_t num_row, float* result);
}

// Load library and get prediction function (called once at initialization)
static void* lib_handle = nullptr;
static PredictFunc predict_func = nullptr;

static bool load_treelite_library() {
    if (lib_handle != nullptr) return true;  // Already loaded
    
    const char* lib_path = "/Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/bp_v34_treelite.dylib";
    lib_handle = dlopen(lib_path, RTLD_LAZY);
    if (!lib_handle) {
        return false;
    }
    
    // Get prediction function
    predict_func = (PredictFunc)dlsym(lib_handle, "predict");
    if (!predict_func) {
        dlclose(lib_handle);
        lib_handle = nullptr;
        return false;
    }
    
    return true;
}

inline double predict(const double* features) {
    // Ensure library is loaded
    if (!load_treelite_library()) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Normalize features
    double normalized[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        normalized[i] = (features[i] - COL_MEANS[i]) / COL_STDS[i];
    }
    
    // Convert to TL2cgen Entry format
    Entry data[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        data[i].missing_value = -1.0f;  // No missing values
        data[i].fvalue = static_cast<float>(normalized[i]);
    }
    
    // Call Treelite prediction
    float result[1];
    size_t num_output = predict_func(data, 1, result);
    if (num_output == 0) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Denormalize target
    double pred_norm = static_cast<double>(result[0]);
    double pred = pred_norm * TARGET_SCALE + TARGET_MEAN;
    
    return pred;
}

} // namespace CascadeBP
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit

// Wrapper struct for template parameter (C++ doesn't allow namespaces as template parameters)
// Must be outside the namespace to reference it
namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadeBP {
struct Model {
    using Namespace = CascadeBP;
};
} // namespace CascadeBP
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit
