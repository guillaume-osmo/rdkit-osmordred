#pragma once
// Auto-generated Treelite model for dD (v3.4 XGBoost)
// Trees: 300, Features: 587
// Target normalization: mean=17.1895529530, scale=1.8032977603
// Library: dd_v34_treelite.so

#include <vector>
#include <cmath>
#include <algorithm>
#include <dlfcn.h>  // For loading shared library
#include <limits>

namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadedD {

constexpr int N_TREES = 300;
constexpr int N_FEATURES = 587;
constexpr double TARGET_MEAN = 17.1895529530;
constexpr double TARGET_SCALE = 1.8032977603;

// Normalization stats
constexpr int N_NORM_FEATURES = 587;
static const double COL_MEANS[N_NORM_FEATURES] = {
    0.0210300970,    0.2332199975,    0.0635940058,    0.1059060572,    0.0023926458,    0.0797128825,    0.0287117491,    0.0243042438,    1.6903412668,    3.0379045460,
    0.0109557990,    0.0721571590,    0.6638962347,    0.3741342400,    0.0787054527,    0.5521974562,    0.0601939302,    0.4008311296,    0.0064223649,    0.0227930991,
    0.0624606473,    0.0159929480,    0.1009948369,    0.0180078076,    0.0410527641,    1.9783402594,    1.4532174789,    0.0002518574,    0.3479410654,    0.0192670948,
    0.0402971918,    0.3305629014,    1.5074927591,    0.7312681023,    8.2553378339,    0.5156439006,    15.2176896507,    185.1291647148,    184.8261450675,    -0.3211904100,
    0.3347055277,    0.1660862798,    1.1919419812,    1.7227748286,    2.0841268436,    23.4881710977,    2.0800792506,    -2.0528056144,    -2.0375781990,    0.2604941892,
    2.0012236111,    2.9148943424,    7.9830046163,    4.2850566298,    4.5897526526,    3.1652511438,    -0.6559816144,    5.1866616119,    2.4975721651,    2.3073878397,
    1.2288797965,    26.6240155202,    18.8746660577,    9.6146865859,    0.8396087426,    3.0748555696,    4.7392960850,    16.8374126392,    12.7904030132,    28.2386254936,
    13.6895681601,    25.3907366830,    4.4262942587,    5.6556887860,    5.8921911320,    8.6266744506,    14.2248216806,    7.4797182396,    13.7106537598,    5.8104601695,
    6.0144064228,    3.5944934962,    0.8510384257,    3.6736415903,    0.6155096127,    0.5006926080,    0.5443898753,    3.4571212694,    0.3988162700,    2.6737521937,
    49.4834324644,    0.1472106788,    0.2042563909,    0.0156151618,    0.0374008311,    0.0026445032,    0.0551567813,    0.3388741972,    129.3386294083,    127.5205249151,
    75.0066426529,    59.8855363847,    788.4051127062,    2271.7205261732,    3291.3908716368,    2027.1030005528,    3871.1067118969,    316.6832795070,    163.5206926961,    288.3177562020,
    3873.7776157625,    3.4345331573,    2.6576490096,    2.7496098716,    3.1001090654,    3.5683509775,    36.1417768629,    25.6953210038,    20.0154840924,    10.2045042989,
    98.5291918079,    92.7903635810,    76.2195150049,    46.9033358709,    204.3056815750,    193.2375074605,    160.6979195712,    6.4518850322,    6.4487079200,    6.2928829297,
    6.2918942408,    5.0108394551,    1.4367654891,    1.2337590962,    167.7020535978,    158.6221907709,    163.1663967301,    159.7239397276,    0.3907302798,    0.0002108502,
    -0.0045593285,    0.0126208464,    4.3093222525,    -16.4617840568,    -4.0411920734,    -3.1981018099,    306.0912012225,    -3.0893044688,    -29.2538162433,    -11.9753596781,
    3.5448156496,    -22.6197761463,    1312.2246694063,    -93.3823256859,    2.9836732208,    -62.2404209364,    -0.0902567282,    -0.2100763966,    -0.0396730102,    -0.0870389532,
    -0.3646917440,    -0.1585040114,    6.8840609998,    -0.2898732474,    -0.9964793216,    -0.3233293534,    0.0182272530,    0.2348227557,    41.2781185044,    -3.1083724254,
    0.0171688395,    -0.0001789552,    0.0001488122,    0.7427315538,    -0.4452809035,    -0.1997700269,    -0.0801390674,    -0.0392407480,    0.0029944398,    -0.2197295237,
    0.1744770722,    -0.1641333903,    -0.2254237542,    -0.4399606481,    -0.6255132816,    -1.9677420756,    -3.8982269687,    1.6691578374,    0.0887276212,    -0.0059113474,
    -0.0107982188,    -0.0062632392,    0.0100853362,    -0.0111928286,    -0.0119484228,    -0.0136980079,    -0.0074786895,    -0.0143370994,    -0.0152689053,    -0.0371943509,
    -0.0213515488,    0.0189920843,    1.7360354649,    -0.1707897217,    -0.2087191438,    -0.1045496069,    -0.0291844632,    0.0027651503,    0.0286067921,    0.0385313011,
    0.2291070112,    -0.0303963111,    -0.0665986687,    0.2052297274,    -0.1672770271,    -0.1293528131,    -0.0701822806,    -0.0073153403,    0.0043308026,    -0.1120446918,
    -0.0970714345,    0.0684015114,    -0.0078322263,    0.0036906124,    -0.0452765319,    -0.0780202574,    -0.0351373078,    -0.0996396366,    -0.0740646957,    -0.0288858529,
    0.0221338474,    -0.0275968994,    -0.0338407917,    -0.0637181376,    -0.0645729511,    -0.1192814949,    -0.0596245680,    1.4282848002,    1.0061826781,    0.9860181274,
    0.7527382606,    1.1128060572,    1.0572901299,    1.2003821238,    1.5373536732,    1.1566570113,    0.8988195240,    1.0017906119,    0.9668763611,    0.9541928093,
    1.0491149960,    0.9716524818,    0.7158128348,    1.0863776001,    1.1956326609,    0.8782290139,    1.0385756497,    0.8949202861,    0.8621168309,    1.0896477940,
    1.1085953210,    0.9716992908,    0.7030673974,    1.3595594708,    1.0971867731,    5.3942858439,    3.2359807001,    0.9967423520,    1.2148398294,    5.7703411226,
    11.7927466216,    15.8508967892,    3.5805445493,    2.3044481227,    2.2507619325,    0.8977846569,    13.7983308783,    2.6296370994,    5.1820799077,    0.6204643955,
    60.2730303224,    0.5232081182,    0.9079461025,    0.3526456395,    0.2168564217,    2.4490618310,    0.5989170130,    2.2280569198,    2.7970028964,    0.4649288503,
    0.1226545775,    0.6205064541,    0.6155096127,    0.0041109055,    0.0079137160,    0.0284737006,    0.0960618380,    0.1628989076,    0.0065739281,    0.0203719781,
    0.0538742407,    0.0861398817,    0.9937508764,    0.0866221021,    0.3175817767,    0.0989082279,    0.5685449073,    0.0496463899,    0.1090384789,    1.8241350985,
    2.3648158668,    3.2293587729,    0.8871491766,    1.0509950379,    1.2550298932,    9.3004069230,    5.7515106821,    5.0105453962,    3.5292433063,    2.4245823175,
    1.6260363273,    0.9667785285,    0.5495318121,    0.7735768942,    0.4946676462,    0.3482370437,    0.2328044015,    0.1502940680,    0.0910432754,    0.0569814326,
    0.0333178224,    7.9838093934,    4.5917445531,    3.5186000071,    2.2410298236,    1.4016471156,    0.8507997276,    0.4778011456,    0.2473741459,    0.6707366383,
    0.4013567876,    0.2566578073,    0.1583823012,    0.0958839510,    0.0314363018,    0.0929353986,    0.3641670405,    0.0505729495,    -1.2455442284,    6.0221297118,
    1.3389121183,    0.0994913700,    0.0938181924,    0.4859263237,    1.0443506435,    0.5928489896,    0.3311112529,    2.0128173349,    1.9666390887,    1.4060095385,
    0.1934331648,    0.0034277433,    1.6096347006,    1.1242003111,    1.1564645059,    0.4878992893,    0.3190566559,    0.1888999965,    0.0149879868,    11.0286679415,
    0.8368087233,    0.4699349775,    0.4413128887,    0.0215098192,    0.3307161835,    0.5873663614,    0.1673557269,    2.0960676400,    3.5935883529,    0.6671751976,
    0.2965663072,    0.7397497804,    0.7661776157,    0.9897724212,    14.6808368044,    27.4893770794,    29.2045400440,    29.7217806742,    29.6582850385,    45.8924438470,
    34.4086633400,    29.2236167244,    26.0089446729,    24.7113523851,    23.8073728158,    10.8009485140,    5.6613747137,    4.8966481153,    0.9073164589,    0.3466817781,
    145.7717227049,    76.2619463038,    4.5473354379,    2.3073878397,    1.3532132987,    2.5749953147,    1.2288797965,    26.6240155202,    18.8746660577,    5.5529324594,
    4.7214025180,    2.4975721651,    1.1385743581,    0.6222088548,    0.4585489903,    0.1133828264,    0.8396087426,    3.0748555696,    30.3249885645,    4.7392960850,
    16.8374126392,    0.0000000000,    1.3290046783,    1.1995386455,    12.7904030132,    4.5746413652,    4.3616736621,    28.2386254936,    13.6895681601,    1.5240163938,
    0.3454377270,    4.8000502588,    0.4100264156,    0.6595904487,    0.0580376582,    2.9779089369,    2.0509676007,    0.0173781640,    0.2797088667,    27.7105893464,
    0.0885830147,    0.9830663982,    5.3773856497,    114.4692371238,    0.1327288755,    7.9350207782,    1.3226585131,    1.4913446950,    0.3833694935,    3.9100344360,
    0.0658787264,    0.2859970035,    0.4606179953,    0.0539858235,    0.3341861033,    0.1732614049,    0.1092162501,    0.1885786558,    0.0918906896,    0.0622379666,
    0.0717599851,    0.0445015499,    1.8330928854,    0.2590195091,    0.2822090020,    0.0122996051,    0.0149736692,    0.0130493257,    0.0075251047,    0.0908722315,
    7.8659253166,    0.2490870167,    0.1938043068,    0.9163833270,    0.1180961373,    0.4819511403,    0.0410644152,    0.0530027096,    0.0612687187,    0.0396092715,
    0.1800197600,    0.4533418807,    0.0154012213,    0.5433669404,    0.2595999061,    0.1434263947,    0.5089701549,    0.8522364941,    0.6249842589,    5.7111382697,
    6.0903509646,    5.6671421998,    0.6181300760,    2.6303499746,    5.0931429265,    2.3474769610,    8.5703821235,    960.7011539020,    1.2172738114,    2.1980610016,
    3.7344152879,    0.1696259917,    1.4580408668,    131.3191661671,    5.7597828346,    0.6182368213,    0.5455426893,    1.0775670350,    1.4801189262,    0.8561887095,
    0.1555690020,    0.4014455057,    19.6012377937,    1.4580408668,    0.6182368213,    5.7597828346,    0.5455426893,    0.8561887095,    0.1555690020,    1.0775670350,
    1.4801189262,    131.3191661671,    2.6293858522,    0.8203569832,    43.3709486187,    0.4874863056,    1.1083354017,    0.1072077855,    1.2513471193,    2.1989764171,
    21454.4487942777,    1.0504718269,    10.4611563171,    0.9269530264,    1.3886626250,    0.2346478188,    1.5491266592,    2.1730442473,    236.8348340084,    4.9406832043,
    0.4662380393,    0.8525109915,    0.1523092843,    0.7260602096,    0.9667828961,    100.5323802153,    3.9475903013,    6.1836839500,    1.0875103785,    6.2469589522,
    8.6802228948,    952.6435103445,    0.6531656517,    0.1454327018,    0.5889671869,    0.8194354870,    83.5615013436,    0.2066917391,    0.9757861957,    1.3047506470,
    128.2315950044,    0.1827993075,    0.2371976453,    21.1388737287,    1.6025083769,    140.5309218015,    196.4810404530,    4.2262865559,    49.4834324644,    175.0342300678,
    0.2826177433,    173.8976845266,    49.8610390045,    32.8297915418,    1.3429454438,    1.7971061070,    1.3920324048,    2.6421122759,    17.3050293109,    2.1989764171,
    1.1083354017,    17.2808272406,    2.1989764171,    0.8203569832,    0.0000000000,    0.0000000000,    0.0000000000
};

static const double COL_STDS[N_NORM_FEATURES] = {
    0.2303854224,    0.6107458745,    0.3183679392,    0.4818756387,    0.0513690418,    0.5189449238,    0.1909202395,    0.1782497851,    1.5230070028,    4.3575783352,
    0.1392800156,    0.3621797245,    1.1597030226,    0.6830975301,    0.3555395877,    0.7500672979,    0.3196198042,    1.0310110669,    0.0902447800,    0.2818602749,
    0.3863003965,    0.1517927522,    0.3334596425,    0.1515669254,    0.2480542081,    2.6334732346,    1.7034181320,    0.0158680187,    0.6882574955,    0.1410790689,
    0.3413169784,    0.6694883351,    5.5664501802,    1.2881394050,    3.4646774856,    0.1327989451,    9.8957151661,    91.8738121496,    91.6400275961,    0.1459739169,
    0.1464755629,    0.1219943979,    0.3791149975,    0.4764563002,    0.5577689668,    18.1671208117,    0.2698469257,    0.2001474999,    0.2663310803,    0.5639488400,
    0.4091752778,    0.7017342247,    3.8656810333,    2.5187057501,    2.5373720866,    2.0657359813,    0.7931202794,    4.2326378718,    4.9511722942,    3.8860426131,
    4.4515815667,    28.1721074885,    16.0944539459,    13.6400852446,    2.7980067448,    6.2549699991,    7.2012912984,    19.7880577266,    12.7280173815,    30.2602326356,
    16.4816106732,    27.0205210733,    10.0024071128,    9.8144569952,    7.6276555291,    9.6168429165,    24.3936004257,    12.0471781168,    15.4143455709,    10.9874263519,
    8.1957057715,    7.0984213737,    2.0377185350,    3.6029235911,    0.3505204252,    0.9770858006,    1.2273179509,    4.3326985546,    0.9426275195,    1.9621666237,
    24.9159139049,    0.5150927866,    0.6056336422,    0.1318566954,    0.2152397834,    0.0537528349,    0.2900007013,    0.8125611219,    249.3760398626,    134.6061569779,
    37.2036517247,    136.6814515192,    806.8194537799,    1221.1679861450,    2645.2553060300,    2687.5159231157,    6343.5910466040,    371.1964828413,    89.4657911627,    171.1449592549,
    2188.6358652203,    5.8194098463,    0.7905221396,    0.7729893572,    1.2749591514,    6.6984097381,    64.7837560914,    19.6350768012,    27.3750634704,    18.7592880699,
    95.5230331269,    252.5256820841,    132.3780528193,    98.4782910982,    51.2938372524,    54.5996543396,    53.1357339663,    2.9209301676,    0.6481254818,    1.3993175200,
    0.6664214757,    2.4846114565,    0.5441193876,    0.4015625623,    15.5745091779,    14.5020918431,    20.8372034759,    46.4756693453,    0.3652348509,    0.1738779605,
    0.1558550370,    0.1378929532,    28.1056091251,    31.5810240226,    23.4379756073,    18.5162370127,    411.7082948526,    125.3904014621,    119.0287243468,    122.8192970915,
    182.5195866189,    656.2587077921,    783.1698258776,    458.8872403353,    461.7646462854,    464.3543218401,    0.3159386563,    0.9444045531,    0.6473045834,    0.3939199203,
    1.4081756032,    1.3747474602,    4.1679339750,    0.8369275028,    2.6150977321,    2.3346822737,    2.2418153288,    1.7826204157,    29.5584575539,    6.4172425518,
    0.0165306606,    0.0054529220,    0.0066247806,    0.6859746152,    0.9548255258,    1.6809913868,    0.0954409181,    0.1175616393,    0.1332145336,    0.4507389213,
    0.8124717476,    0.9700361411,    5.8811549946,    7.8602923842,    11.7261055562,    8.0844748493,    10.4047214585,    16.2647165818,    0.0913366940,    0.0205145803,
    0.0458781768,    0.0245968010,    0.0439090391,    0.0506545871,    0.0589595544,    0.0908554525,    0.0844555349,    0.0507497036,    0.0744653337,    0.0847945967,
    0.0883667945,    0.0783637334,    1.5092321832,    0.3834021184,    0.5561980370,    0.5814886589,    0.1846802977,    0.2067007623,    0.2659816828,    0.2383220360,
    0.1894796017,    0.1909830285,    0.3042649440,    0.2318935008,    0.1419691168,    0.1558411366,    0.1851702019,    0.0904385566,    0.1660398842,    0.1929051222,
    0.2307911191,    0.3691843545,    0.0880280062,    0.1663482216,    0.0956936704,    0.2075067383,    0.1221973242,    0.2267353821,    0.2922251912,    0.3515202769,
    0.2929916208,    0.1138506033,    0.1202151586,    0.1466067167,    0.1750993989,    0.1914254194,    0.1928629115,    0.2888452926,    0.3135922486,    0.3772764447,
    0.6044882615,    0.3891354899,    0.4167899131,    0.3533114598,    0.4399009284,    0.3694492947,    0.4045673615,    0.3549219740,    0.3104083557,    0.2474614093,
    0.3629933394,    0.5249940139,    0.7944751242,    0.2882071305,    0.2903890310,    0.3105728227,    0.6669436870,    0.3030328790,    0.7466124142,    0.4468857161,
    0.3038939768,    0.3469562758,    0.5653761168,    0.3142236859,    0.2754546445,    1.2069032614,    0.5432994298,    0.1222809291,    0.2542815945,    0.3910902306,
    0.8737403041,    2.4100644719,    0.2930208937,    0.0647581355,    0.0660754372,    0.2982492039,    1.5303132132,    0.7481745993,    2.9436796525,    0.7378076607,
    84.3406682837,    0.7824220596,    1.0365264978,    0.1612601704,    0.1144871501,    3.2534821563,    1.0697586949,    1.7523973511,    4.2260871026,    0.9413932319,
    0.4211590500,    0.3526582158,    0.3505204252,    0.0331893133,    0.0553090894,    0.1051303784,    0.2010597513,    0.3752473806,    0.0481633507,    0.0871652950,
    0.1578590876,    0.2914830530,    1.0221281390,    0.1932505516,    0.8198150500,    0.4221885175,    0.7899854290,    0.2858276297,    0.2758398340,    2.3392977363,
    3.4374555491,    5.8270373561,    1.2021831713,    1.8303695383,    2.8634637469,    4.3921187269,    2.9273991705,    2.7811246761,    2.4076408042,    2.0110779591,
    1.6591329515,    1.1968961066,    0.8567766698,    0.0486451325,    0.0499781855,    0.0590236867,    0.0622130870,    0.0605669867,    0.0506905424,    0.0391392675,
    0.0283232751,    3.8655855015,    2.5369105394,    2.1457258720,    1.7160129209,    1.3575813975,    1.0225047820,    0.7187443979,    0.4657982586,    0.1253011137,
    0.1269212340,    0.1503254014,    0.1147588212,    0.0989400575,    0.0470318765,    0.3297401747,    1.2112985443,    1.2726663680,    6.5619451520,    8.4482126385,
    5.2840722609,    0.7912824709,    0.5936945898,    2.2559361657,    3.7601076225,    2.7548998046,    1.0471130836,    3.7664289939,    4.2329168061,    0.8894572474,
    0.4542782222,    0.1544125851,    2.3129607909,    3.4257682863,    3.0257629133,    0.0653760743,    0.1769749777,    0.1267362094,    0.0363749008,    9.5925510333,
    0.3035080713,    0.0196928957,    0.3173100295,    0.0193964993,    0.3122113067,    0.1427380354,    0.1849556412,    0.4754049385,    0.8223887208,    0.1349192691,
    0.1032646548,    0.1201839646,    0.1176955358,    0.6339016031,    8.5884450663,    10.0060562758,    10.8777800847,    11.2797075824,    11.4907663711,    22.3005754860,
    18.1855809540,    16.2759091048,    14.1326728662,    12.8292650783,    12.1149063964,    5.4777812807,    4.3265999400,    4.4432084722,    0.2899884520,    0.4759133564,
    71.5007985492,    36.3905908322,    5.5811096606,    3.8860426131,    3.3588661694,    8.8571048018,    4.4515815667,    28.1721074885,    16.0944539459,    6.8674776425,
    6.9878241798,    4.9511722942,    3.3571144666,    2.4349424830,    1.9319224763,    0.8867806300,    2.7980067448,    6.2549699991,    30.5145837048,    7.2012912984,
    19.7880577266,    1.0000000000,    3.8563305247,    3.1422608143,    12.7280173815,    5.7634485273,    7.2475886422,    30.2602326356,    16.4816106732,    3.0618188459,
    1.0999187724,    4.7636938309,    0.3208473700,    1.6111379680,    0.1341711389,    1.7986925945,    2.2494572225,    0.1344752511,    0.2395453548,    28.3717446033,
    0.0427724540,    2.4405856957,    2.4906989830,    75.1933619978,    0.5152386029,    5.1338521178,    2.2528458943,    1.5100137682,    0.5209000676,    3.1226000292,
    0.2819411584,    0.4047137301,    0.4175779604,    0.3303232637,    1.0566500788,    0.7204002072,    0.5779042752,    0.5493709271,    0.5842431900,    0.7081832566,
    0.5554211331,    0.2662172669,    3.5815989167,    1.5143605623,    1.9648659595,    0.1885237275,    0.2110281228,    0.1748478797,    0.1387750573,    0.6780925393,
    9.2098346466,    0.5845366955,    0.6175797573,    1.7567929408,    0.4315180790,    0.5730261392,    0.3376681949,    0.5673594794,    0.4459894104,    0.2166634934,
    0.8197579079,    1.6542952395,    0.1700289565,    0.6365629977,    0.4475099276,    0.2843420099,    0.4628758569,    0.6376864763,    0.6561939537,    3.1893084634,
    1.7854462297,    1.2477064251,    0.3572347515,    1.5634489239,    0.7154897054,    1.4195253301,    1.0654036224,    3571.8965070696,    0.9527121164,    26.3525943098,
    0.5930109995,    0.6885204567,    0.7095792294,    64.8823966222,    3.1930941603,    0.6619216086,    0.4357401516,    0.3003271624,    0.0906883744,    0.6125979884,
    0.2881077422,    0.1205247267,    3.8233266417,    0.7095792294,    0.6619216086,    3.1930941603,    0.4357401516,    0.6125979884,    0.2881077422,    0.3003271624,
    0.0906883744,    64.8823966222,    3.7534257888,    1.6421595518,    69.3843240265,    1.3252732185,    2.1450529407,    0.3707125954,    0.8538511427,    0.2711466381,
    28615.3347581489,    1.7671265205,    15.6261642094,    1.7137173037,    2.1572070150,    0.6041785067,    0.8203287070,    1.0900436187,    325.2428535999,    8.9091615896,
    1.1642880521,    1.5881546229,    0.5093391952,    0.9733783104,    1.0617295166,    166.9185857932,    8.3866359197,    10.7635468897,    3.0817796159,    4.1371758972,
    5.0723381708,    1362.6954004434,    1.5421330814,    0.4933004784,    0.5313742248,    0.6778881895,    148.0448276984,    0.5981559077,    0.8550561687,    0.9795779587,
    187.1187509120,    0.3688961179,    0.4481591733,    54.5745276665,    0.4933212525,    79.5775968076,    101.3788004257,    3.0797308534,    24.9159139049,    81.9619871541,
    0.0455524054,    81.2750907314,    25.3161612336,    16.2205991556,    0.2696486044,    0.3527524620,    0.2732408821,    0.5117567895,    1.7554888183,    0.2711466381,
    2.1450529407,    1.7863980883,    0.2711466381,    1.6421595518,    1.0000000000,    1.0000000000,    1.0000000000
};

// Selected feature indices
constexpr int N_SELECTED_FEATURES = 502;
static const int SELECTED_FEATURES[N_SELECTED_FEATURES] = {
    0,    15,    16,    26,    29,    35,    38,    49,    66,    67,    72,    75,    78,    83,    84,    86,    87,    89,    90,    96,
    98,    99,    100,    102,    106,    111,    122,    136,    140,    174,    180,    182,    216,    232,    291,    295,    296,    297,    299,    303,
    304,    305,    306,    307,    308,    309,    311,    312,    314,    316,    317,    318,    322,    324,    325,    326,    332,    335,    339,    344,
    347,    348,    349,    353,    355,    356,    358,    359,    366,    369,    370,    374,    375,    376,    379,    380,    381,    383,    384,    385,
    388,    389,    390,    394,    396,    398,    407,    413,    418,    421,    422,    425,    438,    465,    498,    500,    511,    534,    547,    561,
    562,    569,    574,    580,    581,    584,    595,    603,    616,    617,    634,    645,    651,    653,    661,    665,    669,    670,    672,    675,
    679,    680,    681,    683,    687,    689,    690,    702,    706,    708,    715,    720,    725,    726,    732,    734,    735,    737,    741,    744,
    746,    747,    752,    753,    771,    775,    777,    779,    782,    783,    787,    788,    795,    797,    801,    802,    805,    807,    812,    814,
    816,    819,    831,    832,    835,    836,    837,    839,    840,    841,    849,    851,    854,    859,    861,    864,    869,    871,    872,    877,
    878,    879,    886,    887,    891,    905,    907,    909,    912,    913,    916,    922,    923,    924,    933,    935,    937,    940,    941,    942,
    943,    947,    948,    949,    951,    952,    958,    961,    962,    964,    965,    966,    969,    973,    974,    981,    983,    989,    990,    991,
    992,    996,    997,    998,    1005,    1008,    1013,    1016,    1017,    1018,    1020,    1021,    1029,    1037,    1046,    1047,    1048,    1053,    1054,    1056,
    1058,    1062,    1064,    1069,    1070,    1071,    1072,    1079,    1085,    1086,    1088,    1089,    1091,    1095,    1101,    1109,    1113,    1117,    1122,    1128,
    1135,    1136,    1138,    1141,    1143,    1151,    1153,    1154,    1156,    1158,    1160,    1162,    1163,    1166,    1168,    1170,    1171,    1173,    1178,    1219,
    1267,    1271,    1282,    1288,    1289,    1293,    1294,    1295,    1296,    1297,    1298,    1299,    1300,    1301,    1302,    1303,    1304,    1305,    1307,    1308,
    1309,    1310,    1311,    1312,    1313,    1314,    1315,    1316,    1317,    1319,    1320,    1321,    1322,    1323,    1324,    1325,    1326,    1327,    1328,    1329,
    1330,    1331,    1332,    1333,    1334,    1335,    1336,    1337,    1338,    1339,    1340,    1341,    1342,    1343,    1344,    1345,    1346,    1347,    1348,    1349,
    1350,    1351,    1352,    1353,    1355,    1494,    1507,    1512,    1518,    1534,    1553,    1579,    1584,    1591,    1595,    1596,    1608,    1634,    1698,    1708,
    1718,    1724,    1737,    1739,    1791,    1805,    1806,    1807,    1816,    1817,    1818,    1824,    1826,    1830,    1831,    1846,    1850,    1855,    1859,    1868,
    1872,    1875,    1876,    1882,    1884,    1886,    1887,    1888,    1889,    1890,    1891,    1892,    1893,    1894,    1895,    1896,    1897,    1898,    1899,    1900,
    1901,    1902,    1903,    1904,    1905,    1906,    1907,    1908,    1909,    1910,    1911,    1912,    1913,    1914,    1915,    1917,    1918,    1919,    1920,    1921,
    1922,    1923,    1924,    1925,    1926,    1927,    1928,    1929,    1930,    1963,    1964,    1977,    1978,    1981,    1982,    2001,    2004,    2088,    2149,    2153,
    2165,    2199,    2208,    2210,    2230,    2234,    2249,    2251,    2252,    2254,    2261,    2269,    2275,    2307,    2310,    2311,    2336,    2346,    2348,    2360,
    2365,    2379,    2405,    2427,    2428,    2445,    2480,    2516,    2525,    2541,    2669,    2711,    2713,    2770,    3041,    3072,    3078,    3090,    3095,    3142,
    3250,    3272,    3382,    3437,    3439,    3765,    3766,    3768,    3769,    3770,    3781,    3785,    3800,    3801,    3803,    3820,    3829,    3834,    3835,    3847,
    3848,    4018
};

// Feature order metadata
constexpr int N_CASCADE_FEATURES = 11;
constexpr int N_PHYSICS_FEATURES = 74;
// Cascade feature names (in order)
static const char* CASCADE_FEATURE_NAMES[N_CASCADE_FEATURES] = {
    "V",
    "Polarizability",
    "L",
    "E",
    "B",
    "Density",
    "RI",
    "S",
    "A",
    "Modularity",
    "HansenTotal",
};

// Physics feature names (in order)
static const char* PHYSICS_FEATURE_NAMES[N_PHYSICS_FEATURES] = {
    "lsfer_0",
    "lsfer_1",
    "lsfer_2",
    "lsfer_3",
    "lsfer_4",
    "lsfer_5",
    "lsfer_6",
    "lsfer_7",
    "lsfer_8",
    "lsfer_9",
    "lsfer_10",
    "lsfer_11",
    "lsfer_12",
    "lsfer_13",
    "lsfer_14",
    "lsfer_15",
    "lsfer_16",
    "lsfer_17",
    "lsfer_18",
    "lsfer_19",
    "lsfer_20",
    "lsfer_21",
    "lsfer_22",
    "lsfer_23",
    "lsfer_24",
    "lsfer_25",
    "lsfer_26",
    "lsfer_27",
    "lsfer_28",
    "lsfer_29",
    "lsfer_30",
    "lsfer_31",
    "lsfer_32",
    "lsfer_33",
    "lsfer_34",
    "lsfer_35",
    "lsfer_36",
    "lsfer_37",
    "lsfer_38",
    "lsfer_39",
    "lsfer_40",
    "lsfer_41",
    "lsfer_42",
    "lsfer_43",
    "lsfer_44",
    "lsfer_45",
    "lsfer_46",
    "lsfer_47",
    "lsfer_48",
    "lsfer_49",
    "lsfer_50",
    "lsfer_51",
    "lsfer_52",
    "lsfer_53",
    "abraham_odt_eq",
    "phys_MR",
    "phys_Vm",
    "phys_fn",
    "phys_Parachor",
    "phys_epsCM",
    "phys_alpha",
    "phys_dD",
    "phys_dH",
    "phys_dP",
    "phys_delta",
    "dd_ri_s_est",
    "dd_ri_sq",
    "dd_s_sq",
    "dd_ri_e_est",
    "dd_ri_sq",
    "dd_e_sq",
    "dd_ri_l_est",
    "dd_ri_sq",
    "dd_l_sq",
};

// Prediction function using Treelite compiled library
// TL2cgen generates: size_t predict(union Entry* data, size_t num_row, float* result)
// Library path: /Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/dd_v34_treelite.dylib
extern "C" {
    // Forward declaration of TL2cgen prediction function
    typedef struct {
        float missing_value;
        float fvalue;
    } Entry;
    
    // Function pointer type for prediction
    typedef size_t (*PredictFunc)(Entry* data, size_t num_row, float* result);
}

// Load library and get prediction function (called once at initialization)
static void* lib_handle = nullptr;
static PredictFunc predict_func = nullptr;

static bool load_treelite_library() {
    if (lib_handle != nullptr) return true;  // Already loaded
    
    const char* lib_path = "/Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/dd_v34_treelite.dylib";
    lib_handle = dlopen(lib_path, RTLD_LAZY);
    if (!lib_handle) {
        return false;
    }
    
    // Get prediction function
    predict_func = (PredictFunc)dlsym(lib_handle, "predict");
    if (!predict_func) {
        dlclose(lib_handle);
        lib_handle = nullptr;
        return false;
    }
    
    return true;
}

inline double predict(const double* features) {
    // Ensure library is loaded
    if (!load_treelite_library()) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Normalize features
    double normalized[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        normalized[i] = (features[i] - COL_MEANS[i]) / COL_STDS[i];
    }
    
    // Convert to TL2cgen Entry format
    Entry data[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        data[i].missing_value = -1.0f;  // No missing values
        data[i].fvalue = static_cast<float>(normalized[i]);
    }
    
    // Call Treelite prediction
    float result[1];
    size_t num_output = predict_func(data, 1, result);
    if (num_output == 0) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Denormalize target
    double pred_norm = static_cast<double>(result[0]);
    double pred = pred_norm * TARGET_SCALE + TARGET_MEAN;
    
    return pred;
}

} // namespace CascadedD
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit

// Wrapper struct for template parameter (C++ doesn't allow namespaces as template parameters)
// Must be outside the namespace to reference it
namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadedD {
struct Model {
    using Namespace = CascadedD;
};
} // namespace CascadedD
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit
