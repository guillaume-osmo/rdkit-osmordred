#pragma once
// Auto-generated Treelite model for Density (v3.4 XGBoost)
// Trees: 300, Features: 515
// Target normalization: mean=1.0670506152, scale=0.2925455089
// Library: density_v34_treelite.so

#include <vector>
#include <cmath>
#include <algorithm>
#include <dlfcn.h>  // For loading shared library
#include <limits>

namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadeDensity {

constexpr int N_TREES = 300;
constexpr int N_FEATURES = 515;
constexpr double TARGET_MEAN = 1.0670506152;
constexpr double TARGET_SCALE = 0.2925455089;

// Normalization stats
constexpr int N_NORM_FEATURES = 515;
static const double COL_MEANS[N_NORM_FEATURES] = {
    0.0162437752,    0.2201802229,    0.0225278634,    0.0050984112,    0.0955655679,    0.0032013280,    0.0706663505,    0.0125681764,    0.0238321081,    0.0045055727,
    0.0069954944,    1.7414038416,    3.0873843965,    0.0024899217,    0.6267488736,    0.3871235475,    0.2358311596,    0.0603509604,    0.0168366137,    1.9973915106,
    0.1286459568,    0.1329143941,    0.0084183069,    0.0216978895,    0.1675361631,    3.3063789424,    0.0378230970,    0.3348351909,    0.0125681764,    1.4167654731,
    3.2729428504,    0.7047664216,    8.1604048896,    0.5521339682,    -0.2816705123,    0.5149299177,    14.7834650637,    184.2497099834,    183.9510736181,    -0.3176899437,
    0.3296259760,    0.1611259535,    1.1906579157,    1.7255547323,    2.0914203967,    23.5928231546,    10.1929342493,    2.0692926314,    -2.0492411757,    -2.0292957633,
    1.9997304235,    2.9350890515,    8.0025503783,    4.2993485626,    2.2157290276,    5.2914350293,    10.0641029490,    4.3893039744,    2.4356024039,    2.2317429583,
    2.4527424119,    27.2610227476,    18.9923009629,    4.5794373435,    9.3667797564,    30.8182145747,    4.6891873092,    17.0030790671,    12.3663692089,    13.7833295762,
    24.6194534029,    5.3923428086,    4.8251391998,    4.6267100022,    5.8936423376,    3.4172480396,    0.8794190572,    -0.2739781268,    3.3160049925,    3.8087577080,
    0.6124651567,    0.4781835428,    3.5643822623,    4.6895653778,    2.7151544451,    49.6992725753,    0.0128053118,    0.0011856770,    4.3380008611,    146.1879598776,
    169.0552776094,    157.0428708868,    41.7110632286,    123.3670856059,    124.2463942144,    180.1372681134,    719.6177377282,    781.1048138487,    239.3720654494,    3051.3819698001,
    2253.0237053212,    367.8443853569,    288.5905964311,    362.5199854755,    4.2911114674,    2.6376217618,    1.0067724887,    2.6271838746,    3.1489750422,    2.7312220461,
    1.8601280422,    1.3953116309,    3.0540312097,    3.7195255339,    34.9350763418,    25.2032349870,    22.7417489987,    19.4351440931,    15.6183292149,    10.1802751385,
    153.7198580415,    96.3446957206,    88.4347845642,    203.1515672924,    245.5911824252,    160.2991363843,    131.9825595146,    95.1435366829,    7.8111148883,    7.7558134108,
    6.5556947770,    6.4168817567,    6.2487683648,    6.2592475189,    6.2183726715,    1.4876692942,    1.7620661930,    1.4340674671,    1.0541505015,    147.0068767760,
    162.7791928357,    126.9566613342,    0.3778016955,    -0.0042387660,    -0.0001419851,    -0.0125027830,    -0.0084325906,    20.0067810988,    -16.1171029468,    -18.0742506876,
    -12.8314738140,    -2.6717638186,    0.2098122173,    -3.7749025956,    6.8969789758,    -3.9922307984,    -5.4455032155,    -5.3938933508,    307.8328675005,    1.2100736490,
    -12.8256316059,    4.4758973857,    2.8814354822,    -18.0978821596,    -199.4464176713,    -40.9836417731,    -96.2260979088,    -0.0808942977,    0.2837336025,    -0.2069928062,
    -0.2985360847,    -0.1375815753,    -0.0773194602,    2.9628318450,    -0.1050369023,    0.4620200584,    6.9277947802,    -0.3026555641,    -0.5742610287,    -1.6147555248,
    -0.9453982497,    -0.3767488160,    -3.0505125524,    -5.1050315374,    0.0163965803,    -0.0078403872,    0.0003846674,    3.0968159090,    0.0618032868,    -0.2006421349,
    -0.0737474606,    -0.0002779721,    0.0438306655,    -0.1574855305,    -0.2106920564,    -0.1751343437,    -0.3455328435,    -1.0918802392,    -0.7183329154,    -7.0928117542,
    48.7063572704,    -1.9990176039,    -1.9320708524,    -1.2786158186,    0.0845568472,    -0.0099769246,    -0.0078437326,    -0.0107376226,    -0.0081355148,    0.0113634330,
    -0.0143046329,    -0.0371446768,    0.0058150556,    1.6864456037,    -0.2063985011,    -0.1069734882,    0.0075522957,    0.2343261215,    -0.0332309544,    -0.1675654190,
    -0.0076252296,    0.0363449260,    -0.1288330436,    0.0597323048,    -0.0253168743,    -0.0082501161,    0.0035439299,    -0.1116714697,    -0.0457301642,    -0.0771010598,
    -0.0312753701,    -0.0284484487,    0.0449799100,    -0.0983431598,    -0.0321691912,    -0.0963926303,    -0.0632919819,    -0.0878057454,    -0.0627819128,    0.0500647525,
    1.4195461462,    1.0087466224,    0.9894189612,    0.7733426707,    0.6638834961,    0.7602067930,    1.0620970635,    1.0022024189,    0.7356730705,    1.0854615130,
    1.0883692065,    0.7278534102,    0.9790719264,    1.0879756814,    1.2007282373,    0.8799648842,    0.8698654856,    1.0931829254,    0.8995022890,    0.8801140832,
    1.0862561037,    0.5068911223,    1.0884972370,    1.0961795515,    1.1104532067,    1.3606931430,    1.0948204597,    0.9938046452,    1.2200800844,    5.7678659427,
    23.0776856421,    11.7899660899,    21.7089281609,    15.9296817554,    3.5700303329,    2.5003825515,    3.3733739959,    2.3026652535,    3.3935684214,    2.2492060065,
    2.1447831452,    0.9079527085,    13.7547488145,    10.9459551537,    2.6443932208,    77.1293247498,    38.9215085436,    58.7013437321,    77.7503189560,    5.2325154469,
    38.9262274421,    0.8314711999,    3.3493774636,    0.3037240561,    1.2820006286,    49.4652561445,    3.6016496069,    3.7405838644,    49.4552105632,    3.6010916055,
    3.7404798181,    91.2537787420,    45.2004400108,    67.9306800378,    90.6419876594,    6.1620342369,    45.2015205343,    -0.8440302743,    3.3467653951,    0.3035877801,
    1.2813378972,    49.7769493071,    3.6230233192,    3.7454542113,    78.7658129411,    39.6722094188,    59.7550153449,    79.2560363634,    5.3687437825,    39.6739328739,
    0.5948291569,    3.3495569050,    0.3038209105,    1.2821590089,    49.5246919297,    3.6052853317,    3.7411512176,    78.5516523984,    39.5806509317,    59.6347152073,
    79.0687477065,    5.3575978172,    39.5823854054,    0.6267120334,    3.3495935706,    0.3038229332,    1.2821683490,    49.5150242188,    3.6046364687,    3.7409892502,
    78.1972243665,    39.4181019612,    59.3914038855,    78.7407467115,    5.3386830750,    39.4198280711,    0.6574081129,    3.3494357308,    0.3038093821,    1.2821223049,
    49.5181353403,    3.6048342661,    3.7410300210,    103.7044664052,    50.6245912028,    76.0082625777,    102.0692053930,    6.9576265210,    50.6261030919,    -2.4402710027,
    3.3420526571,    0.3031715736,    1.2799292711,    50.0416490033,    3.6407204018,    3.7496704264,    79.5883333246,    40.0345957369,    60.3153297345,    80.0005618262,
    40.0362163121,    0.4992645154,    0.3520877906,    0.0311833057,    0.0896781016,    0.0493061744,    1.5949282662,    0.7736280442,    0.3492513032,    0.1528492391,
    0.0931653141,    0.0345579267,    0.4030742742,    0.2580172689,    0.1600023725,    0.6734489202,    0.6405681046,    0.9718840620,    0.6512932954,    3.0850130424,
    3.5210032720,    0.0689676876,    0.1939477825,    2.5906041113,    1.3077114336,    0.1912117667,    0.0412414156,    1.1018249578,    0.3421499333,    0.0341540557,
    0.0955760871,    0.4324089550,    0.5646027987,    0.1859442878,    10.8142044107,    0.5411723647,    0.3187338428,    5.9890592732,    0.5550324095,    -0.1250654242,
    0.0228404769,    -0.2158096216,    0.5925054284,    0.1621381552,    -2.7145460118,    1.3136259124,    2.0869829904,    54.7973369933,    0.4702166330,    0.7576190909,
    0.7856412314,    0.7899441804,    0.7392388062,    0.9937056996,    0.9608425915,    14.4800964258,    27.2814764459,    29.0028069857,    29.5208233920,    29.5033279089,
    45.7156879668,    5.0696613411,    0.4426251085,    2.2758797808,    1.5485567245,    0.1296470655,    1.9000583647,    4.6160946913,    0.6352434188,    0.1162305986,
    0.0161252075,    0.8271700997,    7.6772136493,    0.1267488736,    0.0737490233,    0.3390004010,    0.3919460076,    3.8892073402,    0.0722057815,    0.2887422762,
    0.2394324123,    0.1565903888,    0.9709043195,    0.4662764292,    0.6522328924,    2.4361786218,    0.0827952182,    0.1832134292,    0.2112113615,    0.2711337502,
    0.0576207013,    0.4771547330,    0.1872184017,    0.0030827603,    1.7725871473,    0.2090684026,    0.0483152491,    0.0170003742,    0.0360056198,    2.4407447588,
    0.0555072234,    0.1290237256,    0.1862776505,    0.0000000000,    0.4991604221,    0.8366484468,    0.6150902300,    5.6989759308,    5.7113838022,    6.6825505036,
    8.1839715269,    5.0655162192,    831.2816049155,    0.3567885247,    3.8577230263,    1.3977455610,    6.7213203019,    43.5055746280,    3.8025193714,    2.7671882718,
    0.8144417937,    5.5616257706,    8.5282969214,    1.2142180561,    1.9130746602,    3.7123882065,    1.4711951645,    2.3112432769,    0.0572682001,    8.1036281717,
    0.0695992412,    1.3593787052,    1.4655773020,    131.8837861878,    5.7551590059,    0.6086965116,    0.5373098733,    0.6998979067,    0.7785906717,    -2.7901205274,
    9.1471088103,    0.4458872029,    1.3469499612,    6.3015819417,    1.3402217359
};

static const double COL_STDS[N_NORM_FEATURES] = {
    0.1931892889,    0.5728963774,    0.2262476818,    0.0760514537,    0.4378594634,    0.0776962310,    0.4629865181,    0.1327674518,    0.2189205810,    0.0704240251,
    0.0927712526,    1.5634172159,    4.3564310560,    0.0498369545,    1.1027917155,    1.0326104202,    0.8876896220,    0.3664041473,    0.1530688370,    2.6185875099,
    0.6964985037,    0.6432741499,    0.1112597898,    0.1792632692,    0.7160439397,    33.8362688471,    0.3371923073,    0.6861225975,    0.1791436740,    5.4081468043,
    6.5266612292,    1.2483267620,    3.4784702666,    0.6708256430,    1.6822409586,    0.1327749864,    9.5240036708,    90.2832573322,    90.0647619063,    0.1470921471,
    0.1478817722,    0.1216879747,    0.3786077918,    0.4735024730,    0.5509657736,    18.5298464674,    0.9214731522,    0.2640626804,    0.1952456858,    0.2610583755,
    0.3976630442,    0.6856685261,    3.8245523991,    2.4916472055,    1.6700157640,    4.2524734087,    177.9866743429,    5.3900233423,    4.7794610946,    3.7855989873,
    8.7021698792,    28.3030538681,    15.7889720270,    6.9050013769,    13.1919645243,    30.7849733629,    7.1784551160,    19.7653897814,    12.4963280480,    16.4096825091,
    26.2863584299,    9.6853043039,    7.1139374259,    8.2766852566,    8.1527207102,    6.7570683256,    2.0605548353,    4.5474044985,    7.1111742405,    3.6723377022,
    0.3482985162,    0.9401389518,    4.3404656405,    4.2708183196,    1.9677767407,    24.5470933662,    0.1309462046,    0.0377015463,    0.4311486664,    128.5078263172,
    194.1208463866,    259.6947173299,    138.4640131684,    114.9839538366,    133.0119630686,    241.3687426283,    679.3957465708,    791.9439652979,    563.4033321991,    3557.1487851625,
    1194.6646812691,    251.1748371739,    169.8395666690,    248.1998326016,    5.3246123854,    5.7579649469,    4.1378572686,    0.7786026955,    0.9584184317,    0.7615848430,
    0.5939631190,    0.7312971225,    1.2028712363,    6.0986048509,    61.6619022593,    18.9779280386,    43.8319104338,    27.3047044568,    21.5947700238,    18.4518998817,
    334.3919236809,    92.2947449348,    237.5185152196,    50.2923661876,    41.2769492943,    52.5178788839,    51.9820063828,    62.2664688891,    1.1382649265,    1.2176485179,
    2.7809041429,    0.6152280263,    1.3044463160,    0.6316180207,    1.1151345871,    0.6273012311,    0.3414305220,    0.5281126406,    0.3835598871,    7.0070410214,
    18.8152781749,    76.9230782445,    0.3614832049,    0.1614277917,    0.1699509176,    0.1755300286,    0.1090970100,    20.1416899345,    31.0210552083,    32.4488258080,
    37.6175794995,    5.3794338549,    3.7673380983,    6.3231823004,    21.8428666422,    23.0826843965,    24.8551338999,    23.2481418037,    412.4630658255,    32.3723573075,
    115.6698742191,    92.0189138166,    162.2009838857,    669.8377765588,    774.4513960554,    88.7745110209,    469.2676448431,    0.3031395227,    0.9191582929,    0.9359974913,
    1.0396043062,    0.7608076887,    0.3783924110,    2.7728748738,    0.4537929626,    1.5011915454,    4.1496692001,    0.8134819257,    2.3643753725,    2.5271942562,
    2.6390101792,    2.3396064171,    6.2604744876,    16.7224179518,    0.0160441646,    0.0096070562,    0.0086486113,    1.6125391729,    0.7649561683,    1.6601937577,
    0.1098422906,    0.1291413654,    0.1239878752,    0.9303254372,    1.1069978381,    5.1732710313,    7.9677078810,    11.4806059962,    9.8247401763,    37.8239261977,
    9.3786900569,    3.8108393582,    8.0924120294,    13.4501931410,    0.0873491464,    0.0423433514,    0.0502076490,    0.0484113383,    0.0874655221,    0.0479210239,
    0.0474201932,    0.1002545738,    0.1147845191,    1.4157556158,    0.5284099620,    0.5383884857,    0.6451063187,    0.1836789232,    0.1880480417,    0.1394005383,
    0.1996997717,    0.2303990156,    0.1560360431,    0.1818660931,    0.3354986964,    0.0869102912,    0.1632756872,    0.1928355897,    0.0911340854,    0.2034166629,
    0.3516961573,    0.3610627269,    0.1836863108,    0.1959543523,    0.1152890805,    0.1912970508,    0.1408383723,    0.1769075623,    0.1736035521,    0.2938420549,
    0.2848589056,    0.3134858497,    0.3667564758,    0.6068619729,    0.7276369894,    0.3429493798,    0.4018725012,    0.4526989247,    0.2894032516,    0.7076585104,
    0.2878812336,    0.7913658022,    0.3150026924,    0.2850842590,    0.2878025693,    0.3150797728,    0.3365460185,    0.4536805989,    0.3061302924,    0.3004668296,
    0.4165099796,    0.7674142696,    0.4342289966,    0.2450261131,    0.2936487437,    0.3123850176,    0.6103878660,    0.1137636762,    0.2571610061,    0.3806740785,
    18.7397827758,    0.8495334334,    1.9833174660,    2.4453455789,    0.2953586559,    0.0638133820,    0.3242218114,    0.0641470155,    0.3877313933,    0.0656584184,
    0.5375906160,    0.3002335104,    1.5179779825,    0.2236748864,    0.7371291020,    110.0176885789,    55.0572981961,    82.7727182634,    110.1546432229,    2.9432261320,
    55.0541625772,    0.9736901066,    0.7583117343,    0.0676405852,    0.6590130686,    44.4224408429,    0.9976773148,    1.1544420948,    44.4142237863,    0.9971097620,
    1.1541667393,    121.5199899508,    60.5791156848,    90.4307710670,    121.2068603813,    3.1221040842,    60.5783510840,    1.2648756643,    0.7572266791,    0.0681096842,
    0.6582571064,    44.5769104856,    1.0117803961,    1.1586682490,    110.1813993232,    55.1505320558,    82.8927551451,    110.3202295758,    2.8928161669,    55.1493688843,
    0.7301755357,    0.7574747858,    0.0680350044,    0.6584043692,    44.4544918497,    1.0014389011,    1.1566261562,    109.9654434438,    55.0458479548,    82.7535678516,
    110.1112864733,    2.8911509346,    55.0446781281,    0.8163100022,    0.7574900547,    0.0680295624,    0.6584141410,    44.4495951092,    1.0011336737,    1.1565403585,
    109.5334713798,    54.8364077185,    82.4627902466,    109.6918991674,    2.8818631058,    54.8352443768,    0.8832990323,    0.7574349942,    0.0680288713,    0.6584088170,
    44.4552213652,    1.0013785441,    1.1565746085,    134.6604933185,    66.5859119543,    98.6791822802,    133.4976359725,    3.6285700399,    66.5848146829,    4.3220165945,
    0.7565078601,    0.0680780998,    0.6581817388,    44.8034070762,    1.0247805343,    1.1604835068,    110.6998677199,    55.3993492565,    83.2487280019,    110.8152290129,
    55.3982497633,    0.7719200938,    0.1613615921,    0.1992393618,    0.1943776991,    0.2805910550,    1.6204014894,    0.0471589028,    0.0576343478,    0.0592739371,
    0.0505604930,    0.0286114196,    0.1203689118,    0.1406114092,    0.1118855151,    0.3204247005,    0.3634669491,    0.0845686704,    0.0970309016,    4.3565868410,
    3.3321190457,    1.1798176037,    1.4200989787,    6.2073020420,    5.1263704739,    1.2111162981,    0.5025253305,    3.8152258302,    1.0597655798,    0.5809899176,
    0.6974660360,    1.9759448797,    1.6605448618,    0.1252248282,    7.0917532383,    0.0657510674,    0.1024974548,    6.7241461227,    0.1834995515,    0.1843614804,
    0.0450393166,    0.2896654034,    0.1384815399,    0.1836129358,    1.9613185404,    0.2736135090,    0.4717576462,    30.4961870438,    0.1369031746,    0.1296529111,
    0.1271252445,    0.1339038893,    0.1192552755,    0.6407415078,    0.6194382468,    8.3192413113,    9.7569009703,    10.5817261605,    10.9351733011,    11.0895831299,
    22.0075610580,    4.5169980223,    0.9012092116,    2.2328922297,    2.4192367543,    0.4529416298,    0.0876168912,    4.7028770282,    1.5449311322,    0.2717620648,
    0.1287501122,    0.2044312678,    4.3350267056,    0.4856862054,    0.3626534803,    0.7744863953,    0.5269354360,    2.9995721940,    0.2227614602,    0.4052936016,
    0.1380644087,    0.1545998108,    0.7453086244,    0.4179243110,    1.4640518304,    5.4909532784,    0.6473098811,    0.7346076985,    0.7636332047,    1.3247340706,
    0.5204219451,    2.7834953543,    0.6091335239,    0.0705006389,    2.2345780634,    0.5353555446,    0.5448642162,    0.1808370226,    0.3543736632,    2.4736692757,
    0.2638544140,    0.3416296823,    0.8428201206,    1.0000000000,    0.4399862756,    0.6086083611,    0.6326369015,    3.0862577604,    3.5728281391,    24.8942332314,
    2.0437230250,    0.6935729604,    2733.3113594006,    0.1132115054,    0.8067183343,    0.3829851317,    2.0750043775,    56.3047488664,    0.7933151466,    1.5084273526,
    0.4613446232,    2.9283197868,    1.0572118185,    0.9383609159,    23.1697708493,    0.5867092137,    1.3440990236,    0.1874123688,    0.3985001908,    5.5999490684,
    0.2958381071,    3.3262225719,    0.7034835260,    63.8332542799,    3.1095158806,    0.6445773008,    0.4230825825,    0.5373393638,    1.5778692592,    1.1671916093,
    9.6904796434,    1.4957646816,    2.6737061576,    19.8892715420,    1.5246233055
};

// Selected feature indices
constexpr int N_SELECTED_FEATURES = 502;
static const int SELECTED_FEATURES[N_SELECTED_FEATURES] = {
    0,    15,    17,    19,    26,    30,    35,    37,    41,    51,    65,    66,    67,    74,    78,    89,    97,    98,    99,    111,
    131,    133,    135,    137,    157,    159,    180,    182,    187,    216,    218,    232,    291,    293,    294,    295,    296,    297,    299,    303,
    304,    305,    306,    307,    308,    309,    310,    311,    312,    314,    317,    318,    322,    324,    329,    335,    336,    338,    339,    344,
    346,    348,    349,    351,    353,    357,    358,    359,    366,    370,    374,    376,    378,    382,    388,    389,    390,    391,    393,    394,
    396,    398,    413,    419,    421,    422,    427,    447,    514,    543,    545,    546,    550,    556,    561,    565,    570,    574,    578,    579,
    580,    609,    617,    618,    644,    646,    649,    651,    652,    653,    655,    657,    661,    664,    669,    670,    671,    672,    673,    675,
    678,    679,    680,    687,    688,    690,    691,    693,    696,    699,    702,    706,    708,    715,    716,    723,    724,    725,    727,    733,
    735,    739,    741,    743,    744,    745,    748,    751,    753,    754,    755,    763,    766,    769,    770,    771,    772,    773,    777,    778,
    783,    785,    787,    788,    790,    796,    797,    805,    806,    807,    808,    811,    814,    822,    823,    824,    831,    832,    833,    834,
    835,    836,    841,    844,    849,    850,    855,    858,    860,    864,    870,    872,    875,    879,    880,    886,    887,    890,    891,    898,
    903,    904,    905,    908,    912,    916,    917,    924,    927,    932,    940,    942,    945,    948,    951,    952,    953,    965,    966,    974,
    977,    978,    981,    982,    986,    989,    990,    991,    1005,    1008,    1018,    1019,    1022,    1023,    1029,    1031,    1037,    1045,    1046,    1051,
    1053,    1054,    1056,    1058,    1059,    1061,    1064,    1077,    1078,    1081,    1087,    1091,    1093,    1095,    1101,    1109,    1110,    1112,    1117,    1118,
    1120,    1124,    1128,    1134,    1135,    1141,    1152,    1154,    1156,    1158,    1159,    1160,    1161,    1162,    1163,    1164,    1165,    1166,    1167,    1168,
    1169,    1170,    1171,    1172,    1173,    1174,    1175,    1176,    1177,    1178,    1179,    1180,    1181,    1182,    1183,    1184,    1185,    1186,    1197,    1198,
    1199,    1200,    1201,    1202,    1203,    1204,    1205,    1206,    1207,    1208,    1209,    1210,    1211,    1212,    1213,    1214,    1215,    1216,    1217,    1218,
    1219,    1220,    1221,    1222,    1223,    1224,    1225,    1226,    1227,    1228,    1229,    1230,    1231,    1232,    1233,    1234,    1235,    1236,    1237,    1238,
    1239,    1240,    1241,    1242,    1243,    1244,    1245,    1246,    1247,    1248,    1249,    1250,    1251,    1252,    1253,    1254,    1255,    1256,    1257,    1258,
    1259,    1260,    1261,    1262,    1263,    1264,    1265,    1266,    1267,    1268,    1270,    1271,    1288,    1290,    1304,    1316,    1330,    1333,    1335,    1337,
    1338,    1340,    1350,    1351,    1352,    1365,    1366,    1369,    1371,    1407,    1506,    1512,    1525,    1533,    1553,    1569,    1581,    1595,    1608,    1616,
    1637,    1691,    1755,    1807,    1809,    1812,    1820,    1825,    1838,    1842,    1843,    1845,    1846,    1850,    1853,    1854,    1855,    1861,    1867,    1869,
    1870,    1871,    1875,    1882,    1883,    1884,    1886,    1887,    1888,    1889,    1890,    1898,    1956,    1957,    1958,    1966,    1976,    1977,    1981,    1986,
    2088,    2177,    2203,    2230,    2241,    2248,    2252,    2254,    2267,    2269,    2271,    2272,    2274,    2275,    2308,    2342,    2365,    2377,    2499,    2512,
    2513,    2520,    2713,    2914,    3034,    3040,    3090,    3200,    3225,    3399,    3473,    3594,    3615,    3698,    3766,    3768,    3769,    3770,    3774,    3782,
    3783,    3803,    3809,    3810,    3811,    3812,    3813,    3814,    3815,    3816,    3817,    3818,    3829,    3835,    3847,    3848,    3850,    3868,    4033,    4041,
    4086,    4092
};

// Feature order metadata
constexpr int N_CASCADE_FEATURES = 5;
constexpr int N_PHYSICS_FEATURES = 0;
// Cascade feature names (in order)
static const char* CASCADE_FEATURE_NAMES[N_CASCADE_FEATURES] = {
    "V",
    "Polarizability",
    "L",
    "E",
    "B",
};

// Prediction function using Treelite compiled library
// TL2cgen generates: size_t predict(union Entry* data, size_t num_row, float* result)
// Library path: /Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/density_v34_treelite.dylib
extern "C" {
    // Forward declaration of TL2cgen prediction function
    typedef struct {
        float missing_value;
        float fvalue;
    } Entry;
    
    // Function pointer type for prediction
    typedef size_t (*PredictFunc)(Entry* data, size_t num_row, float* result);
}

// Load library and get prediction function (called once at initialization)
static void* lib_handle = nullptr;
static PredictFunc predict_func = nullptr;

static bool load_treelite_library() {
    if (lib_handle != nullptr) return true;  // Already loaded
    
    const char* lib_path = "/Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/density_v34_treelite.dylib";
    lib_handle = dlopen(lib_path, RTLD_LAZY);
    if (!lib_handle) {
        return false;
    }
    
    // Get prediction function
    predict_func = (PredictFunc)dlsym(lib_handle, "predict");
    if (!predict_func) {
        dlclose(lib_handle);
        lib_handle = nullptr;
        return false;
    }
    
    return true;
}

inline double predict(const double* features) {
    // Ensure library is loaded
    if (!load_treelite_library()) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Normalize features
    double normalized[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        normalized[i] = (features[i] - COL_MEANS[i]) / COL_STDS[i];
    }
    
    // Convert to TL2cgen Entry format
    Entry data[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        data[i].missing_value = -1.0f;  // No missing values
        data[i].fvalue = static_cast<float>(normalized[i]);
    }
    
    // Call Treelite prediction
    float result[1];
    size_t num_output = predict_func(data, 1, result);
    if (num_output == 0) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Denormalize target
    double pred_norm = static_cast<double>(result[0]);
    double pred = pred_norm * TARGET_SCALE + TARGET_MEAN;
    
    return pred;
}

} // namespace CascadeDensity
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit

// Wrapper struct for template parameter (C++ doesn't allow namespaces as template parameters)
// Must be outside the namespace to reference it
namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadeDensity {
struct Model {
    using Namespace = CascadeDensity;
};
} // namespace CascadeDensity
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit
