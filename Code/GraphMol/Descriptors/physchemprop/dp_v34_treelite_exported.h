#pragma once
// Auto-generated Treelite model for dP (v3.4 XGBoost)
// Trees: 300, Features: 604
// Target normalization: mean=5.5407152752, scale=3.8960434887
// Library: dp_v34_treelite.so

#include <vector>
#include <cmath>
#include <algorithm>
#include <dlfcn.h>  // For loading shared library
#include <limits>

namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadedP {

constexpr int N_TREES = 300;
constexpr int N_FEATURES = 604;
constexpr double TARGET_MEAN = 5.5407152752;
constexpr double TARGET_SCALE = 3.8960434887;

// Normalization stats
constexpr int N_NORM_FEATURES = 604;
static const double COL_MEANS[N_NORM_FEATURES] = {
    0.0112076565,    0.2332199975,    0.0635940058,    0.0254376023,    0.0031482181,    0.1059060572,    0.0797128825,    0.0023926458,    1.6903412668,    3.0379045460,
    0.0109557990,    0.0139780884,    0.6638962347,    0.0264450321,    0.3741342400,    0.5521974562,    0.0123410150,    0.0064223649,    0.1133358519,    0.0227930991,
    0.2410275784,    0.0624606473,    0.2031230324,    0.0180078076,    0.0410527641,    1.9783402594,    0.0776980229,    0.0633421483,    0.4454098980,    1.3528522856,
    0.0610754313,    0.2791839819,    0.3305629014,    0.0614532175,    8.2553378339,    0.5542881401,    -0.3461563449,    0.5156439006,    15.2176896507,    185.1291647148,
    184.8261450675,    0.1723958015,    -0.3211904100,    0.3347055277,    1.1919419812,    1.7227748286,    2.0841268436,    23.4881710977,    10.1997951967,    2.0800792506,
    -2.0375781990,    5.9322633222,    0.2604941892,    218.1506658460,    -0.6559816144,    5.1866616119,    8.5190060350,    1.1385743581,    0.6222088548,    2.3073878397,
    1.3532132987,    18.8746660577,    5.5529324594,    30.3249885645,    4.7392960850,    16.8374126392,    12.7904030132,    4.5746413652,    25.3907366830,    5.6556887860,
    5.8921911320,    4.7489536896,    7.4797182396,    9.0688002585,    3.5944934962,    3.6736415903,    3.4571212694,    0.0717793729,    0.3988162700,    4.5716107798,
    2.6737521937,    49.4834324644,    0.0734164463,    0.0357637577,    0.0156151618,    0.0022667170,    0.0551567813,    3.0680761902,    0.2836756128,    170951.8097496803,
    0.3388741972,    174.3984377376,    94.0988760006,    127.5205249151,    884.6686815263,    593.3189774588,    444.6604961592,    2768.8865892389,    1505.0386174124,    362.2376934341,
    193.8834451784,    369.6342031482,    2.7638897483,    0.9887881586,    2.6576490096,    1.6069826250,    1.5313805852,    25.6953210038,    23.6838725272,    15.8922498735,
    98.5291918079,    7.8644319541,    6.4518850322,    6.2928829297,    6.0621496588,    167.7020535978,    158.6221907709,    165.1927764170,    146.4664835614,    -0.0025407478,
    0.0002108502,    -0.0045593285,    0.0053592706,    77.2115917007,    20.0744443736,    4.3093222525,    -16.4617840568,    -18.1872188016,    -12.3028222367,    3.2265939038,
    -3.0144847874,    -3.9777329038,    41.7664496854,    7.0195772403,    -4.0411920734,    -5.3019107275,    1.4167548319,    -53.2184796260,    -42.7248274358,    3.5448156496,
    1312.2246694063,    -37.7438133550,    -308.3182747853,    -199.0400119729,    -77.3264120054,    -62.2404209364,    1.9272122402,    0.2956247994,    -0.2100763966,    -0.2407821689,
    -0.1398950467,    0.4220222200,    -0.3646917440,    -0.3915348094,    0.4824736938,    -0.4947141563,    -0.2898732474,    -0.9964793216,    -0.3233293534,    41.2781185044,
    -3.1083724254,    -1.1422401780,    0.3702496054,    0.0171688395,    -0.0082911332,    -0.0001789552,    0.0001091403,    0.0001488122,    0.0004882116,    0.7427315538,
    0.0679320169,    -0.4452809035,    -0.3289638029,    -0.1997700269,    0.0912739223,    0.0029944398,    2.0031537489,    0.1744770722,    -0.1641333903,    -0.1132781146,
    -0.2254237542,    -0.4399606481,    -1.4765269895,    -1.0712808926,    -0.6255132816,    -0.3982941054,    -2.5752421412,    48.4147256802,    -1.9677420756,    -3.8982269687,
    4.3435147047,    0.0064903741,    -0.0107982188,    0.2800905227,    -0.0143370994,    -0.0371943509,    -0.0048195430,    0.0086040521,    1.7360354649,    0.0184027354,
    0.1054732588,    -0.0213488213,    0.0093169425,    0.2291070112,    -0.0303963111,    -0.1220851245,    -0.1672770271,    -0.1393828809,    -0.0781147266,    -0.0701822806,
    -0.0073153403,    -0.0970714345,    -0.0630370181,    -0.0969910061,    -0.0452765319,    -0.0431636967,    -0.1282982848,    -0.0780202574,    -0.0740646957,    -0.0275968994,
    -0.0338407917,    -0.0958995606,    -0.0250213444,    -0.0637181376,    -0.1271862188,    -0.0703375678,    -0.0885577973,    -0.1192814949,    -0.0596245680,    0.0097728923,
    1.4282848002,    1.0061826781,    0.9860181274,    0.9005327109,    0.7566189726,    1.1128060572,    1.1378725087,    1.5373536732,    1.1566570113,    0.4160557529,
    0.9955378977,    0.7376864782,    1.0017906119,    0.9668763611,    1.0866232774,    0.9714862845,    1.1956326609,    0.6196921423,    0.8782290139,    0.8649583937,
    1.0795326683,    1.0951597569,    1.0385756497,    0.8949202861,    0.8744423020,    1.0883177108,    0.9021132171,    0.8740515779,    1.2633067721,    1.0968624864,
    0.9716992908,    0.8419617206,    0.7030673974,    1.3595594708,    1.0971867731,    -0.3653886073,    1.1141076471,    3.2359807001,    0.9967423520,    5.4748394903,
    1.2148398294,    11.0737090397,    5.7703411226,    22.9793749453,    21.7007163493,    15.8508967892,    3.5805445493,    2.5023208432,    3.3850456868,    2.3044481227,
    3.4079253724,    2.1428461390,    0.8977846569,    10.9459961488,    38.8788205214,    58.5823021625,    77.6581948347,    5.1820799077,    38.8840384349,    0.8637526629,
    3.3508590091,    0.3043085589,    49.9172793865,    3.6118339706,    3.7388596853,    76.9222868036,    38.8396378465,    58.5391087671,    77.5803970108,    5.1758243462,
    38.8450528996,    0.8860206972,    3.3508786157,    0.3043012735,    1.2798903450,    49.9070662881,    3.6113041159,    3.7387793673,    91.7868352955,    45.4467590386,
    68.2506263429,    91.1465294186,    6.1499185621,    6.9846474778,    0.3526456395,    0.2168564217,    0.5773832011,    0.0960618380,    0.9937508764,    0.5495318121,
    0.2328044015,    0.0910432754,    0.0333178224,    0.1583823012,    91.7611339170,    45.8737970680,    68.5553723703,    91.7611339170,    6.2178946528,    45.8743795197,
    3.3527973033,    0.3046141355,    1.2806519607,    50.0346157834,    3.6181408662,    3.7398918289,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,
    0.0000000000,    0.0000000000,    1.6902153381,    0.1009948369,    3.0353859715,    0.0062964362,    0.4245057298,    1.5537086009,    0.6638962347,    0.0061705075,
    0.0353859715,    0.6113839567,    0.8791084246,    0.0978466188,    0.4008311296,    0.0000000000,    0.0612013600,    0.0000000000,    0.0005037149,    0.0640977207,
    0.0088150107,    0.0210300970,    0.5521974562,    0.4527137640,    0.0214078831,    0.5291524997,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,
    0.0000000000,    0.0000000000,    0.0002518574,    0.0070520086,    0.0000000000,    0.0171263065,    0.0064223649,    0.0601939302,    0.0123410150,    0.0025185745,
    0.0144818033,    0.2409016497,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,
    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0623347185,    0.0000000000,    0.0000000000,
    0.0000000000,    0.0159929480,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0190152374,    0.0287117491,    0.0929353986,    3.4041467703,
    0.7621702437,    0.0505729495,    0.1716962401,    -0.0247252885,    6.0221297118,    0.0297687719,    0.0207767321,    1.3389121183,    0.1936885319,    0.0648239206,
    0.0201328125,    1.5642732649,    6.3909194299,    1.0443506435,    2.2590536651,    0.5004723909,    0.3219536500,    0.0261264422,    1.4060095385,    1.6096347006,
    0.4508519425,    0.3190566559,    0.8368087233,    0.3179593532,    1.9028794758,    0.1519756244,    0.5637385901,    0.8399217519,    0.1642398050,    0.0236302005,
    -2.6707892423,    1.3233131108,    2.9927078803,    54.9194295329,    0.3034340107,    0.4741489153,    0.7848020398,    0.2965663072,    0.6514232425,    3.2337941541,
    1.5643993846,    23.2198718052,    24.7113523851,    4.8966481153,    1.5274162263,    4.6524885000,    0.1831412807,    0.4100264156,    0.0580376582,    2.4636396017,
    0.2011080620,    2.0509676007,    17.2593174785,    0.0436972673,    0.0109557990,    0.0079335096,    27.7105893464,    0.7888192783,    0.0029912593,    3.9837551946,
    10.0062819424,    5.3773856497,    10.6869962772,    0.4606179953,    0.0247089575,    0.0622379666,    0.0127099014,    1.8330928854,    -0.0127623730,    0.0644559240,
    0.2671993250,    0.0257292949,    1.8379297318,    0.0612687187,    0.4513769917,    0.1713506307,    0.0174028864,    0.0535870935,    0.5055490492,    0.8522364941,
    0.2785614814,    1.4221917565,    0.6181300760,    2.6303499746,    1.2172738114,    1.4445117426,    2.2244335138,    1.4963339698,    69.8466386410,    2.3192714998,
    0.0151114469,    0.0793350963,    1.4580408668,    131.3191661671,    5.7597828346,    0.6182368213,    0.5455426893,    1.0775670350,    1.4801189262,    0.8561887095,
    0.1555690020,    0.4014455057,    19.6012377937,    17.1895529530,    1.4580408668,    0.6182368213,    5.7597828346,    0.5455426893,    0.8561887095,    0.1555690020,
    1.0775670350,    1.4801189262,    131.3191661671,    2.6293858522,    0.8203569832,    43.3709486187,    0.4874863056,    1.1083354017,    0.1072077855,    1.2513471193,
    2.1989764171,    21454.4487942777,    1.0504718269,    10.4611563171,    0.9269530264,    1.3886626250,    0.2346478188,    1.5491266592,    2.1730442473,    236.8348340084,
    4.9406832043,    0.4662380393,    0.8525109915,    0.1523092843,    0.7260602096,    0.9667828961,    100.5323802153,    3.9475903013,    6.1836839500,    1.0875103785,
    6.2469589522,    8.6802228948,    952.6435103445,    0.6531656517,    0.1454327018,    0.5889671869,    0.8194354870,    83.5615013436,    0.2066917391,    0.9757861957,
    1.3047506470,    128.2315950044,    0.1827993075,    0.2371976453,    21.1388737287,    1.6025083769,    140.5309218015,    196.4810404530,    4.2262865559,    49.4834324644,
    175.0342300678,    0.2826177433,    173.8976845266,    49.8610390045,    32.8297915418,    1.3429454438,    1.7971061070,    1.3920324048,    2.6421122759,    19.6012377937,
    17.1895529530,    0.8068291935,    8.3668460920,    100.0937361164,    0.8930478639,    2.4116848406,    0.3978080982,    0.4197066171,    24.0474177964,    2.6008846187,
    0.2120342009,    1.4064594098,    1.1944252089,    3.5125135059,    7.5598698596,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,
    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000
};

static const double COL_STDS[N_NORM_FEATURES] = {
    0.1176965456,    0.6107458745,    0.3183679392,    0.2388059550,    0.0560205929,    0.4818756387,    0.5189449238,    0.0513690418,    1.5230070028,    4.3575783352,
    0.1392800156,    0.1286589810,    1.1597030226,    0.1977223740,    0.6830975301,    0.7500672979,    0.1126606818,    0.0902447800,    0.4083250489,    0.2818602749,
    0.9139168873,    0.3863003965,    0.4744262700,    0.1515669254,    0.2480542081,    2.6334732346,    0.3648482666,    0.3638249314,    1.2540118314,    7.3526948552,
    0.2591672500,    0.5409847872,    0.6694883351,    0.3117985551,    3.4646774856,    0.6882235414,    1.7261185944,    0.1327989451,    9.8957151661,    91.8738121496,
    91.6400275961,    0.1475065761,    0.1459739169,    0.1464755629,    0.3791149975,    0.4764563002,    0.5577689668,    18.1671208117,    0.9495206283,    0.2698469257,
    0.2663310803,    1.4857749981,    0.5639488400,    204.2960150133,    0.7931202794,    4.2326378718,    111.8773340869,    3.3571144666,    2.4349424830,    3.8860426131,
    3.3588661694,    16.0944539459,    6.8674776425,    30.5145837048,    7.2012912984,    19.7880577266,    12.7280173815,    5.7634485273,    27.0205210733,    9.8144569952,
    7.6276555291,    8.4305888751,    12.0471781168,    25.5973234831,    7.0984213737,    3.6029235911,    4.3326985546,    0.2945771383,    0.9426275195,    4.2326721586,
    1.9621666237,    24.9159139049,    0.3205975665,    0.1890608330,    0.1437370341,    0.0525860621,    0.2900007013,    0.5842063224,    0.0756808011,    15222966.9423217215,
    0.8125611219,    195.7653137048,    201.8522546457,    134.6061569779,    601.4492015836,    695.1072351681,    649.2180468617,    3362.3262401591,    2456.1551945716,    217.3129309942,
    344.3754841680,    294.9021551475,    6.0648068247,    4.0230079271,    0.7905221396,    0.6785473262,    4.3279957328,    19.6350768012,    46.8319848690,    22.7181994653,
    95.5230331269,    1.1985271648,    2.9209301676,    1.3993175200,    1.6819810350,    15.5745091779,    14.5020918431,    31.1309290999,    63.5017924269,    0.1672148984,
    0.1738779605,    0.1558550370,    0.0954583854,    46.5800099889,    20.0476510281,    28.1056091251,    31.5810240226,    33.2156255613,    36.8812992893,    4.6243879018,
    3.4023834014,    5.8080410983,    45.9350924333,    22.4819699123,    23.4379756073,    23.4621093200,    35.7733955478,    145.4506874078,    145.7602095350,    182.5195866189,
    783.1698258776,    90.1000349351,    455.0866029126,    502.1666806702,    463.2978082082,    464.3543218401,    1.7498067518,    0.9510310725,    0.9444045531,    0.9970445897,
    0.7961961310,    1.3490493008,    1.4081756032,    1.5325146027,    1.5504415801,    1.8038359228,    0.8369275028,    2.6150977321,    2.3346822737,    29.5584575539,
    6.4172425518,    14.7314658548,    13.6344842595,    0.0165306606,    0.0100083695,    0.0054529220,    0.0053184407,    0.0066247806,    0.0085945423,    0.6859746152,
    0.8048863986,    0.9548255258,    1.4758855296,    1.6809913868,    0.1723114165,    0.1332145336,    2.5909334421,    0.8124717476,    0.9700361411,    1.3515849418,
    5.8811549946,    7.8602923842,    7.9730479237,    9.5127975228,    11.7261055562,    9.2936695856,    43.8256676040,    9.7240727391,    8.0844748493,    10.4047214585,
    15.8744881525,    0.0302479219,    0.0458781768,    0.2132741400,    0.0507497036,    0.0847945967,    0.0994451464,    0.1119536968,    1.5092321832,    0.6739782794,
    0.4832658380,    0.1719733494,    0.2833196302,    0.1894796017,    0.1909830285,    0.2356559978,    0.1419691168,    0.1567495628,    0.1820676868,    0.1851702019,
    0.0904385566,    0.2307911191,    0.3149637836,    0.2312375476,    0.0956936704,    0.1662018237,    0.1851003736,    0.2075067383,    0.2922251912,    0.1138506033,
    0.1202151586,    0.1925684006,    0.3679797794,    0.1466067167,    0.1967480328,    0.2046729616,    0.1822343685,    0.1914254194,    0.1928629115,    0.2320223221,
    0.2888452926,    0.3135922486,    0.3772764447,    0.5005471690,    0.3457092111,    0.3891354899,    0.3311483679,    0.4399009284,    0.3694492947,    0.4828765993,
    0.4469535609,    0.2945091982,    0.3549219740,    0.3104083557,    0.2910284280,    0.3111025128,    0.2903890310,    0.5685227589,    0.3105728227,    0.3331839106,
    0.3723019966,    0.4645085424,    0.6669436870,    0.3030328790,    0.2994286700,    0.4296691334,    0.3120100854,    0.3175150250,    0.3713010637,    0.2471977184,
    0.3469562758,    0.4572373079,    0.5653761168,    0.3142236859,    0.2754546445,    0.0997997515,    0.6345455669,    0.5432994298,    0.1222809291,    2.1567032581,
    0.2542815945,    7.7564146786,    0.3910902306,    18.3725760041,    1.9561791454,    2.4100644719,    0.2930208937,    0.0644101791,    0.3237274724,    0.0647581355,
    0.3864776699,    0.5313402033,    0.2982492039,    0.2235233150,    55.6379878341,    83.5857146031,    111.3209163910,    2.9436796525,    55.6345646151,    0.9930555866,
    0.7729235129,    0.0693894021,    44.9076465923,    1.0188605811,    1.1815042310,    111.1697593860,    55.6375632733,    83.5897367569,    111.3209909027,    2.9464234296,
    55.6340138776,    1.0498520295,    0.7730246140,    0.0693516545,    0.6746568204,    44.8995692631,    1.0182093914,    1.1811467149,    123.9500231552,    61.7913311433,
    92.1751462998,    123.6325927936,    3.1390522956,    3.6586856143,    0.1612601704,    0.1144871501,    0.8144657711,    0.2010597513,    1.0221281390,    0.8567766698,
    0.0622130870,    0.0506905424,    0.0283232751,    0.1147588212,    120.6939900005,    60.3397823958,    90.1161043855,    120.6939900005,    2.9794115682,    60.3393660844,
    0.7716967788,    0.0700075795,    0.6736269403,    44.9821814311,    1.0259311311,    1.1852007086,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,
    1.0000000000,    1.0000000000,    1.5230227357,    0.3334596425,    4.3578018010,    0.0822222963,    0.9271398828,    2.5916846892,    1.1597030226,    0.0859751102,
    0.2275166499,    0.9029698785,    1.5974393976,    0.5766926246,    1.0310110669,    1.0000000000,    0.2758499679,    1.0000000000,    0.0224379404,    0.2982495758,
    0.1107398328,    0.1670080776,    0.7500672979,    0.7663340347,    0.1548285344,    2.0990610573,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,
    1.0000000000,    1.0000000000,    0.0158680187,    0.0836796136,    1.0000000000,    0.1400122426,    0.0902447800,    0.3196198042,    0.1126606818,    0.0501221635,
    0.1266297075,    0.9137433882,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,
    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    0.3858314729,    1.0000000000,    1.0000000000,
    1.0000000000,    0.1517927522,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    0.1506100173,    0.1909202395,    0.3297401747,    3.2291411138,
    1.7936874191,    1.2726663680,    1.3612230532,    0.2200816838,    8.4482126385,    0.4233580625,    0.1910884933,    5.2840722609,    1.2666133531,    0.4954601527,
    0.2250109333,    5.1011915746,    9.3350105319,    3.7601076225,    5.3303055900,    3.4133426718,    2.8366638181,    0.3473598695,    0.8894572474,    2.3129607909,
    2.0063521466,    0.1769749777,    0.3035080713,    0.1035766107,    1.6136000204,    0.1037495713,    0.1926839344,    0.1669057267,    0.1991966307,    0.0457565546,
    1.9672845581,    0.2765232792,    0.5826726236,    31.3591865758,    0.1045005802,    0.1370477984,    0.1279177248,    0.1032646548,    0.1277703152,    0.8804396971,
    0.7949290377,    8.9542513701,    12.8292650783,    4.4432084722,    2.3126835490,    5.2042702708,    0.4648415270,    0.3208473700,    0.1341711389,    2.7028395681,
    0.1984481081,    2.2494572225,    10.2000225154,    0.2128704311,    0.1064870151,    0.0887162277,    28.3717446033,    0.9371350659,    0.0054670127,    2.1026696238,
    1.3626230035,    2.4906989830,    165.4051481472,    0.4175779604,    0.2463890450,    0.7081832566,    0.2978807202,    3.5815989167,    0.7001140941,    0.7271794493,
    1.3296640921,    0.3910032258,    2.2862305142,    0.4459894104,    0.6844905417,    0.7350747412,    0.2480694922,    0.4009468139,    0.4647575775,    0.6376864763,
    0.0687525311,    0.2691482801,    0.3572347515,    1.5634489239,    0.9527121164,    0.1281405928,    0.3854842241,    1.4091760220,    47.4300529760,    0.1982709944,
    0.1665167288,    0.4024260407,    0.7095792294,    64.8823966222,    3.1930941603,    0.6619216086,    0.4357401516,    0.3003271624,    0.0906883744,    0.6125979884,
    0.2881077422,    0.1205247267,    3.8233266417,    1.8032977603,    0.7095792294,    0.6619216086,    3.1930941603,    0.4357401516,    0.6125979884,    0.2881077422,
    0.3003271624,    0.0906883744,    64.8823966222,    3.7534257888,    1.6421595518,    69.3843240265,    1.3252732185,    2.1450529407,    0.3707125954,    0.8538511427,
    0.2711466381,    28615.3347581489,    1.7671265205,    15.6261642094,    1.7137173037,    2.1572070150,    0.6041785067,    0.8203287070,    1.0900436187,    325.2428535999,
    8.9091615896,    1.1642880521,    1.5881546229,    0.5093391952,    0.9733783104,    1.0617295166,    166.9185857932,    8.3866359197,    10.7635468897,    3.0817796159,
    4.1371758972,    5.0723381708,    1362.6954004434,    1.5421330814,    0.4933004784,    0.5313742248,    0.6778881895,    148.0448276984,    0.5981559077,    0.8550561687,
    0.9795779587,    187.1187509120,    0.3688961179,    0.4481591733,    54.5745276665,    0.4933212525,    79.5775968076,    101.3788004257,    3.0797308534,    24.9159139049,
    81.9619871541,    0.0455524054,    81.2750907314,    25.3161612336,    16.2205991556,    0.2696486044,    0.3527524620,    0.2732408821,    0.5117567895,    3.8233266417,
    1.8032977603,    0.1593013513,    5.4854008594,    140.2910616727,    0.0964090569,    2.8122139106,    0.1868676630,    0.2126234502,    12.1824263210,    0.2739227909,
    0.0903304219,    0.1051165443,    0.1747774366,    3.1406424905,    4.5856073122,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,
    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000
};

// Selected feature indices
constexpr int N_SELECTED_FEATURES = 502;
static const int SELECTED_FEATURES[N_SELECTED_FEATURES] = {
    13,    15,    16,    17,    20,    26,    35,    61,    66,    67,    72,    73,    78,    80,    83,    86,    88,    90,    93,    96,
    97,    98,    101,    102,    106,    111,    141,    150,    155,    158,    177,    181,    182,    231,    291,    293,    294,    295,    296,    297,
    299,    302,    303,    304,    306,    307,    308,    309,    310,    311,    314,    315,    316,    319,    332,    335,    336,    340,    341,    344,
    345,    349,    350,    357,    358,    359,    366,    367,    374,    376,    379,    382,    383,    386,    389,    394,    413,    415,    418,    419,
    421,    422,    439,    446,    477,    486,    511,    518,    519,    522,    534,    545,    548,    561,    572,    575,    576,    583,    585,    599,
    605,    610,    646,    649,    651,    656,    668,    670,    671,    673,    679,    696,    702,    708,    709,    732,    734,    736,    738,    743,
    744,    746,    749,    750,    751,    752,    753,    754,    755,    760,    761,    762,    768,    770,    771,    773,    778,    780,    781,    787,
    795,    796,    798,    799,    800,    802,    804,    806,    807,    809,    811,    815,    816,    818,    824,    826,    832,    835,    836,    840,
    841,    845,    846,    849,    850,    851,    852,    854,    855,    859,    860,    861,    863,    864,    868,    872,    876,    878,    879,    883,
    886,    887,    889,    890,    891,    892,    896,    903,    905,    907,    911,    914,    916,    939,    940,    942,    944,    946,    948,    953,
    956,    960,    963,    965,    966,    968,    974,    975,    976,    983,    989,    992,    993,    1000,    1005,    1006,    1007,    1008,    1017,    1021,
    1029,    1031,    1034,    1037,    1039,    1040,    1045,    1047,    1048,    1049,    1053,    1054,    1056,    1057,    1061,    1062,    1063,    1070,    1071,    1075,
    1077,    1078,    1079,    1085,    1087,    1093,    1101,    1107,    1109,    1110,    1111,    1112,    1113,    1117,    1118,    1120,    1125,    1126,    1133,    1134,
    1136,    1137,    1138,    1141,    1143,    1150,    1152,    1153,    1154,    1155,    1156,    1157,    1158,    1159,    1161,    1162,    1163,    1164,    1165,    1166,
    1167,    1169,    1170,    1172,    1175,    1176,    1177,    1178,    1179,    1180,    1181,    1182,    1184,    1185,    1186,    1187,    1188,    1189,    1190,    1191,
    1192,    1193,    1194,    1195,    1196,    1197,    1198,    1199,    1200,    1201,    1202,    1203,    1204,    1256,    1288,    1289,    1292,    1304,    1311,    1332,
    1336,    1338,    1340,    1352,    1387,    1388,    1389,    1390,    1391,    1392,    1393,    1394,    1395,    1396,    1397,    1398,    1399,    1400,    1401,    1402,
    1403,    1404,    1405,    1406,    1407,    1408,    1409,    1410,    1411,    1412,    1413,    1414,    1415,    1416,    1417,    1418,    1419,    1420,    1421,    1422,
    1423,    1424,    1433,    1434,    1435,    1436,    1437,    1438,    1439,    1440,    1441,    1442,    1443,    1444,    1445,    1446,    1447,    1448,    1449,    1450,
    1451,    1452,    1453,    1454,    1455,    1456,    1457,    1458,    1459,    1460,    1461,    1462,    1463,    1464,    1465,    1466,    1467,    1468,    1469,    1471,
    1472,    1473,    1474,    1475,    1476,    1477,    1478,    1479,    1494,    1506,    1510,    1512,    1525,    1530,    1534,    1548,    1550,    1553,    1569,    1583,
    1586,    1589,    1594,    1595,    1597,    1598,    1600,    1649,    1708,    1737,    1792,    1806,    1818,    1820,    1827,    1828,    1838,    1839,    1840,    1843,
    1853,    1854,    1856,    1861,    1866,    1867,    1870,    1872,    1874,    1878,    1880,    1885,    1894,    1898,    1958,    1961,    1967,    1978,    1982,    1983,
    1984,    2004,    2009,    2073,    2100,    2122,    2153,    2156,    2171,    2176,    2190,    2208,    2216,    2275,    2345,    2360,    2395,    2405,    2416,    2495,
    2512,    2528,    3034,    3095,    3136,    3242,    3258,    3277,    3767,    3768,    3777,    3780,    3800,    3801,    3835,    3838,    3841,    3850,    3854,    3868,
    4002,    4011
};

// Feature order metadata
constexpr int N_CASCADE_FEATURES = 12;
constexpr int N_PHYSICS_FEATURES = 74;
// Cascade feature names (in order)
static const char* CASCADE_FEATURE_NAMES[N_CASCADE_FEATURES] = {
    "V",
    "Polarizability",
    "L",
    "E",
    "B",
    "Density",
    "RI",
    "S",
    "A",
    "Modularity",
    "HansenTotal",
    "dD",
};

// Physics feature names (in order)
static const char* PHYSICS_FEATURE_NAMES[N_PHYSICS_FEATURES] = {
    "lsfer_0",
    "lsfer_1",
    "lsfer_2",
    "lsfer_3",
    "lsfer_4",
    "lsfer_5",
    "lsfer_6",
    "lsfer_7",
    "lsfer_8",
    "lsfer_9",
    "lsfer_10",
    "lsfer_11",
    "lsfer_12",
    "lsfer_13",
    "lsfer_14",
    "lsfer_15",
    "lsfer_16",
    "lsfer_17",
    "lsfer_18",
    "lsfer_19",
    "lsfer_20",
    "lsfer_21",
    "lsfer_22",
    "lsfer_23",
    "lsfer_24",
    "lsfer_25",
    "lsfer_26",
    "lsfer_27",
    "lsfer_28",
    "lsfer_29",
    "lsfer_30",
    "lsfer_31",
    "lsfer_32",
    "lsfer_33",
    "lsfer_34",
    "lsfer_35",
    "lsfer_36",
    "lsfer_37",
    "lsfer_38",
    "lsfer_39",
    "lsfer_40",
    "lsfer_41",
    "lsfer_42",
    "lsfer_43",
    "lsfer_44",
    "lsfer_45",
    "lsfer_46",
    "lsfer_47",
    "lsfer_48",
    "lsfer_49",
    "lsfer_50",
    "lsfer_51",
    "lsfer_52",
    "lsfer_53",
    "abraham_odt_eq",
    "phys_MR",
    "phys_Vm",
    "phys_fn",
    "phys_Parachor",
    "phys_epsCM",
    "phys_alpha",
    "phys_dD",
    "phys_dH",
    "phys_dP",
    "phys_delta",
    "dp_dipolemoment_logpow_est",
    "dp_dipolemoment_sq",
    "dp_logpow_sq",
    "dp_s_logpow_est",
    "dp_s_sq",
    "dp_logpow_sq",
    "dp_dipolemoment_dh_est",
    "dp_dipolemoment_sq",
    "dp_dh_sq",
};

// Prediction function using Treelite compiled library
// TL2cgen generates: size_t predict(union Entry* data, size_t num_row, float* result)
// Library path: /Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/dp_v34_treelite.dylib
extern "C" {
    // Forward declaration of TL2cgen prediction function
    typedef struct {
        float missing_value;
        float fvalue;
    } Entry;
    
    // Function pointer type for prediction
    typedef size_t (*PredictFunc)(Entry* data, size_t num_row, float* result);
}

// Load library and get prediction function (called once at initialization)
static void* lib_handle = nullptr;
static PredictFunc predict_func = nullptr;

static bool load_treelite_library() {
    if (lib_handle != nullptr) return true;  // Already loaded
    
    const char* lib_path = "/Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/dp_v34_treelite.dylib";
    lib_handle = dlopen(lib_path, RTLD_LAZY);
    if (!lib_handle) {
        return false;
    }
    
    // Get prediction function
    predict_func = (PredictFunc)dlsym(lib_handle, "predict");
    if (!predict_func) {
        dlclose(lib_handle);
        lib_handle = nullptr;
        return false;
    }
    
    return true;
}

inline double predict(const double* features) {
    // Ensure library is loaded
    if (!load_treelite_library()) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Normalize features
    double normalized[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        normalized[i] = (features[i] - COL_MEANS[i]) / COL_STDS[i];
    }
    
    // Convert to TL2cgen Entry format
    Entry data[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        data[i].missing_value = -1.0f;  // No missing values
        data[i].fvalue = static_cast<float>(normalized[i]);
    }
    
    // Call Treelite prediction
    float result[1];
    size_t num_output = predict_func(data, 1, result);
    if (num_output == 0) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Denormalize target
    double pred_norm = static_cast<double>(result[0]);
    double pred = pred_norm * TARGET_SCALE + TARGET_MEAN;
    
    return pred;
}

} // namespace CascadedP
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit

// Wrapper struct for template parameter (C++ doesn't allow namespaces as template parameters)
// Must be outside the namespace to reference it
namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadedP {
struct Model {
    using Namespace = CascadedP;
};
} // namespace CascadedP
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit
