#pragma once
// Auto-generated Treelite model for Modularity (v3.4 XGBoost)
// Trees: 300, Features: 576
// Target normalization: mean=0.4213449287, scale=0.1263752745
// Library: modularity_v34_treelite.so

#include <vector>
#include <cmath>
#include <algorithm>
#include <dlfcn.h>  // For loading shared library
#include <limits>

namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadeModularity {

constexpr int N_TREES = 300;
constexpr int N_FEATURES = 576;
constexpr double TARGET_MEAN = 0.4213449287;
constexpr double TARGET_SCALE = 0.1263752745;

// Normalization stats
constexpr int N_NORM_FEATURES = 576;
static const double COL_MEANS[N_NORM_FEATURES] = {
    0.0062015504,    0.0025839793,    0.2462532300,    0.1096899225,    0.0652454780,    0.0227390181,    0.0178294574,    0.1220930233,    0.0189922481,    0.0365633075,
    0.0043927649,    0.0488372093,    0.0277777778,    0.0028423773,    0.0709302326,    1.5711886305,    3.0067183463,    0.6506459948,    0.3684754522,    0.3573643411,
    0.0248062016,    0.6568475452,    0.3104651163,    0.0113695090,    0.0569767442,    2.9788113695,    0.1801033592,    0.4158914729,    0.2680878553,    0.9007751938,
    0.2861757106,    1.7816537468,    0.0104651163,    0.2245478036,    0.3111111111,    0.0050387597,    0.0001291990,    3.7538759690,    0.2577519380,    0.1040051680,
    0.6768733850,    8.2197229585,    0.5489745066,    -0.2567476310,    0.5346996283,    14.7370941837,    213.0721791487,    212.7041349271,    -0.3191145935,    0.1692206869,
    1.1203121700,    1.6794191058,    2.1161053081,    24.0758534974,    10.2043632061,    2.0874238960,    -2.0457069462,    0.3575716937,    2.1356345537,    2.7560914716,
    10.6165278260,    1.9459767608,    -0.9416420517,    13460211861615.9082031250,    11.1119530137,    88.3296102801,    3.2773388779,    1.6240973331,    29.0724765934,    8.0111379989,
    5.5969605367,    8.3385037030,    25.1338223055,    5.0420667521,    5.7763603648,    5.5636491279,    6.7937142583,    9.3900797681,    6.5534721582,    8.9176262426,
    7.2327682680,    1.2902099515,    3.2130944217,    14.2565891473,    0.0815245478,    3.4458656331,    57.8388015504,    0.2590439276,    0.0074935401,    0.0049095607,
    9.2917164813,    17.4787978343,    4.4726290026,    1.2055368560,    3.2613574116,    0.2653338279,    4.3348109955,    135.7469030955,    82.8581395349,    131.6323521835,
    157.3475495136,    176.3811564606,    824.1948320413,    4247.9974513160,    1268.5232015071,    79.5212149897,    8158.2024999171,    9089.3635285538,    2.7490593385,    2.4987560810,
    1.8336020591,    3.4091746733,    3.3540419650,    2.2355559366,    36.7652877471,    55.9832005946,    7.3394169388,    6.8137095934,    4.8476136070,    5.7349349985,
    1.0475917965,    161.9707019169,    0.0157263665,    -0.0077489480,    0.0024855331,    -15.4417589867,    -7.6868212555,    -2.2098557320,    -4.4752595488,    -4.1437866751,
    -1.9286245162,    -0.2414530170,    0.2407519802,    -1.5898281917,    -47.8997135063,    -49.0723268246,    -38.5300761404,    -17.5842638298,    -2.2697554783,    -6.2318477133,
    -53.4472533159,    -263.1127810349,    -272.4485246994,    -144.6677316577,    -41.2952123144,    34.5194802185,    -0.1924392826,    -0.2785647937,    -0.0725263692,    -0.4625936565,
    -0.4719216251,    -0.2378143465,    -0.2098153037,    -0.2959266815,    -0.3221396438,    44.1493383968,    -7.6350566783,    -2.6424353401,    -0.4403637890,    -0.0001099526,
    0.0005940558,    0.0002601749,    -0.3198787601,    -0.1621008873,    0.1284213754,    -0.0770575604,    0.0507472604,    0.1772425657,    -1.3866910565,    -0.7712916343,
    -4.5006862786,    2.6396619704,    0.0062599869,    -0.0024137032,    -0.0053010114,    -0.0122220777,    -0.0063969890,    -0.0114895741,    -0.0002134310,    -0.0013566606,
    0.1096425688,    -0.0147573523,    -0.0271273479,    0.0061414493,    0.0559649742,    -0.1075662556,    0.0867920563,    0.0902735190,    -0.1247078659,    0.0642730513,
    -0.0613292509,    -0.0258887704,    0.0152122554,    0.0112575703,    0.0079981631,    -0.0945416155,    -0.0226860510,    -0.0920325395,    -0.0943732429,    -0.0714847736,
    -0.0337741939,    -0.0816527752,    -0.0822840313,    -0.0866058686,    -0.0293361198,    0.0548453137,    -0.0840812016,    -0.0760843430,    0.0683998897,    1.4099149474,
    0.9938995912,    1.0044031493,    0.9488289604,    0.7152847055,    1.0438914805,    1.1168987486,    1.0849210780,    1.0099808928,    1.0638583261,    1.4332552705,
    1.1858168938,    0.9857290799,    0.7926216775,    0.4945864740,    0.3833354806,    0.9613462781,    0.7210500263,    0.6375049040,    1.0627489446,    1.0193390925,
    0.9208360790,    1.0139917703,    0.9360639950,    1.0544826480,    1.0820132626,    0.8251319037,    0.8791168992,    1.0157777222,    0.5232361496,    1.1028943321,
    0.9837026366,    0.7461189655,    0.4736572078,    3.2533898914,    0.9156347428,    2.3855174723,    66.0805008299,    86.5809376171,    95.0598665473,    76.3579959637,
    23.7565891473,    0.0032546101,    0.0061333566,    0.0294531282,    0.2405218225,    0.0053000072,    0.0669792188,    1.0839075189,    0.3348493991,    0.6534596902,
    0.1338943293,    2.2039072147,    5.9577168162,    3.3724552652,    2.4643796021,    0.3311686405,    0.2178846485,    0.0877481033,    0.0576820483,    0.7672359104,
    0.1441096030,    0.0306838878,    11.3243581094,    89.0315330114,    6.7877275644,    1.5710594315,    0.0569767442,    3.0023255814,    0.0076227390,    0.2793281654,
    2.6992248062,    0.6505167959,    0.0045219638,    0.0409560724,    0.6111111111,    1.5377260982,    0.2966408269,    0.3104651163,    0.0000000000,    0.0865633075,
    0.0000000000,    0.0025839793,    0.1319121447,    0.0343669251,    0.0222222222,    0.0000000000,    0.0400516796,    0.1510335917,    0.1195090439,    0.0532299742,
    0.0441860465,    0.0005167959,    0.3683462532,    0.6568475452,    0.4386304910,    0.0248062016,    0.3210594315,    0.0000000000,    0.0000000000,    0.0021963824,
    0.0196382429,    0.0000000000,    0.0000000000,    0.0016795866,    0.0202842377,    0.0000000000,    0.0064599483,    0.0113695090,    0.0447028424,    0.0209302326,
    0.0058139535,    0.0271317829,    0.3474160207,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0001291990,
    0.0000000000,    0.0000000000,    0.0000000000,    0.0310077519,    4.9443979163,    0.0094820576,    0.0944559125,    -0.0282997533,    0.9277846602,    0.3033846373,
    -0.8186207990,    0.0000000000,    0.4582655110,    0.0000000000,    0.0179747642,    0.3526003370,    0.0993315105,    0.1844027343,    0.0000000000,    0.1479859842,
    0.6167460784,    0.2193291915,    -0.0351300490,    0.0600891904,    0.0000479612,    3.4650484837,    7.3690500386,    2.2549532097,    0.1298837050,    3.9201905187,
    0.0349043557,    0.0000000000,    0.0000000000,    0.0000000000,    -0.0002287898,    0.2312893797,    0.0744494502,    1.0410793914,    1.2792357388,    1.1070684740,
    0.0365676518,    0.0449982412,    0.1273216548,    0.1763600060,    2.3082420562,    0.1868413549,    0.0676532617,    1.0069166529,    0.8120373485,    0.6506732403,
    1.3149829011,    0.3807890620,    0.2857620205,    2.2701892498,    0.1843508991,    0.2242462854,    14.6816214470,    1.0129433193,    0.0254277680,    0.4739370623,
    0.0184605216,    0.4331363314,    -1.8349806202,    42.5883333333,    3.5826047990,    0.3057206012,    0.7717995994,    0.6509187677,    1.5502231257,    0.9315075863,
    32.1015632335,    38.6034307239,    31.6989340712,    27.6058816957,    26.0288986615,    25.0746036733,    12.0284486773,    4.6384924566,    1.5835929878,    7.1409570803,
    0.4882187419,    2.7329655508,    1.9369815556,    3.7806270933,    0.2102067183,    0.1127906977,    0.1803595013,    0.0850451385,    0.0495400225,    0.0402595896,
    0.0235555833,    0.0121306110,    0.0025874114,    8.1656330749,    0.8215079882,    4.8056960261,    0.8621835002,    8.9208848945,    46.7755985770,    3.3026943368,
    119.4684627907,    2702.9854005168,    10.8269686837,    2.2962721553,    0.0197252643,    0.0179278218,    5.0395325976,    3.5405453428,    0.4713876978,    0.7601965456,
    0.4633993333,    0.2745595165,    2.4193243318,    0.0653047713,    3.0615672774,    0.0082090627,    0.0038973874,    0.0198004426,    0.2957364341,    1.5226098191,
    1.8476744186,    0.1382282514,    0.0249122440,    0.2264465443,    0.1305414134,    0.7287926231,    0.0318939000,    0.0326625494,    0.0645531439,    0.5376103492,
    0.2398748049,    0.4745910596,    0.1312765863,    0.9619673920,    0.1609441185,    0.3756462372,    4.1236641248,    0.6773798450,    267.4909317203,    5.9703897671,
    1.6683142943,    0.2648626926,    1.5224978898,    6.1040003715,    0.8608476733,    0.8575518611,    0.6974669399,    0.6132900162,    2.4519408050,    0.0164319480,
    0.3386165940,    61.5620686934,    2.8949062142,    41.6303077182,    3.7991107778,    150.8009401630,    8.9155423993,    0.4370826956,    0.0643748463,    2.1856583332,
    1604.4588246265,    1.1217787772,    0.1792091588,    132.8714424249,    1.7983625364,    613.9426847116,    1.3601650193,    0.5196966937,    0.0578736277,    0.1312661499,
    0.0093023256,    1.9301033592,    1.6490062520,    152.8337453751,    7.1561204050,    0.9801777802,    0.6829195401,    1.1312769531,    1.5144355924,    1.1413967977,
    0.2211721026,    1.6490062520,    0.9801777802,    7.1561204050,    0.6829195401,    1.1413967977,    0.2211721026,    1.1312769531,    1.5144355924,    152.8337453751,
    3.4880682502,    1.6957241663,    67.9832899259,    0.8975638261,    1.9691807866,    0.1888375387,    1.3639755976,    2.3018111285,    29683.0422554833,    1.9014748102,
    15.0433286233,    1.3999134375,    2.1615380827,    0.4197874730,    1.8567659260,    2.5133155938,    320.8029624758,    9.5045272235,    0.9899965587,    1.6882903747,
    0.3328865121,    1.2122950199,    1.5451106868,    183.6863014277,    6.6509664409,    10.5024265637,    2.1040246344,    8.2712012038,    11.0143244545,    1399.0284169231,
    1.1778497707,    0.2919492908,    0.7931004036,    1.0508115333,    129.4235135406,    0.3972945619,    1.3799036827,    1.7732153991,    204.0754387375,    0.2739887279,
    0.3433824904,    38.7574808391,    1.7256087333,    173.6304711563,    233.7703145396,    4.9646639967,    57.8388015504,    190.6920780524,    0.2997432554,    191.6924169739,
    57.6084986562,    38.2084363438,    1.3394468646,    1.7418679563,    1.3492451172,    2.5802954097
};

static const double COL_STDS[N_NORM_FEATURES] = {
    0.0921339924,    0.0507671388,    0.7842639486,    0.4008829492,    0.4132887938,    0.2058567315,    0.1426672530,    0.8672644102,    0.1647988906,    0.2035386509,
    0.0752692377,    0.2420678399,    0.2281902108,    0.0532381269,    0.2821244851,    1.6077884993,    4.8837870605,    1.5549930735,    0.8995482652,    0.7385237591,
    0.1588220565,    0.8875092954,    0.9823344240,    0.1119474563,    0.2660538637,    3.1151153762,    0.6615048147,    1.1585122191,    0.7949060774,    1.9633527246,
    0.9143643251,    9.7735932976,    0.1030242474,    0.4872715681,    1.0741768343,    0.1207232128,    0.0113658380,    7.2038079734,    1.3644046739,    0.3856729814,
    1.6658470983,    3.6950680778,    0.6560293192,    1.5495305305,    0.1550207243,    10.1743930164,    111.8140718021,    111.6003769747,    0.1534863989,    0.1219759964,
    0.3710192661,    0.4747150101,    0.5698686289,    18.1341254168,    1.6330703337,    0.2589618956,    0.2793031148,    0.6201851072,    0.4601582431,    0.6787644741,
    5.5047378568,    2.3240312231,    0.9596898535,    900454754578335.5000000000,    6.3062722044,    45.7029731226,    6.6115937954,    4.2149423451,    33.8587248049,    9.6222971865,
    8.2478546252,    11.3553486578,    22.9179114317,    8.1843850229,    9.7266398243,    8.3619335587,    9.2078512643,    11.5332986022,    10.2005184149,    13.3905124356,
    22.8752177089,    2.6287938041,    3.7109342566,    7.7118353784,    0.6097356154,    4.8725927297,    30.6606685175,    0.6607896894,    0.0906232901,    0.0698960438,
    4.4691316293,    9.9886904943,    0.4495385554,    0.0974675139,    0.6520515846,    0.0790886733,    1.7395098086,    253.4445729302,    51.0983828853,    129.6287813613,
    125.5261265597,    237.3152893913,    683.1639285376,    3883.0096610161,    2801.8092156224,    54.1898982939,    5714.7610126241,    11509.1656435346,    4.2823675094,    0.7420022574,
    0.7085529342,    4.0239616454,    4.4077881554,    3.7078664204,    68.9977540654,    122.8453763226,    1.8478803586,    2.4700193358,    3.6028182624,    1.6476107431,
    0.4692656294,    25.8003839896,    0.2153061931,    0.2250234245,    0.1216540843,    38.1355993263,    40.3334074704,    4.2736409294,    6.2170349157,    6.5866108778,
    5.7029526138,    5.0431920389,    4.2568108448,    16.4126934709,    150.0839817576,    160.7986651187,    138.8993407892,    145.7356608467,    586.5920740057,    122.0789022248,
    505.4235148701,    437.0878660854,    594.4816525730,    525.9862469582,    558.3345188136,    565.1023584553,    1.1046455501,    1.0474604397,    0.7310504213,    1.6618780730,
    1.7479454020,    1.4605610698,    1.4758527732,    2.9954228624,    2.8169333665,    32.5704878759,    15.7450501967,    14.8193045945,    14.8369764026,    0.0057300446,
    0.0086278403,    0.0075108157,    1.2193024569,    1.6020480318,    0.1640661953,    0.0960983630,    0.1381889354,    0.6589612502,    8.3894135071,    4.3108281817,
    9.4450918699,    20.5465616786,    0.0255381480,    0.0409372599,    0.0236631944,    0.0494391322,    0.0766997160,    0.1199377738,    0.1550449935,    0.4962701821,
    0.4468240949,    0.2007702861,    0.1639433363,    0.3206599146,    0.3787876814,    0.1705585961,    0.2598670169,    0.2353436636,    0.1552708176,    0.1894638409,
    0.1735868089,    0.3518391097,    0.3450690570,    0.0989713366,    0.1531599565,    0.2089113878,    0.3787392360,    0.1737393187,    0.2089079501,    0.2954401113,
    0.1454192488,    0.2691366442,    0.1800043998,    0.2992286974,    0.3973941713,    0.1967819484,    0.1853320799,    0.1691947883,    0.3119305084,    0.3052155625,
    0.3264465996,    0.3490124820,    0.4579275963,    0.3206034226,    0.3467759276,    0.3288787612,    0.3649839226,    0.5081380480,    0.3475740230,    0.3745759717,
    0.3410984613,    0.3698389615,    0.4232248003,    0.4904562333,    0.4637753852,    0.4163956414,    0.2896585918,    0.9547322297,    0.3258495999,    0.4777563955,
    0.6650156483,    0.2335294432,    0.3765854884,    0.3464519464,    0.6051002586,    0.8468229710,    0.3264057959,    0.3213947438,    0.6256476367,    0.2295816935,
    0.2812023767,    0.4476681716,    0.4950066704,    0.5057770780,    0.2977668906,    0.7066030907,    61.6498159585,    115.5262856866,    125.6541849398,    105.6891734932,
    18.5975513585,    0.0294555853,    0.0460287437,    0.0992846929,    0.4283830709,    0.0424230346,    0.1639596069,    1.0679507045,    0.7933241519,    0.9755795104,
    0.4888829480,    2.5922326065,    3.5379740088,    2.7588434355,    2.3445877899,    0.0583090375,    0.0574928227,    0.0420098250,    0.0329914014,    1.4120929495,
    0.1152171146,    0.0642339306,    6.7981544713,    112.0715367947,    3.4275812681,    1.6077942147,    0.2660538637,    4.8833149210,    0.0954726163,    0.7467494163,
    3.1621100499,    1.5550055847,    0.0726409627,    0.2405895335,    1.0066602780,    1.9075527830,    0.9804887684,    0.9823344240,    1.0000000000,    0.3406185633,
    1.0000000000,    0.0556246191,    0.4253464465,    0.2048691515,    0.1616204193,    1.0000000000,    0.2283476144,    0.4991519593,    0.4038660289,    0.2732873025,
    0.2456043467,    0.0227272697,    0.8993857243,    0.8875092954,    0.9018964718,    0.1588220565,    1.7545499107,    1.0000000000,    1.0000000000,    0.0957512534,
    0.2957526611,    1.0000000000,    1.0000000000,    0.0409483278,    0.1557740424,    1.0000000000,    0.0848139799,    0.1119474563,    0.2517465648,    0.1431508223,
    0.0760273072,    0.1724958621,    1.1169818091,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    0.0113658380,
    1.0000000000,    1.0000000000,    1.0000000000,    0.1820633034,    6.1461058006,    0.1527068626,    0.5913162937,    0.8557965774,    1.7086051208,    1.1734512087,
    6.1810410991,    1.0000000000,    1.8359606798,    1.0000000000,    0.3883694049,    1.1284096436,    0.6317060125,    1.3402944079,    1.0000000000,    0.8732912780,
    2.0455078400,    0.7871066033,    0.2311010296,    0.3439979418,    0.0101093179,    8.9167669219,    10.3353291055,    4.9203206933,    0.8356716160,    22.0150018100,
    0.2424116808,    1.0000000000,    1.0000000000,    1.0000000000,    0.0201270048,    0.9181391208,    0.3739426367,    3.8344597122,    4.5110482098,    5.6977210541,
    0.4383510535,    0.5298385311,    0.6835318782,    0.5743706510,    4.0463377769,    0.6705181096,    0.3212634243,    2.9700994223,    2.6588772879,    1.6760237266,
    0.9196239521,    0.5733986636,    0.8398759686,    3.9719898048,    0.6618841987,    0.1313829312,    9.1315529329,    0.3531496033,    0.0440716223,    0.0171698283,
    0.0168065793,    0.0080982447,    5.2439142499,    78.5711307600,    0.7832136812,    0.0991829777,    0.1410723594,    0.1316007302,    0.8394023315,    0.7005467748,
    12.0396529384,    20.9470480339,    17.9077285090,    14.8695003235,    13.1334798031,    11.9843483210,    6.6041557684,    4.7343572590,    2.8034205459,    7.2867139670,
    1.6900205875,    4.6625739043,    0.0935765309,    1.8361462832,    0.4171692580,    0.3248004199,    0.3369603783,    0.0372487470,    0.0268793890,    0.0259022887,
    0.0189032119,    0.0123536244,    0.0047822116,    4.9018751145,    0.2090198512,    0.7151301366,    1.8772153439,    1.1390649393,    14.0330576915,    1.6906490172,
    90.2711082295,    6477.4650492701,    266.2365990532,    2.7670245348,    0.0964171345,    0.1438119417,    4.0313231514,    3.7812178692,    0.4275355206,    1.3051793278,
    1.2846487598,    1.2148435098,    6.1261016098,    0.4440570021,    4.3880685669,    0.0945276045,    0.0794481878,    0.1838099877,    0.8066310536,    2.1313169759,
    2.2258003276,    0.3689704136,    0.2614843820,    0.7888854392,    0.5095398995,    0.7377232813,    0.2021792199,    0.1697232632,    0.2656338120,    0.8025358357,
    0.5730090084,    0.6168447750,    0.5122688096,    1.0095411352,    0.4981963059,    1.1749139790,    3.1808076288,    0.7188366042,    683.2811105900,    3.0347429933,
    0.2441518528,    0.0714181942,    0.2738057077,    1.6802626446,    0.0473737229,    0.0509003582,    0.2010745676,    0.3509789904,    1.5550537760,    0.0305033307,
    0.1165329222,    33.2608924436,    1.8019907371,    53.0039161846,    2.4751037545,    369.5215966756,    1.3017648222,    0.1654435569,    0.1290474084,    0.3218890424,
    4264.9515682211,    0.8542328068,    0.0832760017,    196.0701098472,    26.5975324500,    1489.4499568324,    1.4151622888,    0.2893904015,    0.0294515854,    0.4913507186,
    0.1098096971,    4.5907893676,    0.8768389996,    79.5291677946,    4.0955134812,    0.8573072294,    0.6566465776,    0.2901517757,    0.0910821883,    0.8163296741,
    0.3740594067,    0.8768389996,    0.8573072294,    4.0955134812,    0.6566465776,    0.8163296741,    0.3740594067,    0.2901517757,    0.0910821883,    79.5291677946,
    4.8768204106,    2.7351536271,    97.8764318921,    2.6538726543,    3.3501106068,    0.8543079493,    0.8199653016,    0.2749760793,    37355.8854393739,    2.8559677947,
    20.6878504726,    2.8045180993,    3.2037474397,    1.2372195449,    1.0283098828,    1.3508374206,    424.1169337812,    15.0080463912,    2.3106711877,    2.6837698756,
    1.0763314042,    1.2061552769,    1.3827481836,    264.8474571172,    14.5200558644,    16.7538077265,    6.4927981914,    5.3603712108,    6.5371770420,    1825.4189033628,
    2.6425887361,    1.2484027021,    0.8270489014,    1.0366172175,    248.1378621172,    1.1472175528,    1.1136134023,    1.3112981507,    285.5183754560,    0.4821075477,
    0.5854131042,    111.1664816882,    0.5034308691,    98.1243959947,    124.4857153570,    3.6114681634,    30.6606685175,    98.4009638433,    0.0451946449,    99.3953600762,
    30.6881201690,    19.8822919487,    0.2758714080,    0.3676916641,    0.2848127383,    0.5321469295
};

// Selected feature indices
constexpr int N_SELECTED_FEATURES = 502;
static const int SELECTED_FEATURES[N_SELECTED_FEATURES] = {
    1,    7,    15,    16,    26,    28,    34,    35,    37,    38,    43,    49,    60,    61,    64,    66,    67,    78,    82,    83,
    85,    86,    89,    90,    100,    111,    129,    133,    147,    155,    157,    160,    167,    181,    183,    187,    188,    215,    219,    231,
    232,    291,    293,    294,    295,    296,    297,    299,    303,    305,    306,    307,    308,    309,    310,    311,    314,    316,    317,    318,
    320,    331,    332,    333,    334,    337,    339,    340,    348,    350,    351,    352,    359,    368,    376,    378,    379,    380,    382,    383,
    386,    390,    394,    397,    408,    413,    422,    453,    500,    503,    509,    512,    514,    516,    518,    519,    523,    548,    552,    561,
    563,    566,    570,    582,    587,    626,    635,    639,    646,    654,    656,    663,    664,    667,    669,    683,    701,    702,    704,    719,
    728,    736,    743,    744,    749,    753,    757,    761,    762,    763,    764,    766,    767,    776,    780,    781,    782,    783,    794,    796,
    797,    798,    799,    800,    801,    803,    807,    809,    812,    818,    827,    829,    832,    833,    838,    840,    843,    845,    846,    854,
    855,    857,    863,    864,    868,    870,    875,    878,    889,    904,    907,    910,    914,    920,    922,    925,    937,    944,    945,    953,
    956,    958,    959,    963,    972,    976,    979,    980,    981,    982,    983,    986,    988,    989,    990,    992,    994,    999,    1000,    1001,
    1013,    1017,    1023,    1025,    1026,    1030,    1040,    1048,    1051,    1053,    1054,    1056,    1057,    1061,    1062,    1063,    1064,    1065,    1069,    1070,
    1071,    1072,    1073,    1075,    1076,    1077,    1078,    1084,    1088,    1089,    1090,    1102,    1105,    1111,    1113,    1123,    1125,    1136,    1140,    1142,
    1144,    1146,    1148,    1153,    1170,    1173,    1184,    1202,    1254,    1267,    1281,    1301,    1302,    1303,    1305,    1307,    1309,    1311,    1313,    1315,
    1317,    1319,    1327,    1329,    1330,    1335,    1336,    1338,    1339,    1347,    1352,    1355,    1377,    1389,    1391,    1405,    1406,    1407,    1408,    1409,
    1410,    1411,    1412,    1413,    1414,    1415,    1416,    1417,    1418,    1419,    1420,    1421,    1422,    1423,    1424,    1425,    1426,    1427,    1428,    1429,
    1430,    1431,    1432,    1433,    1434,    1435,    1436,    1437,    1438,    1439,    1440,    1441,    1442,    1443,    1444,    1445,    1446,    1447,    1448,    1449,
    1450,    1451,    1452,    1453,    1454,    1455,    1456,    1457,    1458,    1459,    1460,    1461,    1462,    1485,    1511,    1513,    1514,    1515,    1516,    1517,
    1518,    1519,    1520,    1521,    1522,    1523,    1524,    1525,    1526,    1527,    1528,    1529,    1530,    1531,    1532,    1533,    1534,    1535,    1536,    1537,
    1550,    1557,    1558,    1559,    1560,    1584,    1587,    1590,    1595,    1599,    1610,    1613,    1628,    1630,    1634,    1685,    1688,    1690,    1691,    1694,
    1708,    1710,    1725,    1735,    1786,    1807,    1809,    1810,    1816,    1824,    1830,    1837,    1844,    1849,    1857,    1866,    1869,    1874,    1880,    1882,
    1889,    1891,    1892,    1893,    1894,    1895,    1896,    1898,    1958,    1961,    1962,    1963,    1976,    2001,    2082,    2093,    2159,    2165,    2166,    2167,
    2168,    2169,    2172,    2175,    2177,    2183,    2197,    2200,    2201,    2209,    2210,    2213,    2216,    2249,    2250,    2253,    2254,    2255,    2269,    2306,
    2308,    2323,    2342,    2348,    2405,    2471,    2490,    2527,    2673,    2770,    2771,    3077,    3078,    3089,    3102,    3136,    3144,    3145,    3231,    3401,
    3403,    3437,    3467,    3500,    3502,    3615,    3764,    3766,    3772,    3774,    3776,    3777,    3780,    3781,    3786,    3790,    3796,    3800,    3801,    3807,
    3810,    3819,    3820,    3823,    3824,    3825,    3829,    3831,    3832,    3833,    3834,    3835,    3840,    3844,    3847,    3849,    3850,    3852,    3862,    4011,
    4014,    4092
};

// Feature order metadata
constexpr int N_CASCADE_FEATURES = 9;
constexpr int N_PHYSICS_FEATURES = 65;
// Cascade feature names (in order)
static const char* CASCADE_FEATURE_NAMES[N_CASCADE_FEATURES] = {
    "V",
    "Polarizability",
    "L",
    "E",
    "B",
    "Density",
    "RI",
    "S",
    "A",
};

// Physics feature names (in order)
static const char* PHYSICS_FEATURE_NAMES[N_PHYSICS_FEATURES] = {
    "lsfer_0",
    "lsfer_1",
    "lsfer_2",
    "lsfer_3",
    "lsfer_4",
    "lsfer_5",
    "lsfer_6",
    "lsfer_7",
    "lsfer_8",
    "lsfer_9",
    "lsfer_10",
    "lsfer_11",
    "lsfer_12",
    "lsfer_13",
    "lsfer_14",
    "lsfer_15",
    "lsfer_16",
    "lsfer_17",
    "lsfer_18",
    "lsfer_19",
    "lsfer_20",
    "lsfer_21",
    "lsfer_22",
    "lsfer_23",
    "lsfer_24",
    "lsfer_25",
    "lsfer_26",
    "lsfer_27",
    "lsfer_28",
    "lsfer_29",
    "lsfer_30",
    "lsfer_31",
    "lsfer_32",
    "lsfer_33",
    "lsfer_34",
    "lsfer_35",
    "lsfer_36",
    "lsfer_37",
    "lsfer_38",
    "lsfer_39",
    "lsfer_40",
    "lsfer_41",
    "lsfer_42",
    "lsfer_43",
    "lsfer_44",
    "lsfer_45",
    "lsfer_46",
    "lsfer_47",
    "lsfer_48",
    "lsfer_49",
    "lsfer_50",
    "lsfer_51",
    "lsfer_52",
    "lsfer_53",
    "abraham_odt_eq",
    "phys_MR",
    "phys_Vm",
    "phys_fn",
    "phys_Parachor",
    "phys_epsCM",
    "phys_alpha",
    "phys_dD",
    "phys_dH",
    "phys_dP",
    "phys_delta",
};

// Prediction function using Treelite compiled library
// TL2cgen generates: size_t predict(union Entry* data, size_t num_row, float* result)
// Library path: /Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/modularity_v34_treelite.dylib
extern "C" {
    // Forward declaration of TL2cgen prediction function
    typedef struct {
        float missing_value;
        float fvalue;
    } Entry;
    
    // Function pointer type for prediction
    typedef size_t (*PredictFunc)(Entry* data, size_t num_row, float* result);
}

// Load library and get prediction function (called once at initialization)
static void* lib_handle = nullptr;
static PredictFunc predict_func = nullptr;

static bool load_treelite_library() {
    if (lib_handle != nullptr) return true;  // Already loaded
    
    const char* lib_path = "/Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/modularity_v34_treelite.dylib";
    lib_handle = dlopen(lib_path, RTLD_LAZY);
    if (!lib_handle) {
        return false;
    }
    
    // Get prediction function
    predict_func = (PredictFunc)dlsym(lib_handle, "predict");
    if (!predict_func) {
        dlclose(lib_handle);
        lib_handle = nullptr;
        return false;
    }
    
    return true;
}

inline double predict(const double* features) {
    // Ensure library is loaded
    if (!load_treelite_library()) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Normalize features
    double normalized[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        normalized[i] = (features[i] - COL_MEANS[i]) / COL_STDS[i];
    }
    
    // Convert to TL2cgen Entry format
    Entry data[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        data[i].missing_value = -1.0f;  // No missing values
        data[i].fvalue = static_cast<float>(normalized[i]);
    }
    
    // Call Treelite prediction
    float result[1];
    size_t num_output = predict_func(data, 1, result);
    if (num_output == 0) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Denormalize target
    double pred_norm = static_cast<double>(result[0]);
    double pred = pred_norm * TARGET_SCALE + TARGET_MEAN;
    
    return pred;
}

} // namespace CascadeModularity
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit

// Wrapper struct for template parameter (C++ doesn't allow namespaces as template parameters)
// Must be outside the namespace to reference it
namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadeModularity {
struct Model {
    using Namespace = CascadeModularity;
};
} // namespace CascadeModularity
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit
