#pragma once
// Auto-generated Treelite model for Polarizability (v3.4 XGBoost)
// Trees: 300, Features: 501
// Target normalization: mean=130.3793000745, scale=62.7579462358
// Library: polarizability_v34_treelite.so

#include <vector>
#include <cmath>
#include <algorithm>
#include <dlfcn.h>  // For loading shared library
#include <limits>

namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadePolarizability {

constexpr int N_TREES = 300;
constexpr int N_FEATURES = 501;
constexpr double TARGET_MEAN = 130.3793000745;
constexpr double TARGET_SCALE = 62.7579462358;

// Normalization stats
constexpr int N_NORM_FEATURES = 501;
static const double COL_MEANS[N_NORM_FEATURES] = {
    0.0141111685,    0.0123902943,    0.1846498021,    0.0326966099,    0.0345895715,    0.0029254861,    0.0798485631,    0.0318361728,    0.0070555842,    0.0228876269,
    0.0063672346,    1.7258647393,    3.1132335226,    0.0722767166,    0.5324384787,    0.0161762175,    0.4568921012,    0.0578213733,    0.0187575288,    0.4940629840,
    0.2004818448,    0.0048184478,    0.0691791430,    0.1571158148,    0.3008088109,    1.1794871795,    0.1399070728,    0.0542075374,    0.3780760626,    0.3780760626,
    0.1137497849,    1.5186714851,    4.1736362072,    0.7482361039,    0.0034417484,    3.3240406126,    2.6525554982,    7.4536082896,    0.5650845703,    -0.2339749534,
    0.5097057459,    13.9399294693,    180.2704212700,    179.9256100359,    65.7339528480,    0.1645308616,    -0.3025781437,    1.1775463215,    1.6877162098,    26.2099373105,
    -2.0362060499,    2.1157937816,    6.2029576821,    2.9178838800,    8.7942805361,    7.2881957904,    7.9393244829,    4.8365387240,    3.9171117533,    1.7406427361,
    5.2069191401,    73.8058839916,    4.5022773501,    2.0948465122,    17.7427240781,    6.2540115764,    28.3243425306,    13.3650290448,    4.7349789231,    13.7404102751,
    7.7336687437,    14.6837330868,    3.0655465279,    0.1043767380,    3.7430344148,    0.0614906463,    49.1016691103,    0.0745138530,    0.0018929616,    1.0215109276,
    1.1720516230,    740.4807811515,    26.0399242815,    0.0258131131,    123.9990294175,    102.8081589266,    44.6487695749,    143.6546911270,    223.8323868525,    2330.0498002125,
    1928.6360568835,    1432.0449843579,    5142.9981591247,    6258.7018762929,    8517.3986707108,    160.7641803992,    40.1722619878,    47.1653858177,    67.6640182373,    25.5784427891,
    2.3113284730,    3.0211540329,    1.8241756220,    0.7945203806,    2.5842749713,    26.9989875798,    15.4593417358,    207.4368586508,    248.5179895382,    191.4268654167,
    157.7378687224,    7.6831801734,    7.5982792925,    5.3729953085,    1.2933247249,    1.1046766971,    0.9593853555,    164.9870621543,    160.9025486448,    142.5287907874,
    118.1351690667,    0.0102182273,    -0.0102077271,    0.0062833782,    6.4969654691,    -12.8552746734,    -15.5493843025,    -2.7621785844,    -1.4714448554,    -2.4925227792,
    -3.6488742783,    -1.4071914782,    349.0690370355,    16.1332474710,    -53.4393532243,    -22.3415471226,    -106.9175450841,    1362.4050819355,    -31.1142090252,    -234.4004715681,
    -180.2033971351,    -0.1520587834,    -0.3068799981,    2.6087277026,    -0.1662276549,    -0.3937006639,    -0.5122605309,    -0.1382581976,    2.6424579041,    -0.1286434326,
    -0.3083842321,    -0.6970082622,    -0.8510145268,    0.1704701533,    38.2723094235,    -3.9521229366,    -3.6024078188,    -6.5356676253,    0.0004933253,    -0.0001894391,
    0.0003492716,    0.0004803479,    0.0900913728,    -0.0664337066,    0.0207449234,    0.1610163549,    -0.0913604086,    -0.0523064642,    18.5121384022,    0.2992528296,
    -5.7680305167,    1.1486644315,    2.0519672586,    0.0084307726,    0.0112960238,    0.0125379089,    -0.0156447100,    -0.0254444990,    -0.1894806184,    -0.0945054303,
    -0.0763938570,    0.0022320595,    -0.0159781529,    0.0240694541,    0.1925380699,    -0.1237727195,    -0.0216870979,    0.0263287409,    0.0242875534,    0.0227230285,
    -0.1000086280,    0.0230458573,    -0.0589848076,    0.0369776779,    -0.1141365665,    0.0396139671,    0.0039187309,    0.0456484756,    1.4698033567,    1.0311717460,
    1.1149694925,    1.0278529816,    0.9118225597,    1.0837091859,    0.7598915022,    1.2036009066,    1.1700903386,    1.0824059345,    0.7878729354,    1.0873730456,
    1.0668800315,    1.1368244712,    0.6511676858,    0.9147228958,    1.0574586514,    1.1251028155,    1.0503726176,    1.2693629058,    1.1292653714,    0.9965747785,
    0.7040644550,    1.4168480455,    0.9364386059,    0.5094095885,    0.3641426556,    1.0044847627,    1.1248775788,    5.7689491244,    11.7891457064,    0.9557220978,
    0.8808769973,    3.4913879110,    53.9394972840,    0.3607068937,    0.0216149338,    0.0198332830,    0.3543896393,    4.8382288534,    16.0565880801,    0.5984912729,
    8.4219878954,    41.4124447657,    82.8315516412,    5.9516307652,    41.4130487848,    3.2579636111,    0.3139271802,    1.1920983837,    45.9585959489,    3.4880997171,
    3.5831062438,    0.0000000000,    0.0000000000,    0.0000000000,    0.0037859232,    0.0215109276,    0.0000000000,    1.7256926519,    0.0760626398,    3.1068662881,
    0.0129065565,    0.2574427809,    1.6238168990,    0.5324384787,    0.0104973326,    0.0593701600,    0.4723799690,    0.7410084323,    0.1060058510,    0.2004818448,
    0.0000000000,    0.0604026846,    0.0000000000,    0.0006883497,    0.0863878850,    0.0127344691,    0.0261572879,    0.0001720874,    0.0302873860,    0.0722767166,
    0.0975735674,    0.0278781621,    0.0117019446,    0.0001720874,    0.2273274824,    0.4940629840,    0.5147134744,    0.0187575288,    0.1800034417,    0.0036138358,
    0.0048184478,    0.0082601962,    0.0607468594,    0.0024092239,    0.0006883497,    0.0141111685,    0.0490449148,    0.0000000000,    0.0177250043,    0.0299432112,
    0.0621235588,    0.0106694201,    0.0048184478,    0.0153157804,    0.3008088109,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,
    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,
    0.0757184650,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0189296162,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,
    0.0240922389,    0.0228876269,    0.0077439339,    0.0366546205,    0.0258131131,    0.0407847186,    0.0283944244,    0.0199621408,    0.0265014627,    0.0244364137,
    0.1381861986,    0.0326966099,    0.0425055928,    0.0001720874,    0.0789881260,    0.0425055928,    0.1498881432,    0.0495611771,    0.0557563242,    0.0306315608,
    0.0000000000,    0.0000000000,    0.0000000000,    0.0040674674,    0.0009105065,    0.0000000000,    3.4943457683,    0.2708959565,    0.0639426204,    0.4934562022,
    0.2443557094,    0.1106649285,    2.6271944585,    0.0942152125,    2.1737987169,    0.0057632794,    0.0027329448,    -0.0065593825,    -0.1181810732,    0.0065539472,
    0.0007754716,    -0.0082537389,    -0.1480481785,    0.0000000000,    0.0727813460,    0.1489684662,    0.1125315036,    0.0165315425,    -0.0054371257,    -0.0560010079,
    1.6601507858,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,
    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.2425837850,    0.0000000000,    0.0000000000,    0.0000000000,
    0.0000000000,    0.0393178897,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.1293121044,    0.1258851294,    0.0367905579,    0.1143603601,
    0.0728044268,    0.0986635582,    0.0634862556,    0.0371394982,    0.0399771028,    -0.0179662933,    1.2719961473,    0.3044530507,    0.3564173431,    0.0014281822,
    0.7899485968,    0.3377895276,    0.0831430807,    0.0149247569,    -0.0067633214,    0.0897383727,    -0.0827399655,    -0.1287884545,    0.9341804532,    0.6302375620,
    1.2908722620,    3.9497046289,    1.6004278735,    0.0318578002,    0.2609440009,    0.3165166446,    0.1702871218,    0.8649332920,    0.5459717434,    0.4722181935,
    0.3964488154,    0.2740239152,    0.4294318626,    0.0282881900,    -2.6003996068,    33.9658506254,    95.7810032516,    0.3056777145,    3.1643009300,    23.7804902991,
    27.3966015888,    43.4883528791,    26.0002206786,    24.8952621959,    144.0257029771,    1.1557965130,    0.0154911955,    0.4357884187,    2.8965441175,    1.5087750583,
    0.0440543796,    0.0824786021,    0.0482410862,    7.7754259164,    0.1094181790,    1.4065499147,    0.2886096323,    2.0880856144,    0.1217951319,    0.0429881118,
    2.0832397833,    1.4631207116,    0.0064615992,    0.0387138136,    0.1108388033,    0.0159764763,    1.8420237481,    0.1045690491,    0.0900266811,    0.0254604827,
    0.0343212286,    1.9774404555,    0.4967774897,    0.0078166737,    0.5858430563,    0.6271502323,    5.6499956978,    9.0800377007,    5.7258382094,    0.7350242700,
    0.7351639246,    4.3822595530,    1.1690719486,    1587.8037459620,    0.5844843765,    4.7858704051,    0.0014165611,    0.8928087183,    7.6943727414,    0.0032696610,
    1.4412743235
};

static const double COL_STDS[N_NORM_FEATURES] = {
    0.2010311074,    0.1319067758,    0.5746420796,    0.2073289930,    0.3121051961,    0.0655257739,    0.4079215330,    0.1994271214,    0.1038832336,    0.1679724851,
    0.0837558509,    1.6244508506,    4.0114595001,    0.3783060040,    1.0943005101,    0.1498461527,    0.8852557604,    0.3335669510,    0.1418681012,    0.7522747209,
    0.6659915680,    0.0692476016,    0.2777190276,    1.1172489738,    0.9067886949,    1.4945432135,    0.6688042932,    0.2694585691,    1.1617111035,    1.1617111035,
    0.4946472023,    8.4037130322,    44.2882522349,    7.0931636192,    0.1097008377,    5.3513424999,    6.0078178511,    3.5141742562,    0.5456467125,    1.4086817717,
    0.1311780843,    8.5322559058,    86.5087624936,    86.3209005109,    32.4403339919,    0.1525002049,    0.1473016944,    0.3882718424,    0.4811082974,    19.8106113854,
    0.1986273553,    0.2432701250,    1.6193986373,    0.6638470729,    4.1676031489,    3.7186994903,    3.8188726602,    2.9575187942,    3.4707684558,    4.3935868124,
    3.8996889242,    34.5796305661,    5.6912461569,    4.5673959493,    14.6777758822,    7.7282214018,    29.2550304529,    13.6356395678,    6.4815748551,    22.0879791484,
    12.5794016624,    16.5308416294,    6.3568313068,    3.0635799294,    3.7898025030,    1.5654389785,    23.6426536323,    0.3387281987,    0.0434669797,    2.9359101239,
    0.1052534688,    36580.5028809531,    14.3110631533,    0.1837149076,    101.1384602410,    83.8442503697,    89.0191123538,    159.1776621211,    499.8157937646,    1333.9967284625,
    2522.4681069939,    2280.1474296992,    2613.1928375691,    3478.6150586807,    5257.7065466665,    87.9372961652,    23.8465101425,    27.8591513362,    44.8453604213,    51.2925140339,
    3.4267821182,    0.7969458825,    0.6124896042,    0.7798098720,    3.6614132499,    17.7932082254,    32.9547918292,    55.9836698926,    47.7970908706,    55.4646718300,
    54.1442944353,    0.7569808912,    1.0305243107,    1.7879528688,    0.4848259242,    0.5036216942,    0.4729621500,    9.0914312964,    17.2274694208,    63.9437086010,
    79.5587697068,    0.1561591759,    0.1266415250,    0.0984939254,    33.6418822603,    39.5658417419,    41.8403340633,    5.2350564317,    4.8628162904,    25.4830201773,
    24.0514586942,    18.1006548857,    428.5408457959,    65.2798604489,    179.8595159475,    145.6822582188,    707.1041039356,    825.3607238088,    148.6124346180,    502.7887726891,
    561.5105103803,    0.5050337183,    1.1622748761,    2.1569157652,    0.6101274621,    1.8969391225,    1.8402443725,    1.5624442433,    2.5209965909,    1.6225852246,
    2.3507163067,    3.8589394925,    4.0822705250,    3.3367754070,    26.6187657910,    8.2882164305,    14.6054513270,    17.1920339531,    0.0054099009,    0.0045659538,
    0.0060809444,    0.0049664343,    0.1611866638,    0.0890765226,    0.1338418460,    0.6660119250,    1.2455586833,    1.1001427764,    38.2127958548,    5.2194735847,
    11.1876756032,    17.6394654173,    18.6118742139,    0.0287789715,    0.0389990651,    0.0441036855,    0.1158372941,    0.1163742269,    0.4486946614,    0.3907405063,
    0.3717235602,    0.5241001042,    0.1779200422,    0.2651897358,    0.2115687595,    0.2469513807,    0.3591412986,    0.2868133956,    0.1374407935,    0.1337010346,
    0.2407040538,    0.3412329455,    0.1687820395,    0.3140755711,    0.2039727793,    0.3276308603,    0.2443385788,    0.2705008943,    0.3392964431,    0.3334780713,
    0.4160626385,    0.4491244522,    0.5559005820,    0.4817744097,    0.7085974673,    0.3594474741,    0.4237916301,    0.5079785865,    0.3173081991,    0.7793645237,
    0.4092299488,    0.4247607185,    0.9628368758,    0.3240392060,    0.6766327726,    0.3981461390,    0.6978437422,    0.3915602230,    0.3915341265,    0.4189492156,
    0.6067968512,    0.3499881592,    0.3542012539,    0.5053609090,    0.1002964370,    0.1430103402,    0.3812111647,    0.3923708759,    0.7700594891,    0.3444127926,
    0.9384834699,    1.0255714183,    66.5496060541,    0.1740844632,    0.0814389478,    0.2168531686,    0.0616576235,    2.9567566714,    7.5983525845,    0.0932466535,
    4.9725106860,    48.7613967252,    97.5264418960,    2.7173595374,    48.7609213404,    0.7639321541,    0.0724955027,    0.6851875262,    40.6911333225,    1.0244304052,
    1.2080448522,    1.0000000000,    1.0000000000,    1.0000000000,    0.0763978997,    0.1629570649,    1.0000000000,    1.6244747685,    0.3088719444,    4.0124276919,
    0.1202532808,    0.7142941081,    2.6712766814,    1.0943005101,    0.1340111382,    0.2946541699,    0.8315658749,    1.3519533845,    0.6015382673,    0.6659915680,
    1.0000000000,    0.2681378251,    1.0000000000,    0.0262273875,    0.3381937713,    0.1369943413,    0.1836662200,    0.0131170807,    0.2117969029,    0.3783060040,
    0.3787678916,    0.2030077305,    0.1279978783,    0.0131170807,    0.6184648555,    0.7522747209,    0.9497340875,    0.1418681012,    1.1528896006,    0.0917563283,
    0.1127441869,    0.1012769193,    0.3859421731,    0.0490246828,    0.0262273875,    0.1179493256,    0.2436677661,    1.0000000000,    0.1569665575,    0.1949234750,
    0.3496866349,    0.1027403696,    0.0692476016,    0.1269398748,    0.9067886949,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,
    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,
    0.3598991894,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    0.1648504076,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,
    0.1743424782,    0.1679724851,    0.0951875242,    0.2111960701,    0.1721077255,    0.2430709076,    0.1865900659,    0.1594196537,    0.1769348260,    0.1876087555,
    0.5187976520,    0.2073289930,    0.2173434825,    0.0131170807,    0.3111932531,    0.2173434825,    0.4526157608,    0.2563012060,    0.4060154611,    0.2538797496,
    1.0000000000,    1.0000000000,    1.0000000000,    0.0855152078,    0.0976317963,    1.0000000000,    3.4944974078,    1.1056887034,    0.5974308279,    1.2279236275,
    0.9620506657,    0.8168984561,    5.0766479852,    0.7162254762,    14.3059751726,    0.1487496687,    0.0859883693,    0.0939643645,    0.8424792446,    0.1335615477,
    0.0301704566,    0.0946375106,    0.8206848149,    1.0000000000,    0.6401764391,    0.9638242196,    0.6651593132,    0.1613528728,    0.0826504487,    0.4709088573,
    5.1520794673,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,
    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.1669995542,    1.0000000000,    1.0000000000,    1.0000000000,
    1.0000000000,    0.3588946176,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    0.9408220718,    0.9254591272,    0.4514070566,    0.6582880333,
    0.4928341910,    0.5788323712,    0.4392207233,    0.3032667294,    0.2777414044,    0.1906203225,    4.9391695927,    1.9331192218,    1.8258812252,    0.1088608390,
    2.2512091126,    2.8169253084,    0.4421945976,    0.1795593888,    0.4415585774,    0.6657119617,    0.4338798619,    0.6256536644,    2.7837802411,    1.6194356026,
    3.5414620371,    5.2124338028,    2.3505240893,    0.2479276340,    1.5385316459,    0.1834114239,    0.1221661363,    0.3362087019,    0.0683561625,    0.0187101708,
    0.3158207465,    0.2599039451,    0.0076928615,    0.0412256037,    1.8342679593,    17.8025715726,    68.5618899474,    0.1051667984,    0.8794177371,    9.9799239555,
    10.6217707723,    20.7236799441,    12.3500133095,    11.3371390626,    68.7593965066,    1.7253448947,    0.1250752290,    0.3173164421,    1.4322957259,    2.2776536486,
    0.2093668204,    0.0386115698,    0.0307760164,    4.7454555029,    0.4309609810,    1.4387516412,    0.4511576621,    3.0610943153,    0.2831953330,    0.2048198725,
    3.8636811134,    2.5992875497,    0.1099116857,    0.1959519690,    0.9670389818,    0.2761445860,    3.4441977775,    0.4086940655,    0.2679411090,    0.1720654577,
    0.4719217949,    2.2842407404,    0.7462067851,    0.0781938133,    0.5814958782,    0.6160227534,    2.9701742695,    35.7743040902,    1.3980341659,    0.1976621341,
    0.4342168772,    3.1118515598,    0.9046652931,    4994.8175183909,    0.2234898560,    1.4178783768,    0.0038381848,    0.0143254451,    5.4929313628,    0.0680857523,
    0.6882295413
};

// Selected feature indices
constexpr int N_SELECTED_FEATURES = 500;
static const int SELECTED_FEATURES[N_SELECTED_FEATURES] = {
    0,    12,    15,    16,    17,    25,    26,    27,    34,    38,    65,    66,    67,    75,    78,    80,    83,    84,    85,    86,
    89,    91,    94,    95,    97,    122,    133,    141,    155,    156,    157,    158,    159,    160,    186,    215,    218,    291,    293,    294,
    295,    296,    297,    299,    300,    302,    303,    306,    307,    309,    312,    313,    315,    318,    320,    321,    322,    325,    327,    331,
    335,    337,    338,    339,    349,    350,    357,    366,    367,    381,    383,    384,    389,    391,    394,    395,    422,    452,    455,    506,
    516,    521,    526,    532,    543,    544,    560,    565,    578,    580,    584,    585,    588,    589,    590,    607,    624,    625,    626,    632,
    645,    652,    655,    659,    665,    670,    673,    687,    688,    689,    690,    698,    699,    719,    726,    727,    728,    732,    735,    738,
    739,    747,    748,    749,    752,    753,    755,    763,    764,    771,    772,    774,    777,    778,    780,    783,    792,    795,    796,    798,
    799,    805,    809,    813,    814,    817,    818,    819,    822,    828,    832,    833,    836,    839,    840,    841,    842,    843,    851,    852,
    855,    857,    868,    869,    873,    878,    882,    883,    885,    886,    906,    909,    910,    914,    923,    932,    940,    943,    949,    950,
    952,    953,    960,    962,    965,    968,    970,    988,    989,    997,    1000,    1010,    1021,    1028,    1039,    1043,    1049,    1050,    1053,    1054,
    1055,    1056,    1057,    1064,    1066,    1069,    1071,    1077,    1078,    1081,    1088,    1111,    1115,    1118,    1121,    1127,    1129,    1133,    1135,    1136,
    1138,    1141,    1144,    1147,    1149,    1154,    1156,    1158,    1160,    1170,    1180,    1185,    1241,    1288,    1303,    1308,    1335,    1342,    1357,    1367,
    1377,    1388,    1390,    1391,    1392,    1393,    1394,    1395,    1396,    1397,    1398,    1399,    1400,    1401,    1402,    1403,    1404,    1405,    1406,    1407,
    1408,    1409,    1410,    1411,    1412,    1413,    1414,    1415,    1416,    1417,    1418,    1419,    1420,    1421,    1422,    1423,    1424,    1425,    1426,    1427,
    1428,    1429,    1430,    1431,    1432,    1433,    1434,    1435,    1436,    1437,    1438,    1439,    1440,    1441,    1442,    1443,    1444,    1445,    1446,    1447,
    1448,    1449,    1450,    1451,    1452,    1453,    1454,    1455,    1456,    1457,    1458,    1459,    1460,    1461,    1462,    1463,    1464,    1465,    1466,    1467,
    1468,    1469,    1470,    1471,    1472,    1473,    1474,    1475,    1476,    1477,    1478,    1479,    1480,    1481,    1482,    1483,    1484,    1485,    1486,    1487,
    1488,    1489,    1490,    1491,    1494,    1495,    1496,    1497,    1498,    1499,    1500,    1501,    1502,    1503,    1504,    1505,    1506,    1507,    1509,    1516,
    1523,    1527,    1535,    1536,    1537,    1538,    1539,    1540,    1541,    1542,    1543,    1544,    1545,    1546,    1547,    1548,    1549,    1550,    1551,    1552,
    1553,    1554,    1555,    1556,    1557,    1558,    1559,    1560,    1561,    1562,    1563,    1564,    1565,    1566,    1567,    1568,    1569,    1570,    1571,    1572,
    1573,    1574,    1575,    1576,    1577,    1578,    1579,    1580,    1581,    1582,    1583,    1584,    1585,    1586,    1587,    1588,    1589,    1590,    1591,    1592,
    1593,    1600,    1613,    1614,    1616,    1637,    1642,    1646,    1690,    1694,    1698,    1736,    1737,    1788,    1792,    1806,    1807,    1810,    1812,    1824,
    1826,    1831,    1837,    1841,    1853,    1860,    1865,    1872,    1878,    1885,    1886,    1890,    1893,    1894,    1901,    1958,    1974,    1978,    2000,    2005,
    2093,    2165,    2166,    2234,    2241,    2251,    2252,    2255,    2268,    2276,    2405,    2406,    2447,    2472,    2495,    2528,    2707,    3041,    3076,    3142,
    3158,    3399,    3501,    3597,    3766,    3769,    3770,    3782,    3785,    3796,    3817,    3824,    3835,    3839,    3842,    3843,    3857,    3858,    4041,    4068
};

// Feature order metadata
constexpr int N_CASCADE_FEATURES = 1;
constexpr int N_PHYSICS_FEATURES = 0;
// Cascade feature names (in order)
static const char* CASCADE_FEATURE_NAMES[N_CASCADE_FEATURES] = {
    "V",
};

// Prediction function using Treelite compiled library
// TL2cgen generates: size_t predict(union Entry* data, size_t num_row, float* result)
// Library path: /Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/polarizability_v34_treelite.dylib
extern "C" {
    // Forward declaration of TL2cgen prediction function
    typedef struct {
        float missing_value;
        float fvalue;
    } Entry;
    
    // Function pointer type for prediction
    typedef size_t (*PredictFunc)(Entry* data, size_t num_row, float* result);
}

// Load library and get prediction function (called once at initialization)
static void* lib_handle = nullptr;
static PredictFunc predict_func = nullptr;

static bool load_treelite_library() {
    if (lib_handle != nullptr) return true;  // Already loaded
    
    const char* lib_path = "/Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/polarizability_v34_treelite.dylib";
    lib_handle = dlopen(lib_path, RTLD_LAZY);
    if (!lib_handle) {
        return false;
    }
    
    // Get prediction function
    predict_func = (PredictFunc)dlsym(lib_handle, "predict");
    if (!predict_func) {
        dlclose(lib_handle);
        lib_handle = nullptr;
        return false;
    }
    
    return true;
}

inline double predict(const double* features) {
    // Ensure library is loaded
    if (!load_treelite_library()) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Normalize features
    double normalized[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        normalized[i] = (features[i] - COL_MEANS[i]) / COL_STDS[i];
    }
    
    // Convert to TL2cgen Entry format
    Entry data[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        data[i].missing_value = -1.0f;  // No missing values
        data[i].fvalue = static_cast<float>(normalized[i]);
    }
    
    // Call Treelite prediction
    float result[1];
    size_t num_output = predict_func(data, 1, result);
    if (num_output == 0) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Denormalize target
    double pred_norm = static_cast<double>(result[0]);
    double pred = pred_norm * TARGET_SCALE + TARGET_MEAN;
    
    return pred;
}

} // namespace CascadePolarizability
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit

// Wrapper struct for template parameter (C++ doesn't allow namespaces as template parameters)
// Must be outside the namespace to reference it
namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadePolarizability {
struct Model {
    using Namespace = CascadePolarizability;
};
} // namespace CascadePolarizability
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit
