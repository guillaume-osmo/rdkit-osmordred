#pragma once
// Auto-generated Treelite model for RI (v3.4 XGBoost)
// Trees: 300, Features: 538
// Target normalization: mean=1.4810107715, scale=0.0892849183
// Library: ri_v34_treelite.so

#include <vector>
#include <cmath>
#include <algorithm>
#include <dlfcn.h>  // For loading shared library
#include <limits>

namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadeRI {

constexpr int N_TREES = 300;
constexpr int N_FEATURES = 538;
constexpr double TARGET_MEAN = 1.4810107715;
constexpr double TARGET_SCALE = 0.0892849183;

// Normalization stats
constexpr int N_NORM_FEATURES = 538;
static const double COL_MEANS[N_NORM_FEATURES] = {
    0.0187868369,    0.0047888016,    0.0025785855,    0.2250736739,    0.0616404715,    0.0259086444,    0.0088408644,    0.1094056974,    0.0310658153,    0.0764980354,
    0.0147347741,    0.0261542240,    0.0077357564,    0.0523084479,    1.7188113949,    3.0555009823,    0.0302062868,    0.0149803536,    0.0702357564,    0.6474705305,
    0.3897347741,    0.0128929273,    0.0057711198,    0.0012278978,    0.4727406680,    0.2481581532,    0.1013015717,    1.9760559921,    0.1344548134,    0.3500736739,
    0.0067534381,    0.1673624754,    0.0224705305,    0.3314096267,    0.4101178782,    0.3377946955,    3.9322200393,    3.2959233792,    0.1737475442,    0.2540520629,
    0.7872053045,    8.2568651081,    0.5490342509,    -0.3261712825,    0.5143669519,    15.0048113217,    185.8726164047,    185.5564129557,    0.1702804816,    -0.3195811257,
    0.3327849603,    1.1966761740,    24.1439299472,    10.2099756719,    2.0751821997,    -2.0502196064,    2.1388346425,    0.2681517464,    2.9216149395,    217.5615275292,
    3.5310386039,    5.2648555866,    10.9280792634,    76.4456797346,    4.4979982112,    0.5986963788,    2.2900120627,    2.4700287186,    1.3306103185,    9.8035765405,
    0.8190899100,    30.4128725685,    4.8592216296,    1.1760578820,    12.7616595090,    28.3911068413,    0.9232541753,    25.0994781434,    4.9820662009,    5.9054011845,
    8.6983447267,    14.1990514457,    5.9354443820,    3.4936653814,    0.8533485718,    3.2126995029,    0.4010314342,    4.6638140770,    2.6871866380,    49.7012903242,
    0.0184184676,    0.0573428291,    2.1842208889,    1.1690689378,    122.7112315428,    91.2178301344,    83.5613948919,    178.8055285502,    742.4350442043,    606.6407170923,
    400.5813588756,    163.7990685044,    37.9527223228,    6.5687266424,    2.6826230372,    3.1718526975,    2.2174098784,    1.3790423252,    5.8293882368,    3.0884331600,
    3.8152707014,    1.4546728125,    20.3633930737,    192.9997265408,    93.9374797421,    73.8768745177,    7.1660652483,    4.2583711089,    6.3704474177,    6.2832370176,
    5.9729791115,    1.5065216360,    1.4417855886,    1.2421734399,    0.7941968172,    167.4753473461,    158.4944968162,    162.8407323869,    -0.1810134987,    -0.0038688226,
    -0.0005371093,    -0.0116486712,    -0.0048910714,    77.2329305136,    20.1636381617,    -18.1005826041,    -0.2038365848,    -0.4972877890,    0.4285847234,    -3.8715013990,
    6.9975864076,    -4.2617191814,    -5.4773459123,    -1.9416425255,    319.2237450927,    -3.4627465982,    -43.6208107804,    -18.6607915558,    -40.4308466577,    -198.4099066137,
    -85.4766729254,    -62.3285096947,    0.2909631483,    -0.1117369788,    -0.1463231349,    -0.3702776551,    -0.1648933939,    -0.1099434780,    0.4791310711,    -0.3743419893,
    -0.3094014572,    -3.1526573396,    -9.4106314890,    -5.4839055936,    1.3502028197,    -0.0002539209,    0.0000617723,    -0.0002577535,    0.0006216675,    -0.2063054328,
    0.1489426245,    -0.0782660298,    -0.0411749176,    -0.2147129611,    -0.1735173398,    -0.4749303775,    -1.8566129394,    -1.5327323364,    -5.8729658114,    -2.0294656455,
    -0.0068410076,    -0.0100433425,    -0.0000284023,    0.1368589060,    0.0006131914,    1.7207899002,    -0.0892643192,    0.0097985187,    -0.3974500260,    -0.0316936447,
    -0.0189220284,    0.0262380695,    -0.0313242845,    -0.1381340587,    0.2047572015,    -0.1390817809,    -0.0049507355,    0.0581628399,    -0.1104442469,    -0.0475543659,
    -0.0346898512,    -0.0327152200,    -0.0333818475,    -0.0511801130,    -0.0621334796,    0.0035022430,    0.0500309957,    1.4232262257,    1.0488869715,    0.9057061434,
    0.6346542830,    1.2020250734,    1.5361282653,    1.1561971812,    0.9051623168,    0.7087778331,    0.7371037496,    1.0078700046,    0.9053149321,    0.5312614441,
    0.9636851465,    0.9545501677,    1.0422263253,    1.1952346777,    1.0925191302,    0.9817004078,    0.8736607384,    0.8677695677,    1.2598284536,    0.8496911974,
    0.5922000453,    1.3605714634,    0.3723986146,    5.3926123175,    3.2322315681,    0.9943512102,    5.4685265976,    1.2145653243,    11.3542895571,    3.5810477200,
    2.5028968925,    0.8989657861,    13.8049914371,    10.9464865077,    0.5103838198,    3.6489440079,    0.3533437161,    0.2170963896,    0.0185412574,    0.0041666347,
    0.0082179834,    0.0280835981,    0.0942093326,    0.1623649748,    0.0034275321,    0.0068665103,    0.0202695984,    0.0530209789,    0.0873149121,    0.9844234509,
    0.0864834244,    0.3050351470,    0.0922604330,    0.5783054855,    0.0521175967,    0.1108539451,    0.0222285686,    1.7889613457,    2.3361917988,    3.1901456230,
    0.8939780277,    1.0635879712,    1.2797662086,    9.2992579069,    5.7494343938,    4.9916668030,    3.5038717302,    2.4125116066,    1.6136433782,    0.9617957380,
    0.5463061755,    0.7743564287,    0.4958245230,    0.3492254082,    0.2333421158,    0.1512075893,    0.0911713434,    0.0574371183,    0.0338552232,    8.0229063025,
    4.6084522256,    3.5326990095,    2.2393410468,    1.3979595992,    0.8459763306,    0.4781856805,    0.2484255497,    0.6746646761,    0.4040760502,    0.2600434049,
    0.1603128559,    0.0968567236,    0.0539365761,    0.0314156330,    0.0166529431,    16.5247421415,    15.4751991012,    15.5807673414,    26.7947786081,    25.6809733618,
    26.0151188605,    17.1389943695,    30.5137381421,    0.6887145727,    0.6578171519,    0.6000186170,    1.0126180501,    0.9748962898,    0.9870755147,    0.6538568457,
    1.1424767491,    134.1336935255,    66.8617173216,    94.6732940477,    0.6474705305,    0.0076129666,    0.0416257367,    0.6038801572,    0.8780697446,    0.0951620825,
    0.3962426326,    0.0000000000,    0.0606581532,    0.0000000000,    0.0008595285,    0.0599214145,    0.0088408644,    0.0243123772,    0.0000000000,    0.0445726916,
    0.0319253438,    0.0125245580,    0.0000000000,    0.2953094303,    0.5446954813,    0.4638998035,    0.0196463654,    0.4970530452,    0.0000000000,    0.0000000000,
    0.0000000000,    0.0407695276,    0.0330648997,    0.0938006565,    0.0184905294,    0.1016190802,    0.0269182757,    0.0198641759,    0.5841412665,    0.4385975411,
    2.2786688576,    0.5793312477,    0.0498683010,    0.3915771674,    0.3986477666,    0.5725454375,    0.0000000000,    0.1385278916,    1.1645728330,    0.4899314667,
    0.1857996403,    0.8655401841,    4.0815938114,    0.3187402723,    0.4299677124,    0.8387829642,    0.0229747227,    0.1354201207,    0.1640592726,    2.0969392889,
    0.7597435918,    0.4630412503,    0.7719580688,    3.2315904411,    2.4595756969,    1.5603169719,    1.1229869768,    0.9820445043,    0.9524864431,    14.9122572162,
    23.4558377942,    27.7314131337,    29.4640210238,    29.9780350565,    29.9360589888,    45.9913309282,    34.5079900106,    29.3079228822,    26.0552243862,    24.7512730430,
    23.8640366280,    10.8266646812,    5.7302735568,    5.0005613650,    0.9056974460,    0.3425834971,    146.4074152750,    76.4456797346,    4.4979982112,    0.8190899100,
    3.0220415841,    30.4128725685,    4.8592216296,    16.8294548345,    0.0000000000,    1.3678609351,    1.1760578820,    12.7616595090,    4.6401002906,    4.3475363668,
    28.3911068413,    13.6740909409,    0.6081691672,    0.9232541753,    0.0000000000,    2.7773802328,    0.8556961814,    4.2917840821,    4.9820662009,    5.9054011845,
    8.6983447267,    14.1990514457,    4.7040011956,    7.6759600420,    13.9336624594,    5.9029342426,    5.4459790536,    8.7394213916,    0.1845752451,    0.0093777183,
    0.0133647585,    0.4097540497,    1.4893401395,    0.6496638350,    0.0576541349,    2.9617021945,    2.7031940286,    5.1830790164,    0.0435903733,    0.0208742633,
    0.0208742633,    0.0071218075,    0.2858981230,    27.3641134578,    0.2485524601,    0.0882927723,    0.0201999708,    115.3023322692,    13.0692738345,    2.5612721022,
    0.3332289467,    1.4982636253,    0.0208146068,    3.8858385591,    0.4940496730,    0.0666709466,    0.0077527731,    0.1867201292,    0.1547174778,    0.4600821958,
    0.0895884610,    0.3430476885,    0.1161661491,    0.0561765453,    0.0822150663,    0.0561504543,    0.0478087550,    1.8269389055,    0.1830366830,    0.0411604533,
    0.0204900254,    0.0403610416,    0.0198697774,    0.0283294261,    0.0575329659,    0.4878803928,    0.0624183877,    0.0513178804,    0.0173915294,    0.0520198396,
    0.1263233770,    0.1368045187,    0.8509004175,    0.6248580550,    5.7200990914,    0.6208797499,    55.7044449953,    2.0699931421,    1.9664766977,    0.4976382374,
    0.0057711198,    0.0001227898,    0.0917239686,    1.4640632826,    131.8749414191,    5.7748429468,    0.6176184619,    0.5470132224,    1.0806482584,    0.0000000000,
    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.6908631914,    0.7682842556,
    -2.7807103899,    9.1369697869,    0.4758720825,    1.3991987843,    6.4087331656,    1.3747664980,    4.2382424750,    9.2983384489,    146.4063282582,    1.3102975547,
    175.6331309973,    0.2810200702,    0.0809257918,    1.4809557308,    0.0237926912,    89.6231473631,    0.7464496908,    0.2810200702
};

static const double COL_STDS[N_NORM_FEATURES] = {
    0.2149055208,    0.1008395728,    0.0553452391,    0.5916121248,    0.3255372775,    0.2559539718,    0.1011740133,    0.4816779982,    0.1979575067,    0.5098901183,
    0.1420070088,    0.1764043951,    0.1065814617,    0.2486991206,    1.5810642016,    4.4232001539,    0.2080670624,    0.1302542082,    0.3524794904,    1.1499171349,
    0.7094456235,    0.1160320578,    0.0819764130,    0.0414433257,    1.9443367851,    0.9293215550,    0.3330638201,    2.6140566380,    0.6600228440,    0.6928043681,
    0.0833871019,    0.7229813155,    0.1609188578,    0.6917033424,    1.1369943600,    1.2355116536,    5.9165632101,    6.7229303738,    0.7202811358,    0.9094141907,
    1.7241718348,    3.4481189199,    0.6776969009,    1.6925128109,    0.1342775451,    9.8384858607,    92.7016516677,    92.4513636814,    0.1457089191,    0.1458415171,
    0.1461905231,    0.3769273569,    19.2045335064,    0.9622103359,    0.2700237634,    0.2002230486,    0.2397117077,    0.5659118466,    0.6813526013,    205.6528042393,
    2.2004920475,    4.3652269174,    182.4970908595,    37.0610897825,    5.6283114843,    2.3417361702,    3.8350927242,    8.2560964767,    4.7822789996,    13.8396648332,
    2.7993169166,    31.2793127868,    7.4911127056,    3.1105655462,    12.8848414339,    31.0166158719,    3.7415032199,    26.7686873126,    7.2536176074,    7.5986016455,
    9.9767421406,    24.9958382074,    8.2386324278,    7.0133746038,    2.0672687462,    7.1738404268,    0.9409265367,    4.3686952320,    2.0040432010,    25.4591227627,
    0.1475226123,    0.2764097858,    0.2298044201,    0.1007820407,    94.3838023944,    191.9410450061,    52.5314029275,    203.8136710775,    717.4337511804,    318.0817309530,
    397.2646064027,    85.8888906236,    20.1493292447,    6.4843280995,    5.8692992784,    0.9718141126,    0.6725405551,    0.7485231910,    7.3397079790,    1.3849559733,
    4.4682797735,    3.9733157013,    28.9815315277,    54.9811121551,    63.4250457188,    64.6883279121,    2.2801765720,    3.6867338561,    1.1289141905,    0.6595540148,
    1.7275947866,    0.6689989939,    0.5520373966,    0.4143291111,    0.4901978940,    15.0665776722,    14.3595696552,    20.4747399065,    0.2059629806,    0.1612663117,
    0.1756614681,    0.1825650940,    0.1539988069,    47.2474789045,    20.7519011655,    32.8420463885,    27.9667565883,    4.5028504755,    3.4631099775,    6.5284289108,
    21.5738586383,    23.0593227713,    25.2032033907,    20.7402401883,    428.6599192709,    136.7294510559,    153.2575917124,    111.3620816421,    90.4069610022,    507.9898468815,
    461.7950392785,    486.3843821246,    0.9382186747,    0.8517164768,    0.8045205087,    1.3746199291,    1.3023377884,    0.4664745497,    1.5294201467,    1.5514246916,
    0.8758575173,    6.3286480719,    18.1380128437,    16.8231185945,    11.3814075444,    0.0054647774,    0.0053804389,    0.0054296151,    0.0069418068,    1.6695684715,
    1.3939601530,    0.0947648453,    0.1171915514,    0.4882383235,    0.9838370936,    8.3961575551,    9.8031385612,    8.5263162109,    64.5626829226,    3.8862717603,
    0.0338034687,    0.0444856064,    0.0416822372,    0.1486501230,    0.0700953498,    1.4691612841,    0.4501594960,    0.6706687582,    0.2259737177,    0.1836069482,
    0.1697295014,    0.2594724786,    0.1909681969,    0.1983418962,    0.2345536719,    0.1576943758,    0.2011516360,    0.1825393101,    0.1926076110,    0.0979681656,
    0.1221471193,    0.3432828671,    0.1205354372,    0.1694466487,    0.1898021221,    0.2280920769,    0.2678327216,    0.2894808225,    0.3448779023,    0.4986018677,
    0.7065992618,    0.3577031788,    0.4444145212,    0.3727749200,    0.4073281265,    0.4613755344,    0.2922307159,    0.3617489352,    0.8646602621,    0.9007750470,
    0.3127790650,    0.2467392439,    0.3632265356,    0.2921799408,    0.2527800603,    0.2955199984,    0.3126103169,    0.3360278779,    0.3755282884,    0.4513425078,
    0.6262142721,    0.3188135213,    0.0988164514,    1.2089593478,    0.5513000775,    0.1157144366,    2.1523045986,    0.2661248329,    8.1732613617,    0.2925832777,
    0.0677697257,    0.2994611449,    1.5385189764,    0.2384434125,    0.7394516218,    4.3231360457,    0.1601725639,    0.1158148064,    0.1717385783,    0.0327205248,
    0.0571061817,    0.1076314714,    0.2084899272,    0.4119555554,    0.0278461970,    0.0505909651,    0.0898823740,    0.1682386208,    0.3508867890,    1.0183192104,
    0.1912964435,    0.7626989248,    0.3866049644,    0.8290661256,    0.2912855249,    0.3005453863,    0.1112255421,    2.2634851331,    3.4460188009,    5.9439798852,
    1.2714687458,    2.0055314874,    3.4212033078,    4.4560785131,    2.9731298522,    2.8109536390,    2.4167394295,    2.0361138673,    1.6792207516,    1.2219413229,
    0.8765054640,    0.0484175951,    0.0508831912,    0.0598773436,    0.0630913370,    0.0612268525,    0.0510611909,    0.0394264826,    0.0285837090,    3.9606205371,
    2.5800742071,    2.1999462821,    1.7472853013,    1.3859527381,    1.0571990154,    0.7590205408,    0.5073228818,    0.1277140398,    0.1267252174,    0.1600484727,
    0.1214035016,    0.0971717908,    0.0673121971,    0.0444314930,    0.0271399345,    8.0700039812,    7.7180627481,    8.2160629405,    14.8374109724,    14.0496027836,
    14.2530171718,    9.3476620637,    17.3953697128,    0.3440041669,    0.3910810314,    0.0932386125,    0.0659529351,    0.0871920219,    0.0919665487,    0.1019623245,
    0.0449184023,    182.5416200765,    89.4308381607,    121.5823507075,    1.1499171349,    0.0923976602,    0.2429984384,    0.9144467411,    1.5988977069,    0.5605797704,
    1.0035744702,    1.0000000000,    0.2700766809,    1.0000000000,    0.0293051139,    0.2983168134,    0.1093400107,    0.1756220174,    1.0000000000,    0.2562624555,
    0.2198687462,    0.1522274429,    1.0000000000,    0.6984389009,    0.7494047118,    0.7844406099,    0.1481950100,    1.9611880343,    1.0000000000,    1.0000000000,
    1.0000000000,    1.2489376661,    0.9552778582,    0.6290298389,    0.2456690000,    0.7695259414,    0.3865475023,    0.2253537744,    3.1313816523,    2.0885371012,
    5.4531240554,    1.6885461755,    0.3703884288,    1.7751447822,    0.7624058290,    1.6678447869,    1.0000000000,    0.6500438959,    3.0335740235,    0.0677621369,
    0.1256843395,    0.3352053208,    4.5524264201,    0.1036280204,    0.0075299717,    0.1643413132,    0.0454043240,    0.1121751677,    0.1849217453,    0.4712992678,
    0.1301809750,    0.1294271676,    0.1260235675,    0.8883460855,    0.9172372104,    0.8063948572,    0.7114256945,    0.6449665719,    0.6269686233,    8.8835910724,
    9.2072363593,    10.2230326791,    11.1122886130,    11.4821194460,    11.6477001092,    22.7700563956,    18.4907877067,    16.5747436783,    14.3383456011,    13.0707361326,
    12.3240308068,    5.5742293256,    4.4651122902,    4.6005120898,    0.2922491785,    0.4745735397,    73.3605616810,    37.0610897825,    5.6283114843,    2.7993169166,
    6.2276433264,    31.2793127868,    7.4911127056,    19.7508406219,    1.0000000000,    3.8780380669,    3.1105655462,    12.8848414339,    5.9598580893,    7.2100797768,
    31.0166158719,    16.4508245091,    3.5209505477,    3.7415032199,    1.0000000000,    8.8098736353,    3.0657876624,    9.9062604620,    7.2536176074,    7.5986016455,
    9.9767421406,    24.9958382074,    8.3323581895,    12.2611996086,    15.6916872710,    11.1171092715,    9.3106051851,    23.9088917454,    0.4838983052,    0.0999392776,
    0.1397657239,    0.3203758156,    0.3630750646,    1.5753027150,    0.1340967150,    1.8070882374,    1.9673891108,    1.5242902799,    0.2130116104,    0.1446709630,
    0.1455172399,    0.0840897575,    0.2417556400,    28.1405009543,    0.1384329720,    0.0427401864,    0.0190909173,    76.6700048931,    218.5750207253,    3.4664655276,
    0.7810379724,    1.5297671465,    0.1407072817,    3.1194049576,    0.9283802652,    0.2821857628,    0.0967367267,    0.3315971880,    0.1554864798,    0.4185062414,
    0.3786003448,    1.0855764663,    0.4243177286,    0.3910271497,    0.6309054024,    0.3268383822,    0.2781905405,    3.5192334975,    1.1684741339,    0.4114938498,
    0.2033605382,    0.2001117775,    0.1610334755,    0.2429398654,    0.5248771231,    2.8741035760,    0.7761314336,    0.2537838923,    0.2478822629,    0.2580553556,
    0.3360361579,    0.2783380769,    0.6201864522,    0.6401673463,    3.2135362278,    0.3818709118,    236.9297131039,    0.3109259160,    0.3879138798,    0.2660361322,
    0.1217549097,    0.0110803748,    0.3722446573,    0.7272530041,    66.0418376701,    3.2426302749,    0.6547687808,    0.4404384027,    0.3058828968,    1.0000000000,
    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    0.5394370273,    1.6189288063,
    1.1851664500,    9.9259580631,    1.5660248612,    2.8387749996,    18.5108543201,    1.6059416507,    2.3484179562,    0.8127359112,    72.7253004073,    0.3920698255,
    84.1554031180,    0.0441985515,    0.0252729184,    0.0848293724,    0.0055181382,    7.5832814060,    0.1140786338,    0.0441985515
};

// Selected feature indices
constexpr int N_SELECTED_FEATURES = 503;
static const int SELECTED_FEATURES[N_SELECTED_FEATURES] = {
    0,    1,    4,    15,    16,    17,    18,    26,    27,    35,    36,    38,    62,    64,    66,    67,    70,    73,    75,    78,
    83,    88,    90,    92,    95,    97,    100,    111,    133,    140,    149,    157,    171,    182,    183,    214,    215,    218,    226,    230,
    233,    291,    293,    294,    295,    296,    297,    299,    302,    303,    304,    306,    309,    310,    311,    312,    313,    316,    318,    319,
    327,    335,    336,    337,    338,    341,    344,    346,    347,    353,    355,    357,    358,    362,    366,    369,    372,    374,    378,    379,
    380,    381,    388,    389,    390,    393,    418,    419,    421,    422,    445,    487,    513,    516,    544,    548,    553,    564,    570,    571,
    602,    606,    624,    642,    646,    652,    654,    657,    660,    661,    662,    668,    672,    689,    693,    694,    701,    704,    707,    715,
    718,    723,    725,    726,    729,    732,    734,    735,    742,    743,    744,    745,    746,    750,    751,    754,    758,    765,    767,    769,
    770,    771,    772,    774,    777,    779,    781,    784,    796,    799,    800,    802,    806,    810,    811,    816,    819,    823,    824,    825,
    832,    841,    843,    844,    848,    851,    852,    853,    857,    864,    866,    869,    871,    877,    879,    887,    888,    889,    899,    904,
    915,    916,    920,    930,    938,    948,    950,    953,    957,    958,    960,    962,    966,    967,    973,    975,    977,    982,    991,    1005,
    1013,    1018,    1029,    1038,    1048,    1049,    1050,    1053,    1055,    1057,    1067,    1069,    1070,    1071,    1072,    1073,    1078,    1079,    1082,    1084,
    1085,    1086,    1088,    1101,    1103,    1104,    1109,    1110,    1133,    1137,    1139,    1141,    1149,    1151,    1153,    1154,    1155,    1156,    1157,    1163,
    1164,    1170,    1171,    1172,    1271,    1285,    1288,    1289,    1291,    1301,    1302,    1303,    1304,    1305,    1306,    1307,    1308,    1309,    1310,    1311,
    1312,    1313,    1314,    1315,    1316,    1317,    1318,    1319,    1320,    1321,    1322,    1323,    1324,    1325,    1326,    1327,    1328,    1329,    1330,    1331,
    1332,    1333,    1334,    1335,    1336,    1337,    1338,    1339,    1340,    1341,    1342,    1343,    1344,    1345,    1346,    1347,    1348,    1349,    1350,    1351,
    1352,    1353,    1354,    1355,    1356,    1357,    1358,    1359,    1360,    1361,    1362,    1363,    1364,    1365,    1366,    1367,    1368,    1369,    1370,    1371,
    1372,    1373,    1374,    1375,    1411,    1412,    1413,    1414,    1415,    1416,    1417,    1418,    1419,    1420,    1421,    1422,    1423,    1424,    1425,    1428,
    1429,    1430,    1431,    1432,    1433,    1434,    1435,    1436,    1437,    1438,    1439,    1512,    1515,    1517,    1531,    1536,    1548,    1586,    1590,    1591,
    1597,    1654,    1684,    1692,    1712,    1755,    1765,    1771,    1791,    1805,    1807,    1810,    1813,    1820,    1837,    1839,    1843,    1847,    1850,    1855,
    1869,    1873,    1877,    1878,    1879,    1880,    1881,    1882,    1883,    1884,    1885,    1886,    1887,    1888,    1889,    1890,    1891,    1892,    1893,    1894,
    1895,    1896,    1897,    1898,    1899,    1900,    1901,    1902,    1903,    1918,    1919,    1920,    1921,    1922,    1923,    1924,    1925,    1926,    1927,    1928,
    1929,    1930,    1931,    1932,    1933,    1934,    1935,    1936,    1937,    1938,    1939,    1940,    1941,    1942,    1943,    1944,    1945,    1946,    1967,    1970,
    1973,    1978,    1980,    1981,    1982,    2001,    2002,    2007,    2050,    2111,    2115,    2143,    2149,    2153,    2164,    2165,    2168,    2210,    2216,    2235,
    2248,    2251,    2253,    2254,    2257,    2260,    2266,    2268,    2272,    2275,    2298,    2310,    2347,    2362,    2365,    2374,    2379,    2405,    2407,    2411,
    2470,    2472,    2500,    2501,    2513,    2520,    2521,    3108,    3258,    3473,    3594,    3765,    3768,    3769,    3770,    3800,    3827,    3833,    3845,    3852,
    3999,    4080,    4088
};

// Feature order metadata
constexpr int N_CASCADE_FEATURES = 6;
constexpr int N_PHYSICS_FEATURES = 9;
// Cascade feature names (in order)
static const char* CASCADE_FEATURE_NAMES[N_CASCADE_FEATURES] = {
    "V",
    "Polarizability",
    "L",
    "E",
    "B",
    "Density",
};

// Physics feature names (in order)
static const char* PHYSICS_FEATURE_NAMES[N_PHYSICS_FEATURES] = {
    "ri_e_logvp_est",
    "ri_e_sq",
    "ri_logvp_sq",
    "ri_dd_l_est",
    "ri_dd_sq",
    "ri_l_sq",
    "ri_dd_e_est",
    "ri_dd_sq",
    "ri_e_sq",
};

// Prediction function using Treelite compiled library
// TL2cgen generates: size_t predict(union Entry* data, size_t num_row, float* result)
// Library path: /Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/ri_v34_treelite.dylib
extern "C" {
    // Forward declaration of TL2cgen prediction function
    typedef struct {
        float missing_value;
        float fvalue;
    } Entry;
    
    // Function pointer type for prediction
    typedef size_t (*PredictFunc)(Entry* data, size_t num_row, float* result);
}

// Load library and get prediction function (called once at initialization)
static void* lib_handle = nullptr;
static PredictFunc predict_func = nullptr;

static bool load_treelite_library() {
    if (lib_handle != nullptr) return true;  // Already loaded
    
    const char* lib_path = "/Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/ri_v34_treelite.dylib";
    lib_handle = dlopen(lib_path, RTLD_LAZY);
    if (!lib_handle) {
        return false;
    }
    
    // Get prediction function
    predict_func = (PredictFunc)dlsym(lib_handle, "predict");
    if (!predict_func) {
        dlclose(lib_handle);
        lib_handle = nullptr;
        return false;
    }
    
    return true;
}

inline double predict(const double* features) {
    // Ensure library is loaded
    if (!load_treelite_library()) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Normalize features
    double normalized[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        normalized[i] = (features[i] - COL_MEANS[i]) / COL_STDS[i];
    }
    
    // Convert to TL2cgen Entry format
    Entry data[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        data[i].missing_value = -1.0f;  // No missing values
        data[i].fvalue = static_cast<float>(normalized[i]);
    }
    
    // Call Treelite prediction
    float result[1];
    size_t num_output = predict_func(data, 1, result);
    if (num_output == 0) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Denormalize target
    double pred_norm = static_cast<double>(result[0]);
    double pred = pred_norm * TARGET_SCALE + TARGET_MEAN;
    
    return pred;
}

} // namespace CascadeRI
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit

// Wrapper struct for template parameter (C++ doesn't allow namespaces as template parameters)
// Must be outside the namespace to reference it
namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadeRI {
struct Model {
    using Namespace = CascadeRI;
};
} // namespace CascadeRI
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit
