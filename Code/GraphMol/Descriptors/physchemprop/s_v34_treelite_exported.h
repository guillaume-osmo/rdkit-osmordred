#pragma once
// Auto-generated Treelite model for S (v3.4 XGBoost)
// Trees: 300, Features: 528
// Target normalization: mean=1.1825334092, scale=0.8415982952
// Library: s_v34_treelite.so

#include <vector>
#include <cmath>
#include <algorithm>
#include <dlfcn.h>  // For loading shared library
#include <limits>

namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadeS {

constexpr int N_TREES = 300;
constexpr int N_FEATURES = 528;
constexpr double TARGET_MEAN = 1.1825334092;
constexpr double TARGET_SCALE = 0.8415982952;

// Normalization stats
constexpr int N_NORM_FEATURES = 528;
static const double COL_MEANS[N_NORM_FEATURES] = {
    0.0306463326,    0.0188816267,    0.2740740741,    0.1148874365,    0.0746550472,    0.0248366013,    0.0052287582,    0.0615831518,    0.0460421206,    0.0216412491,
    0.0610021786,    0.0052287582,    0.0564996369,    0.0014524328,    0.0143790850,    0.0341321714,    1.4939724038,    2.6599854757,    0.0514161220,    0.0415395788,
    0.0075526507,    0.3545388526,    0.3285403050,    0.0363108206,    0.3449527959,    0.0081336238,    0.0018881627,    0.0037763253,    0.1064633261,    0.0662309368,
    0.0178649237,    0.0264342774,    0.0078431373,    2.9937545389,    0.0207697894,    0.0011619463,    0.1488743646,    0.0239651416,    2.0944081336,    0.0088598402,
    0.1787944808,    0.8522875817,    0.0225127088,    0.5143064633,    0.1079157589,    0.2720406681,    0.3944807553,    0.1459694989,    0.7270878722,    8.4044348116,
    0.5321634987,    0.5421794819,    210.2869289760,    209.9204652120,    77.0501089325,    0.1765638621,    -0.3269485480,    1.1404417148,    1.7085634697,    10.1876343806,
    2.0893024104,    2.1692533234,    -2.0524544912,    6.0789195442,    0.3389889376,    2.7439082044,    5.1864231921,    2.7533080432,    -0.9782875062,    5.0826822691,
    11.6131918161,    5.8430845783,    3.4166431295,    0.7648211876,    3.2690663101,    1.8581418817,    1.8577072849,    1.1749757350,    25.8974607685,    8.2001821439,
    2.1689728068,    2.3889812180,    24.1485744205,    19.8757457556,    0.0000000000,    34.7559520697,    5.9354846071,    7.1387351107,    9.4520051977,    6.7290053763,
    8.8863596967,    14.4780107518,    7.4434155867,    7.4754599728,    8.0455373849,    5.4354674424,    1.3021037500,    -0.3315024387,    2.6312243352,    2.3686274510,
    0.0723311547,    3.0880174292,    2.6424771285,    56.3504450835,    0.0126361656,    0.0043572985,    0.0078431373,    0.0033405955,    0.0072621641,    2.2514551401,
    14.3530864198,    0.7417574437,    216.8893411155,    81.4392156863,    157.8998372085,    178.3565953351,    112.7119691422,    1039.1190994916,    218.4379852834,    5.8459348238,
    3.6349723543,    0.8948758562,    3.4315281487,    3.0472382620,    2.1063546260,    1.6043596457,    1.0433649106,    3.5957148814,    3.4008194336,    26.7582944276,
    24.0148762012,    16.0597564000,    45.5419544961,    26.3346525606,    209.9244763000,    148.4930149871,    7.7746632020,    5.8484010151,    1.3509858317,    0.9199543246,
    160.4757572430,    110.9206432300,    0.4694083542,    -0.2361905442,    -0.0081069122,    -0.0081591788,    0.0187416980,    -0.0092357351,    0.0019854631,    91.5350959272,
    23.4745782106,    -14.9126663471,    -20.5839316846,    -16.1816434085,    -3.2271406429,    -2.0874966312,    -1.0660241847,    -4.6397136019,    8.3466744002,    -2.3039863158,
    -5.0616757293,    -5.5496302317,    -1.9041312805,    335.3455322639,    6.9667591278,    -36.1152269168,    -173.3802872069,    -29.8148300326,    -136.0016255423,    -36.6647755235,
    2.1540131906,    0.3415892492,    -0.1818801666,    -0.2646885098,    -0.0841848415,    -0.1442471859,    -0.0869447972,    0.5061976738,    -0.1112477798,    -0.2007351106,
    -0.1856341255,    -0.3171082240,    -2.7376830732,    -1.8970156018,    -7.3566071729,    -7.2727825704,    -2.4401612748,    -1.3042958488,    -0.0088810496,    0.0004036841,
    -0.0003093334,    0.0006021311,    3.3305913545,    0.7629366179,    -0.3029587117,    0.1032807021,    -0.0092691224,    0.0478582368,    -0.2050918949,    -0.1253997538,
    15.0926746758,    -0.3080018148,    -0.9636249139,    75.9745875212,    -1.7967171555,    -7.1638288845,    -0.7303061987,    0.0840901998,    -0.0056321333,    -0.0045427266,
    -0.0026865388,    -0.0056023521,    -0.0323270297,    -0.0255113124,    -0.0016359536,    0.0084655437,    0.0162257068,    1.5966874948,    -0.0648185767,    0.0987425948,
    -0.0095189444,    -0.0284953615,    -0.0155155653,    0.0053111296,    0.0277778037,    -0.0018914120,    -0.1185442111,    0.0849238152,    0.0095408243,    -0.0248713743,
    0.0091841939,    -0.1090210549,    0.0172404406,    -0.0871831890,    -0.0298190441,    -0.0366551834,    -0.0305793356,    -0.0258929842,    0.0194837724,    -0.0688773577,
    -0.0774613545,    0.0797184016,    1.4153206878,    0.8266038568,    0.5449615992,    0.7028893716,    1.0323442770,    1.4316230249,    0.6591313675,    0.9477664420,
    0.7093560839,    1.1095253149,    0.8588113090,    0.9106092685,    1.0493745052,    0.9115844451,    1.0906087097,    0.7123899749,    0.5431119445,    0.8574949438,
    0.8569780227,    1.0403712836,    1.1616796611,    1.0472553555,    1.0105039035,    1.1056740546,    0.6128419980,    1.1291126951,    1.0029926743,    3.5731814751,
    2.4756223913,    2.2070652672,    0.9025731394,    2.3698056864,    0.6966477269,    0.9815541031,    3.3276688453,    0.1984810835,    0.1333969289,    0.2429911775,
    0.0670922521,    0.6399102184,    0.0446229935,    1.1505871297,    0.9912013638,    0.3311067942,    0.6488939830,    0.1405522642,    0.0841950931,    27.4159670782,
    0.7056560307,    0.0000000000,    0.1507625272,    0.0367465505,    0.0207697894,    0.0000000000,    0.0435729847,    0.1557007988,    0.1265068991,    0.0582425563,
    0.0447349310,    0.0002904866,    0.4001452433,    0.6993464052,    0.4422657952,    0.0236746550,    0.3429193900,    0.0000000000,    0.0000000000,    0.0020334060,
    0.0207697894,    0.0000000000,    0.0000000000,    0.0013071895,    0.0148148148,    0.0000000000,    0.0078431373,    0.0088598402,    0.0419753086,    0.0214960058,
    0.0037763253,    0.0268700073,    0.3448075527,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,
    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0567901235,    0.0000000000,
    0.0000000000,    0.0000000000,    0.0000000000,    0.0165577342,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0175744372,    0.0421205519,
    0.0284676834,    0.0634713145,    0.0477850399,    0.1060275962,    0.0489469862,    0.0315177923,    0.0473493101,    0.0563543936,    0.1901234568,    0.1148874365,
    0.0810457516,    0.0001452433,    0.1642701525,    0.7604938272,    0.1169208424,    0.0810457516,    0.1500363108,    0.1340595497,    0.1164851126,    0.0537400145,
    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    -0.0001405834,    0.0000000000,    2.9669676739,    0.2187088404,    2.5804033485,    0.0339852283,
    0.5300569649,    4.9081734184,    -0.0740548696,    0.0084316282,    0.0870755660,    -0.0528168619,    0.9174808654,    0.2790255484,    -0.9144154473,    0.0000000000,
    0.5126573167,    0.0000000000,    0.0200928783,    0.4026127327,    0.1015734511,    7.8571190873,    8.4942935739,    1.3786421328,    1.5724199784,    0.6166996505,
    0.5442547423,    1.0267443142,    -0.0014600855,    0.3278425696,    2.4529324244,    0.2132934904,    5.3232791581,    1.2912612101,    0.3592567965,    0.2805369581,
    0.9331818688,    0.4210330007,    0.1779959839,    0.9512059878,    0.7582484122,    0.4892474068,    0.0284697701,    6.5125635439,    0.0262915390,    0.7836231684,
    0.2845883616,    0.5671649025,    2.7224054742,    0.1651816259,    -1.6957879448,    1.3866301370,    3.1617036318,    3.7682808070,    116.2793624180,    0.8113264382,
    0.6604433192,    25.1552256329,    29.7206371304,    30.5039280180,    11.7824838677,    7.1147681067,    0.0060920798,    0.0061970696,    0.0224942832,    1.4762798253,
    0.1027069561,    0.2006455291,    0.1950617284,    0.2247063300,    37.1700987654,    0.3541851448,    0.1867513293,    0.0856306161,    0.0409149015,    0.8197358907,
    4.7950510414,    0.9085783113,    0.0195324749,    5.0995311054,    0.5947558134,    0.1045543237,    0.1547114098,    0.0423967580,    0.0121394972,    0.2256954145,
    1.1479754006,    0.6101098252,    0.2395061728,    0.0150444480,    1.8844250316,    0.1736323608,    0.0592422521,    0.0709670056,    0.0410933529,    0.0040259218,
    0.0419229803,    0.0050389449,    0.2946204302,    0.1176991634,    0.0106832042,    0.0565869713,    0.0499455796,    0.3740565358,    0.0106113388,    10.8681406775,
    0.1055918664,    2.7478576616,    0.1239904894,    0.2133307322,    0.0287403725,    0.0333962950,    0.1958064855,    0.0196438040,    2.1717477304,    0.8083013542,
    0.1218026706,    0.3783393278,    0.2193450980,    0.6982901961,    0.6916111837,    1.1825901235,    0.9858782861,    6.9980984749,    5.9247546048,    4.1159747175,
    8.8911975033,    1.1203740208,    3.8165346180,    1.6031275030,    148.8871558164,    7.0617309307,    1.0006942578,    0.7131884184,    1.1383286119,    1.5202058014,
    56.3504450835,    185.2215078693,    0.3025578410,    184.3615691949,    56.6275249000,    37.2217889541,    1.3550699712,    1.7544169749,    1.3589655452,    2.6020371631,
    0.5610512156,    0.5855884470,    -2.9552950999,    10.5698673394,    1.2541919152,    2.5423691096,    6.9527352694,    2.1501163459
};

static const double COL_STDS[N_NORM_FEATURES] = {
    0.3120745176,    0.1550624250,    0.8260309438,    0.4147120231,    0.4212281566,    0.1574824361,    0.0867485491,    0.3949368635,    0.2608306512,    0.1579532550,
    0.3823215947,    0.0721208587,    0.2637701188,    0.0481848831,    0.1413579081,    0.2005725066,    1.5650967824,    3.8427520170,    0.2498507013,    0.2534066172,
    0.0930459801,    0.7369854259,    1.0128328249,    0.2564837633,    1.1151389159,    0.1005031041,    0.0434119513,    0.0613356724,    0.3831911988,    0.4424462750,
    0.1399256024,    0.1604228986,    0.0914472284,    3.0190085626,    0.1867156488,    0.0340675233,    0.8484599895,    0.1529405558,    2.0017651874,    0.1067507496,
    0.6082110623,    1.7706875143,    0.1760993193,    0.7983134740,    0.5190375137,    1.0061154927,    1.0895016462,    0.4382411293,    2.4790245145,    3.6483271099,
    0.6607414269,    0.1476581263,    110.4858153586,    110.2575283676,    40.6877435870,    0.1428866248,    0.1512087737,    0.3543788590,    0.4498303527,    0.9864209490,
    0.2667992215,    0.2434311790,    0.2854872287,    1.4494683885,    0.6066995229,    0.6956851149,    3.0424207731,    2.4767326802,    0.9549650277,    3.6033996517,
    290.4731679882,    8.0358220132,    6.8143494241,    2.4566645322,    5.0556359549,    3.7980673382,    7.9425521250,    4.5052717370,    25.4444955225,    9.6916465058,
    4.6933371484,    4.3559584756,    27.3439245514,    18.6912748711,    1.0000000000,    37.3792106474,    8.7132194965,    9.4499801277,    11.7371908554,    10.1818384312,
    13.2201683313,    17.4447222093,    13.3648676763,    23.7479009917,    10.5231349406,    10.0176156267,    2.5805670403,    4.7802695268,    5.9786679992,    2.4988137644,
    0.5302715881,    3.7216644092,    1.9985464603,    28.4124252900,    0.1216568346,    0.0798230442,    0.0975937592,    0.0807761607,    0.0882632326,    0.2360190593,
    9.8632085363,    1.2512213197,    290.4128837365,    50.0244149712,    129.5387873749,    245.3796119462,    222.0432535120,    1067.0710282260,    118.7016566024,    3.6353256170,
    4.4275264552,    2.7775132045,    0.9349771489,    0.8395650011,    0.6688909052,    0.7807020693,    0.8866005382,    3.4625305931,    4.3302036897,    19.2948363790,
    29.0289321381,    32.6340816553,    87.6822452057,    71.9398700980,    57.3838573487,    58.0398833613,    0.8277756410,    1.6485208864,    0.4478777308,    0.5098005049,
    37.1939399699,    82.6167640719,    0.4614145309,    0.2719228805,    0.2362491501,    0.2326177219,    0.1868245206,    0.1556246374,    0.1285673550,    61.5799986439,
    24.7952255029,    40.1623251617,    39.0944740810,    42.0652297453,    34.2519192275,    4.1322116176,    5.4218959038,    7.7513497943,    22.0341102519,    23.8313316780,
    23.4461995167,    22.2130363145,    17.5314701926,    412.9328836528,    39.7380623645,    134.8778467339,    668.8337304276,    444.5677315013,    535.3656227280,    565.4459397578,
    2.0655817038,    1.0792827724,    1.1744818528,    1.0697564449,    1.0420063035,    0.8958668259,    0.7605648618,    1.5267345870,    1.2359143450,    1.5151459052,
    2.7931923272,    2.8014968009,    7.7910755245,    16.0308810505,    16.1787195188,    17.2428286819,    15.3371079867,    14.0315387575,    0.0097839276,    0.0054044295,
    0.0051459028,    0.0092105705,    1.4266900341,    0.6583362456,    1.2153290893,    1.5727471185,    0.1267576768,    0.1365192459,    0.4124501901,    1.3039584846,
    29.1604465277,    6.7326551482,    14.6714756859,    166.5935822709,    37.7076250533,    66.8442322023,    4.3189597033,    0.0740018027,    0.0266576507,    0.0494335597,
    0.0405255631,    0.0770718446,    0.0785074208,    0.1066761858,    0.1608836066,    0.1428933232,    0.1107476897,    1.1114335633,    0.3914750657,    0.4338476040,
    0.2020787695,    0.1674257657,    0.1643366939,    0.3231509890,    0.2707178415,    0.1819457166,    0.1910171602,    0.2323409468,    0.1511131478,    0.3837212504,
    0.1513290984,    0.1682150695,    0.3543250288,    0.2015262538,    0.1366226690,    0.1439868989,    0.1689934953,    0.2560798854,    0.3484383720,    0.1983668820,
    0.1679230041,    0.2725773157,    0.3036228274,    0.5819239860,    0.6715123109,    0.3084855542,    0.3463412857,    0.3765538855,    0.4887678686,    0.4102367307,
    0.2851657086,    0.6516631484,    0.9983332835,    0.2478226865,    0.2604153599,    0.2458125091,    0.2987827551,    0.5785199151,    0.5766851580,    0.3175670658,
    0.3082790563,    0.3264554133,    0.3723371060,    0.2691353679,    0.3121898646,    0.2220611604,    0.5031834712,    0.6555608830,    0.1388412314,    0.2828652461,
    0.0769834879,    0.6183619975,    0.2873256712,    0.7169482804,    0.7723386169,    1.1404401914,    2.6587786136,    0.1069504098,    0.2063829294,    0.4107143443,
    0.1568619100,    0.9331314451,    0.1852935648,    1.7988839122,    1.4092934227,    0.0590981805,    0.1125098208,    0.1098339466,    0.0926313572,    15.0006784572,
    0.3052388273,    1.0000000000,    0.4543837147,    0.2079408059,    0.1625995791,    1.0000000000,    0.2407106715,    0.5190753110,    0.4190129999,    0.2896532710,
    0.2423024516,    0.0170411908,    0.9493031389,    0.9124051912,    0.9115016422,    0.1567373554,    1.8304043674,    1.0000000000,    1.0000000000,    0.0963920917,
    0.3105573784,    1.0000000000,    1.0000000000,    0.0361314378,    0.1397626834,    1.0000000000,    0.0975937592,    0.0997160455,    0.2460638975,    0.1460288126,
    0.0613356724,    0.1704490411,    1.1149884551,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,
    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    0.3494564847,    1.0000000000,
    1.0000000000,    1.0000000000,    1.0000000000,    0.1476577813,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    0.1716566692,    0.2195211796,
    0.1929853130,    0.2979628328,    0.2277988901,    0.3954350729,    0.2332258905,    0.1828367762,    0.2430035145,    0.2816422674,    0.7616562997,    0.4147120231,
    0.3045947987,    0.0120508169,    0.4317148353,    1.0209180599,    0.3943829874,    0.3045947987,    0.4160911042,    0.4504920308,    0.5793065421,    0.3408980823,
    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    0.0082629880,    1.0000000000,    3.2464445478,    0.9891977314,    4.9001037817,    0.4364787691,
    1.4691806018,    5.9520926107,    1.7415856716,    0.1416395439,    0.5825520472,    0.8648878058,    1.5752153052,    1.0779624023,    6.3853458775,    1.0000000000,
    1.8893106924,    1.0000000000,    0.4109081248,    1.2081896096,    0.6034858906,    10.6491622183,    11.6587613432,    4.7241771283,    5.4887173387,    3.9180090815,
    0.6374734677,    0.9439690359,    0.4985278295,    0.8969785520,    4.1303952454,    0.7120672242,    5.6131928159,    0.9194650523,    0.5709000557,    0.6666790966,
    0.8694046968,    1.2386877359,    0.5806789010,    3.2804425874,    1.9280614310,    0.0576616284,    0.0709510963,    5.4938688115,    0.0442903591,    0.3057414033,
    0.0999337975,    0.3175405907,    1.9642500681,    0.1624678001,    4.9766295193,    0.2958423261,    0.6877423998,    0.8348633229,    88.7245454318,    0.1341278957,
    0.1234558221,    9.4629559531,    10.2765506739,    15.9631132002,    6.1795470786,    7.2499352124,    0.0618430449,    0.0538009505,    0.1979909442,    2.5198602129,
    0.1670666408,    0.1975217711,    0.4861229091,    0.2206223343,    39.0349000062,    0.5250551720,    0.3493015307,    0.0372269936,    0.0257993127,    0.2096402908,
    0.7230003609,    2.1997299884,    0.0954800959,    4.1118283067,    0.9935651600,    0.3485041891,    0.4174116158,    0.2297643088,    0.0521291062,    0.1605168224,
    0.7419200200,    0.4104578863,    0.5864673757,    0.1791609311,    4.4766737688,    0.5607924895,    0.5644923740,    0.3650218890,    0.4121425636,    0.0898115069,
    0.2815322121,    0.1114661850,    2.2987880085,    0.9284694108,    0.2410363706,    0.3995551131,    0.6657477516,    0.9185322560,    0.2143584683,    12.4794888035,
    0.4254494335,    3.2914643003,    0.4353613641,    0.7713580721,    0.2045482211,    0.2029731322,    0.3950625637,    0.2794470366,    2.3077379386,    0.7955415673,
    0.6212869954,    1.1797431208,    0.3635858825,    0.7343372687,    0.7383760522,    0.8475695410,    0.8287653056,    3.9452421266,    26.2904732236,    0.9244622723,
    1.1729280899,    0.8389502133,    0.5453367295,    0.7933098582,    73.2608032224,    4.0582456056,    0.8623025868,    0.6814159953,    0.2913935094,    0.0918142751,
    28.4124252900,    88.6157024980,    0.0455471082,    87.5092106406,    28.9237871379,    18.3152008056,    0.2697146103,    0.3584866247,    0.2776825455,    0.5184107739,
    0.5203940627,    1.5291789358,    1.3550270153,    13.5675595947,    2.6198261565,    5.3471254800,    57.2817905443,    2.8283144806
};

// Selected feature indices
constexpr int N_SELECTED_FEATURES = 503;
static const int SELECTED_FEATURES[N_SELECTED_FEATURES] = {
    0,    12,    15,    16,    17,    18,    25,    26,    27,    34,    41,    46,    49,    57,    62,    63,    66,    67,    69,    72,
    77,    83,    89,    96,    97,    102,    104,    105,    106,    107,    108,    109,    110,    111,    112,    113,    114,    116,    122,    149,
    150,    155,    171,    179,    180,    217,    226,    227,    233,    291,    293,    295,    297,    299,    300,    302,    303,    306,    307,    310,
    311,    313,    314,    315,    316,    318,    325,    329,    332,    335,    336,    338,    339,    342,    344,    345,    346,    347,    348,    350,
    355,    362,    369,    370,    373,    374,    378,    379,    380,    382,    383,    384,    385,    386,    388,    389,    390,    391,    393,    399,
    408,    413,    421,    422,    437,    441,    445,    468,    500,    513,    531,    534,    546,    552,    563,    566,    568,    574,    597,    643,
    645,    650,    652,    653,    655,    657,    659,    662,    664,    670,    671,    674,    684,    686,    689,    691,    698,    710,    726,    729,
    737,    740,    741,    742,    744,    745,    747,    748,    749,    750,    751,    753,    754,    755,    758,    761,    765,    769,    770,    771,
    772,    773,    776,    777,    778,    782,    791,    797,    800,    801,    804,    806,    807,    809,    810,    811,    812,    815,    821,    832,
    833,    838,    841,    842,    843,    844,    845,    847,    850,    851,    853,    855,    858,    859,    863,    866,    872,    875,    877,    883,
    885,    887,    890,    894,    896,    898,    904,    912,    915,    919,    920,    936,    942,    943,    945,    946,    947,    948,    950,    956,
    958,    959,    960,    963,    964,    966,    967,    980,    990,    994,    998,    1007,    1010,    1016,    1021,    1037,    1038,    1041,    1042,    1045,
    1048,    1052,    1053,    1058,    1060,    1061,    1062,    1070,    1074,    1077,    1078,    1081,    1083,    1086,    1087,    1094,    1101,    1107,    1108,    1109,
    1117,    1119,    1133,    1134,    1136,    1142,    1147,    1152,    1154,    1163,    1164,    1169,    1170,    1173,    1219,    1282,    1287,    1289,    1304,    1305,
    1309,    1315,    1316,    1322,    1332,    1335,    1349,    1352,    1353,    1361,    1365,    1420,    1422,    1423,    1424,    1425,    1426,    1427,    1428,    1429,
    1430,    1431,    1432,    1433,    1434,    1435,    1436,    1437,    1438,    1439,    1440,    1441,    1442,    1443,    1444,    1445,    1446,    1447,    1448,    1449,
    1450,    1451,    1452,    1453,    1454,    1455,    1456,    1457,    1458,    1459,    1460,    1461,    1462,    1463,    1464,    1465,    1466,    1467,    1468,    1469,
    1470,    1471,    1472,    1473,    1474,    1475,    1476,    1477,    1478,    1479,    1480,    1481,    1482,    1483,    1484,    1485,    1486,    1487,    1488,    1489,
    1490,    1491,    1492,    1493,    1494,    1495,    1496,    1497,    1498,    1499,    1500,    1501,    1502,    1503,    1504,    1505,    1506,    1507,    1508,    1509,
    1510,    1511,    1512,    1513,    1514,    1515,    1516,    1517,    1518,    1519,    1520,    1521,    1522,    1523,    1524,    1534,    1594,    1595,    1598,    1600,
    1609,    1612,    1616,    1624,    1634,    1685,    1695,    1708,    1710,    1712,    1713,    1730,    1731,    1739,    1755,    1805,    1808,    1813,    1816,    1818,
    1820,    1826,    1827,    1840,    1844,    1854,    1856,    1858,    1865,    1870,    1874,    1885,    1886,    1892,    1896,    1961,    1969,    1971,    1974,    1981,
    1982,    1984,    2026,    2149,    2153,    2158,    2159,    2165,    2167,    2177,    2183,    2237,    2250,    2254,    2257,    2260,    2261,    2262,    2270,    2271,
    2274,    2275,    2297,    2326,    2342,    2346,    2365,    2378,    2411,    2413,    2414,    2422,    2427,    2453,    2477,    2480,    2495,    2499,    2592,    2669,
    2779,    3034,    3073,    3089,    3104,    3144,    3229,    3329,    3399,    3501,    3522,    3615,    3765,    3766,    3767,    3768,    3769,    3770,    3782,    3815,
    3829,    3835,    3848
};

// Feature order metadata
constexpr int N_CASCADE_FEATURES = 7;
constexpr int N_PHYSICS_FEATURES = 10;
// Cascade feature names (in order)
static const char* CASCADE_FEATURE_NAMES[N_CASCADE_FEATURES] = {
    "V",
    "Polarizability",
    "L",
    "E",
    "B",
    "Density",
    "RI",
};

// Physics feature names (in order)
static const char* PHYSICS_FEATURE_NAMES[N_PHYSICS_FEATURES] = {
    "phys_MR",
    "phys_Vm",
    "phys_fn",
    "phys_Parachor",
    "phys_epsCM",
    "phys_alpha",
    "phys_dD",
    "phys_dH",
    "phys_dP",
    "phys_delta",
};

// Prediction function using Treelite compiled library
// TL2cgen generates: size_t predict(union Entry* data, size_t num_row, float* result)
// Library path: /Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/s_v34_treelite.dylib
extern "C" {
    // Forward declaration of TL2cgen prediction function
    typedef struct {
        float missing_value;
        float fvalue;
    } Entry;
    
    // Function pointer type for prediction
    typedef size_t (*PredictFunc)(Entry* data, size_t num_row, float* result);
}

// Load library and get prediction function (called once at initialization)
static void* lib_handle = nullptr;
static PredictFunc predict_func = nullptr;

static bool load_treelite_library() {
    if (lib_handle != nullptr) return true;  // Already loaded
    
    const char* lib_path = "/Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/s_v34_treelite.dylib";
    lib_handle = dlopen(lib_path, RTLD_LAZY);
    if (!lib_handle) {
        return false;
    }
    
    // Get prediction function
    predict_func = (PredictFunc)dlsym(lib_handle, "predict");
    if (!predict_func) {
        dlclose(lib_handle);
        lib_handle = nullptr;
        return false;
    }
    
    return true;
}

inline double predict(const double* features) {
    // Ensure library is loaded
    if (!load_treelite_library()) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Normalize features
    double normalized[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        normalized[i] = (features[i] - COL_MEANS[i]) / COL_STDS[i];
    }
    
    // Convert to TL2cgen Entry format
    Entry data[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        data[i].missing_value = -1.0f;  // No missing values
        data[i].fvalue = static_cast<float>(normalized[i]);
    }
    
    // Call Treelite prediction
    float result[1];
    size_t num_output = predict_func(data, 1, result);
    if (num_output == 0) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Denormalize target
    double pred_norm = static_cast<double>(result[0]);
    double pred = pred_norm * TARGET_SCALE + TARGET_MEAN;
    
    return pred;
}

} // namespace CascadeS
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit

// Wrapper struct for template parameter (C++ doesn't allow namespaces as template parameters)
// Must be outside the namespace to reference it
namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadeS {
struct Model {
    using Namespace = CascadeS;
};
} // namespace CascadeS
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit
