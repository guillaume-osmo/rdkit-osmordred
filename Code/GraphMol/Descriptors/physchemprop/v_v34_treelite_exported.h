#pragma once
// Auto-generated Treelite model for V (v3.4 XGBoost)
// Trees: 300, Features: 502
// Target normalization: mean=1.6421884204, scale=0.8729014801
// Library: v_v34_treelite.so

#include <vector>
#include <cmath>
#include <algorithm>
#include <dlfcn.h>  // For loading shared library
#include <limits>

namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadeV {

constexpr int N_TREES = 300;
constexpr int N_FEATURES = 502;
constexpr double TARGET_MEAN = 1.6421884204;
constexpr double TARGET_SCALE = 0.8729014801;

// Normalization stats
constexpr int N_NORM_FEATURES = 502;
static const double COL_MEANS[N_NORM_FEATURES] = {
    0.0313146998,    0.0065993789,    0.0027173913,    0.0170807453,    0.0087991718,    0.2602225673,    0.1083074534,    0.0646997930,    0.0075051760,    0.0637939959,
    0.0411490683,    0.0011645963,    0.0014233954,    0.0007763975,    0.0007763975,    0.0271739130,    1.5526656315,    3.0009057971,    0.6528209110,    0.3584368530,
    0.0243271222,    0.6596790890,    0.0443840580,    0.0165631470,    2.9353002070,    2.0245859213,    0.0172101449,    0.3382505176,    3.7463768116,    0.2497412008,
    8.2284478524,    8.2283658074,    0.5443900718,    -0.2635356050,    0.5329750342,    14.7635186147,    212.7935663952,    212.4236958533,    78.2695393375,    0.1699943223,
    -0.3192238638,    1.1247468858,    1.6817632291,    2.1144701766,    24.1770258922,    10.2036239300,    2.0874721245,    -2.0455229509,    6.0715515112,    0.3578056307,
    2.1310475598,    2.7550416773,    10.5870745662,    9.0717193369,    3.6463149445,    -0.9341528865,    88.0609564472,    5.5530440356,    0.7162217165,    22.2928335982,
    7.9529286755,    8.4495345727,    24.8403626226,    4.8826530903,    9.3284585915,    8.6379422192,    14.8144407255,    4.6214966017,    14.2119565217,    0.7246376812,
    2.2521997930,    3.4252070393,    2.8299132182,    57.5737778986,    0.0414078675,    0.1017080745,    1.0820393375,    2.2480890993,    1.2045167984,    3.2544449374,
    1.3848959617,    29.3149585921,    15.1030020704,    11.0495600414,    136.9015944372,    157.2544545837,    506.4217132505,    380.2651397516,    3481.0106322204,    2725.7801189215,
    4257.0486866522,    1723.9578087070,    6060.7754954533,    7478.9845440044,    10598.7810628352,    224.1174541836,    482.5926860582,    268.2721435405,    180.0610655280,    414.7115905668,
    318.7364167443,    209.4501448499,    183.3632968038,    36.6530265792,    4813.5851668480,    10865.8956798572,    6069.0681579817,    6.7135902642,    5.7181826850,    4.7793976430,
    2.2558803541,    1.1974562841,    3.4135680658,    1.8253967082,    3.5079380092,    3.3698280605,    2.8575109273,    27.1406234864,    105.1400487337,    209.2266543776,
    7.8081237037,    5.8992409874,    4.8062512296,    6.3217982214,    6.2203706654,    6.2862050953,    5.9678442306,    1.5877529063,    1.0406888492,    0.9147526174,
    0.7630819751,    0.5940550329,    161.9650293039,    151.3876764688,    133.4781948423,    110.8741895488,    0.0150983493,    -0.0068582352,    -0.0078368304,    0.0024535331,
    8.3250031373,    -14.9984831060,    -2.1904155885,    -4.1428178698,    -1.8513926061,    0.1803877996,    -2.3742294680,    -4.9492057094,    -5.6931316794,    -1.8768931709,
    -3.1486949228,    7.6897891144,    2.2230820137,    -76.9900766090,    -92.3352772664,    -261.4697725844,    -269.2092431068,    30.5948391308,    -0.1131504100,    0.3226102658,
    -0.2903388400,    -0.2751288588,    -0.1300339401,    -0.0747342378,    -0.2860965345,    -0.4412981148,    -0.4576690739,    3.2434135760,    0.5307514318,    -0.6432853823,
    0.1630630013,    44.0113613287,    -2.7214824828,    -2.5951683314,    -0.4487789166,    -0.0589941951,    0.0238858223,    -0.1969883240,    0.1770884244,    -0.2253545839,
    -1.6455236696,    -1.1724823673,    2.7880568191,    0.1210666739,    -0.0112470092,    0.0108621925,    -0.0256425201,    1.5901610000,    0.1072053183,    0.0293536657,
    -0.1200221705,    -0.0768818129,    -0.1059757679,    0.0877008495,    -0.1262425643,    0.0632594645,    -0.0621100831,    -0.0729112628,    -0.0169644128,    -0.0711849616,
    0.0058481157,    0.0492202732,    -0.0211241084,    -0.1088769062,    0.0206634843,    -0.0174736423,    -0.0352770258,    0.0535855276,    -0.0382165835,    -0.0307820814,
    0.0525604210,    -0.1072613825,    -0.0752592033,    -0.0042723508,    0.0709406204,    0.0844073944,    1.0001677481,    0.9461531887,    0.7183206935,    0.7187539134,
    1.0447765070,    1.1145034561,    1.0818225287,    0.8685766902,    0.4903968328,    0.9817653647,    0.8427138186,    0.6317459848,    0.9184853416,    0.9192256164,
    1.0541802917,    0.8038996318,    0.7057260254,    0.8665020395,    1.0555147320,    1.0790806086,    1.1682744617,    1.0964365347,    0.6801628170,    1.1055017553,
    0.8535359912,    1.1184079064,    2.3861670499,    0.9832577661,    57.5051551943,    99.9309307134,    50.2974361680,    75.1497514512,    5.5967800166,    7.1995390417,
    5.6631218219,    0.3209989053,    0.1317400156,    2.2132187177,    0.0874090837,    5.3452490064,    0.3867626676,    0.2398892348,    17.6772760273,    19.3269082013,
    0.6207457315,    59.4828225778,    88.5437309715,    118.9930966193,    6.7567991435,    59.4834867287,    3.5984788019,    0.2873785354,    1.4748001297,    65.9684219925,
    4.0012470267,    4.0905251054,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0002587992,    0.0000000000,    1.5525362319,    0.0560300207,
    2.9966356108,    0.0076345756,    0.2741977226,    2.6614906832,    0.6526915114,    0.0045289855,    0.0395962733,    0.6159420290,    1.5302795031,    0.2915372671,
    0.3145703934,    0.0000000000,    0.0859213251,    0.0000000000,    0.0029761905,    0.1326345756,    0.0353260870,    0.0213509317,    0.0000000000,    0.0402432712,
    0.1482919255,    0.1206004141,    0.0542184265,    0.0438664596,    0.0005175983,    0.3814699793,    0.6596790890,    0.4391821946,    0.0243271222,    0.3275103520,
    0.0000000000,    0.0000000000,    0.0018115942,    0.0190217391,    0.0000000000,    0.0000000000,    0.0014233954,    0.0216097308,    0.0000000000,    0.0075051760,
    0.0115165631,    0.0441252588,    0.0200569358,    0.0054347826,    0.0262681159,    0.3506728778,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,
    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0003881988,    0.0000000000,    0.0000000000,
    0.0000000000,    0.0547360248,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0164337474,    0.0000000000,    0.0000000000,    0.0000000000,
    0.0000000000,    0.0175983437,    0.0364906832,    0.0234213251,    0.0560300207,    0.0415372671,    0.0910973085,    0.0445134576,    0.0001293996,    0.1231884058,
    0.0000000000,    0.0000000000,    0.0000000000,    -0.0001252480,    0.0000000000,    3.1096324727,    0.2040993366,    3.1533305273,    0.4877282619,    2.2626502524,
    4.0101201267,    0.0000000000,    0.0000000000,    -0.0027606743,    -0.0383962571,    0.0000000000,    0.0000000000,    -0.0012128988,    -0.0668676395,    0.0000000000,
    0.0299909046,    0.0581866597,    0.0723398639,    0.0328040495,    -0.0059138361,    -0.0981690509,    2.0215132797,    0.0000000000,    0.0000000000,    0.0000000000,
    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0003768403,    0.0000000000,
    0.0000000000,    0.0000000000,    0.1719012954,    0.0000000000,    0.0000000000,    0.0000000000,    0.0000000000,    0.0326042426,    0.0000000000,    0.0000000000,
    0.0000000000,    0.0000000000,    0.0973178993,    0.2000263064,    0.1175794960,    0.1649334386,    0.1153303505,    0.2288495630,    0.1005553849,    0.0505920961,
    0.0723467110,    -0.0331017255,    1.7788189240,    1.0259740844,    0.6381274408,    0.7500633689,    8.0017605015,    0.0061417476,    0.4083233870,    0.9667854966,
    0.7974298047,    1.0208149653,    1.1225099443,    -0.0115254119,    0.4037397799,    0.0656989481,    0.0286101242,    0.7980648352,    0.2889536502,    0.0230267390,
    0.5949533130,    0.8223654615,    42.5360248447,    -3.1220063573,    1.3760858713,    3.1195466732,    0.7724025184,    0.2955858947,    0.4751176560,    0.6520110160,
    2.4141192235,    1.0830137109,    24.8452700983,    29.3520939321,    31.4949457845,    52.0841775787,    11.9903246880,    164.0915062112,    2.1106061471,    1.5505872221,
    7.0819618002,    1.5163729306,    0.1963564994,    27.6041666667,    3.1898903517,    0.0652173913,    0.2321366348,    0.0070515819,    0.4506316863,    199.5972336381,
    8.8545548654,    5.0364637686,    0.4672187292,    0.4558693584,    2.4050067385,    0.1621719280,    0.0676348065,    10.2327962875,    0.1622670807,    0.5284224424,
    0.1985260748,    0.4205178771,    0.0256885386,    0.9303764582,    0.5345649992,    0.4764133620,    0.1984221176,    0.1131261133,    0.7925618270,    0.0556315258,
    7.0836458333,    6.1119438057,    5.7123001255,    0.8602494637,    631.7190981367,    8.9016905051,    1.1207098238,    0.5496201336,    1.3717422682,    6.0396711286,
    7875.9172992996,    7.4690734990
};

static const double COL_STDS[N_NORM_FEATURES] = {
    0.3177833590,    0.0942603821,    0.0672428531,    0.1437740625,    0.1134131084,    0.8109062181,    0.4003018177,    0.3900367118,    0.0948769906,    0.4046746706,
    0.2571228057,    0.0409980284,    0.0377010529,    0.0278530918,    0.0278530918,    0.2241539991,    1.5758334861,    4.8814225313,    1.5591975869,    0.7409853266,
    0.1582065395,    0.8883706330,    0.3256972669,    0.1517154825,    3.0777042113,    1.9971294318,    0.1503580314,    1.4673734804,    7.1827924637,    0.9663060307,
    3.6993133021,    3.6992729560,    0.6527564403,    1.5581880192,    0.1555812313,    10.1541008332,    112.5838137585,    112.3652719621,    42.5972726031,    0.1440194972,
    0.1537849394,    0.3724583922,    0.4731684691,    0.5662977019,    18.3260270791,    1.6197777682,    0.2626147571,    0.2827304192,    1.4619645731,    0.6194539640,
    0.4636245132,    0.6861781263,    5.5063021929,    4.8118193455,    2.5923541943,    0.9540046461,    45.7346938992,    7.9205619502,    2.4025574975,    18.7941855273,
    9.4390302224,    11.5030256580,    22.7170493071,    6.5710632851,    11.5585271014,    13.1413570692,    17.9593986195,    6.0499718907,    7.7176394377,    1.3099016223,
    2.4448752388,    4.8473431079,    2.3782919826,    30.5518915027,    0.2355419400,    0.3834127855,    3.7107850735,    0.2359476722,    0.0985838698,    0.6599501406,
    0.6996642254,    18.0919028892,    11.8404901211,    6.6800785624,    253.3670545869,    125.8144129262,    862.9522352845,    789.0920073950,    3572.6475274604,    1582.1205870360,
    3938.7279720641,    3117.2566593712,    3317.9201911758,    4457.6867829371,    6972.0429398974,    131.3034636981,    523.4911854346,    487.0944108712,    103.9751430918,    323.2846090648,
    404.2833127601,    382.4694963856,    111.5769916594,    71.3825117270,    2988.6908970848,    8921.3558643877,    10873.7770319285,    5.1534633357,    3.6316966831,    4.3368587309,
    4.1349088067,    3.2198313372,    0.9340319597,    0.7197253103,    3.3128765323,    4.4556660729,    4.4754447080,    36.9876292252,    204.6417238144,    59.0748615497,
    0.9421555736,    3.2050542053,    3.6262328150,    1.0627486775,    1.1065490701,    0.5547989733,    1.3593456084,    0.7153630691,    0.4658801227,    0.5132505485,
    0.5572552507,    0.5559919124,    26.3341120745,    53.4666259378,    70.9993525755,    82.6209782607,    0.2146921161,    0.2202150261,    0.2181768656,    0.1217389052,
    33.0630789252,    38.1903470484,    4.2925821844,    6.6973360050,    5.6590912511,    4.2198092443,    22.7769827716,    22.7469739373,    21.3579659075,    22.5863620150,
    18.3616040275,    44.2422896231,    112.0397262183,    697.4091096518,    603.8138066651,    437.8845806252,    601.0734858778,    561.3681638157,    0.4748844737,    1.0619726598,
    1.1123953217,    1.0358326596,    0.8486466973,    0.7668377987,    1.6733935969,    1.6762150699,    1.6161566546,    3.1741534860,    1.6886458086,    3.3217388249,
    3.8625311906,    32.7035299034,    7.5457740854,    16.9769379520,    0.9688684687,    0.1033102783,    0.1559322765,    0.3923563997,    0.6667642436,    28.2594526319,
    58.5162948372,    8.1043913278,    20.6168701589,    0.0971088678,    0.0580658692,    0.0419513772,    0.1032879066,    1.1113333695,    0.4375607798,    0.2907409339,
    0.1918545000,    0.2837246666,    0.1737200369,    0.2338143255,    0.1567473722,    0.1898997973,    0.1781909723,    0.2692687483,    0.3874243276,    0.2979216994,
    0.4646937173,    0.4145458648,    0.0985520992,    0.1695964425,    0.3518935497,    0.4468694940,    0.1497156373,    0.1976642260,    0.1451292028,    0.1705932166,
    0.3875547174,    0.1750743121,    0.1702777087,    0.2142250295,    0.3122479832,    0.2766141693,    0.3541092167,    0.4599886515,    0.7060188284,    0.3242399212,
    0.3504096464,    0.3294407633,    0.3728324818,    0.6309339064,    0.4907333819,    0.3455763022,    0.9792482800,    0.9421770512,    0.2564894863,    0.2545096570,
    0.2651109312,    0.8019025822,    0.5701988682,    0.3257300676,    0.3547098833,    0.6103629279,    0.3765080953,    0.2941660046,    0.6533250519,    0.2281878867,
    0.3584748912,    0.6491241856,    0.7132220465,    1.0787679023,    76.2508139539,    138.3783811413,    69.2796323625,    106.0512278283,    3.3656151833,    4.0449749570,
    3.3851437499,    0.1686316880,    0.2079295332,    2.6356356095,    0.0427817650,    3.2681724449,    0.1475088883,    0.1443318417,    9.9255172350,    11.1410858862,
    0.0955809730,    74.2804018573,    113.1982640488,    148.5940530340,    3.4303877345,    74.2798903036,    0.9167286046,    0.0740838578,    0.7494824468,    61.4386327691,
    1.2387896888,    1.3181103666,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    0.0160851545,    1.0000000000,    1.5758378054,    0.2585842469,
    4.8812491471,    0.0955462394,    0.7359778767,    3.1371855510,    1.5592102642,    0.0708947963,    0.2402023012,    1.0120978831,    1.9126538219,    0.9789560170,
    0.9928757205,    1.0000000000,    0.3414415458,    1.0000000000,    0.0611860301,    0.4230437807,    0.2064425518,    0.1606619235,    1.0000000000,    0.2265058714,
    0.5036175363,    0.3998577021,    0.2744942836,    0.2455950621,    0.0227448991,    0.9263389462,    0.8883706330,    0.9044272028,    0.1582065395,    1.7840183411,
    1.0000000000,    1.0000000000,    0.0909851176,    0.2768229164,    1.0000000000,    1.0000000000,    0.0377010529,    0.1622304960,    1.0000000000,    0.0948769906,
    0.1114411441,    0.2336676712,    0.1411150393,    0.0735203764,    0.1678275715,    1.1205586648,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,
    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    0.0196989355,    1.0000000000,    1.0000000000,
    1.0000000000,    0.3358818200,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    0.1504448692,    1.0000000000,    1.0000000000,    1.0000000000,
    1.0000000000,    0.1846905199,    0.2040320871,    0.1765059208,    0.2731845309,    0.2133201920,    0.3643443825,    0.2259919962,    0.0113746579,    0.4199238072,
    1.0000000000,    1.0000000000,    1.0000000000,    0.0077994215,    1.0000000000,    3.3323500854,    0.9505425860,    6.7299556466,    1.4039212197,    4.9231890595,
    22.3954278065,    1.0000000000,    1.0000000000,    0.1432668991,    0.5989019545,    1.0000000000,    1.0000000000,    0.0399918552,    0.5276851222,    1.0000000000,
    0.3791550855,    0.5669410256,    0.3976262604,    0.2347662923,    0.0855163168,    0.6416949305,    6.6259718000,    1.0000000000,    1.0000000000,    1.0000000000,
    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    0.0191233511,    1.0000000000,
    1.0000000000,    1.0000000000,    1.0883518734,    1.0000000000,    1.0000000000,    1.0000000000,    1.0000000000,    0.3190862641,    1.0000000000,    1.0000000000,
    1.0000000000,    1.0000000000,    1.0500679652,    1.1201567266,    0.8947513637,    0.7920350969,    0.6040192096,    0.9046492818,    0.5340941050,    0.3226100739,
    0.3592585349,    0.2147951630,    7.5655366456,    3.8186914988,    2.4941377040,    2.0654132576,    11.2743036507,    0.4885945712,    1.2323531321,    3.3428750596,
    2.6349207971,    3.3237332603,    3.4475570202,    0.5592867926,    1.2188178428,    0.3150791048,    0.0702307324,    0.3232236417,    0.1040049017,    0.0264227620,
    0.1612868489,    0.1340142702,    78.2518534642,    2.3602559152,    0.2991876251,    0.6934152806,    0.1398568387,    0.0978410995,    0.1328656598,    0.1310352958,
    0.9436587132,    0.7552671635,    9.5944995847,    10.3877036544,    11.5776711456,    27.7309192117,    6.5868762559,    87.1838184948,    2.4658233389,    2.6424102728,
    7.2481869519,    0.3518108715,    0.2005383145,    28.2832467701,    0.7365306377,    0.2505507481,    0.2344343500,    0.0088990216,    0.1680652713,    108.6852188652,
    6.1130494570,    4.0588449395,    0.4280892117,    1.2476711885,    6.1469943593,    0.5583227561,    0.4600068338,    12.0686068612,    0.4699176562,    0.7924331732,
    0.7771592025,    0.5569414565,    0.2649828851,    0.9818224177,    0.8010793080,    0.6173229493,    0.4101429025,    0.3235618908,    0.7979672960,    0.1865959006,
    4.0327535824,    1.6911684416,    1.2042623317,    0.0480600881,    1528.2307995424,    1.1949687467,    0.8550067859,    0.2121562030,    1.4380616214,    3.0447727483,
    21510.0581347617,    6.1807510307
};

// Selected feature indices
constexpr int N_SELECTED_FEATURES = 502;
static const int SELECTED_FEATURES[N_SELECTED_FEATURES] = {
    0,    1,    4,    12,    13,    15,    16,    17,    24,    26,    27,    31,    55,    58,    59,    60,    66,    67,    78,    83,
    85,    86,    96,    99,    111,    122,    135,    210,    215,    217,    291,    292,    293,    294,    295,    296,    297,    299,    300,    302,
    303,    306,    307,    308,    309,    310,    311,    314,    315,    316,    317,    318,    320,    322,    326,    332,    337,    338,    342,    349,
    350,    352,    359,    367,    380,    383,    384,    392,    397,    398,    399,    413,    421,    422,    482,    487,    506,    513,    516,    518,
    520,    526,    531,    533,    548,    563,    577,    578,    579,    580,    582,    586,    588,    589,    590,    597,    602,    605,    606,    609,
    612,    614,    616,    632,    633,    636,    641,    642,    643,    644,    647,    649,    652,    656,    662,    664,    666,    670,    679,    689,
    696,    703,    704,    705,    714,    715,    718,    723,    728,    729,    730,    731,    736,    738,    739,    740,    743,    744,    745,    749,
    752,    753,    761,    763,    764,    767,    771,    772,    773,    774,    775,    778,    779,    792,    793,    798,    799,    803,    805,    806,
    808,    809,    811,    812,    816,    817,    818,    822,    824,    836,    839,    840,    841,    842,    862,    871,    873,    877,    878,    895,
    901,    905,    910,    921,    926,    932,    943,    948,    956,    962,    967,    969,    976,    980,    981,    982,    983,    985,    987,    993,
    995,    996,    1005,    1007,    1010,    1027,    1029,    1030,    1037,    1038,    1043,    1047,    1048,    1049,    1051,    1052,    1056,    1057,    1059,    1061,
    1062,    1063,    1064,    1066,    1075,    1079,    1083,    1084,    1086,    1094,    1095,    1099,    1107,    1109,    1111,    1113,    1133,    1135,    1139,    1142,
    1145,    1152,    1173,    1180,    1201,    1226,    1227,    1241,    1243,    1256,    1269,    1288,    1304,    1319,    1338,    1342,    1350,    1351,    1359,    1363,
    1367,    1388,    1389,    1390,    1391,    1392,    1393,    1394,    1395,    1396,    1397,    1398,    1399,    1400,    1401,    1402,    1403,    1404,    1405,    1406,
    1407,    1408,    1409,    1410,    1411,    1412,    1413,    1414,    1415,    1416,    1417,    1418,    1419,    1420,    1421,    1422,    1423,    1424,    1425,    1426,
    1427,    1428,    1429,    1430,    1431,    1432,    1433,    1434,    1435,    1436,    1437,    1438,    1439,    1440,    1441,    1442,    1443,    1444,    1445,    1446,
    1447,    1448,    1449,    1450,    1451,    1452,    1453,    1454,    1455,    1456,    1457,    1458,    1459,    1460,    1461,    1462,    1463,    1464,    1465,    1466,
    1467,    1468,    1469,    1470,    1471,    1472,    1473,    1474,    1475,    1476,    1477,    1478,    1479,    1480,    1481,    1482,    1483,    1484,    1491,    1497,
    1501,    1502,    1503,    1504,    1505,    1506,    1507,    1508,    1510,    1535,    1537,    1538,    1539,    1540,    1541,    1542,    1543,    1544,    1545,    1546,
    1547,    1548,    1549,    1550,    1551,    1552,    1553,    1554,    1555,    1556,    1557,    1558,    1559,    1560,    1561,    1562,    1563,    1564,    1565,    1566,
    1567,    1568,    1569,    1570,    1571,    1572,    1573,    1574,    1575,    1576,    1577,    1578,    1579,    1580,    1581,    1582,    1583,    1584,    1585,    1586,
    1587,    1588,    1589,    1590,    1591,    1593,    1594,    1616,    1629,    1638,    1691,    1696,    1699,    1714,    1730,    1789,    1808,    1818,    1820,    1834,
    1835,    1839,    1849,    1853,    1854,    1856,    1869,    1872,    1873,    1874,    1879,    1881,    1885,    1886,    1887,    1890,    1896,    1901,    1957,    1958,
    1961,    1980,    1984,    1989,    1998,    2089,    2149,    2170,    2174,    2179,    2234,    2254,    2269,    2308,    2342,    2346,    2348,    2669,    2712,    3036,
    3053,    3072,    3078,    3135,    3401,    3437,    3439,    3441,    3501,    3567,    3770,    3781,    3785,    3786,    3799,    3829,    3835,    3842,    3850,    3853,
    3859,    4041
};

// Feature order metadata
constexpr int N_CASCADE_FEATURES = 0;
constexpr int N_PHYSICS_FEATURES = 0;
// Prediction function using Treelite compiled library
// TL2cgen generates: size_t predict(union Entry* data, size_t num_row, float* result)
// Library path: /Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/v_v34_treelite.dylib
extern "C" {
    // Forward declaration of TL2cgen prediction function
    typedef struct {
        float missing_value;
        float fvalue;
    } Entry;
    
    // Function pointer type for prediction
    typedef size_t (*PredictFunc)(Entry* data, size_t num_row, float* result);
}

// Load library and get prediction function (called once at initialization)
static void* lib_handle = nullptr;
static PredictFunc predict_func = nullptr;

static bool load_treelite_library() {
    if (lib_handle != nullptr) return true;  // Already loaded
    
    const char* lib_path = "/Users/guillaume-osmo/Github/rdkit-pypi/rdkit-source/Code/GraphMol/Descriptors/physchemprop/treelite_libs_v34/v_v34_treelite.dylib";
    lib_handle = dlopen(lib_path, RTLD_LAZY);
    if (!lib_handle) {
        return false;
    }
    
    // Get prediction function
    predict_func = (PredictFunc)dlsym(lib_handle, "predict");
    if (!predict_func) {
        dlclose(lib_handle);
        lib_handle = nullptr;
        return false;
    }
    
    return true;
}

inline double predict(const double* features) {
    // Ensure library is loaded
    if (!load_treelite_library()) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Normalize features
    double normalized[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        normalized[i] = (features[i] - COL_MEANS[i]) / COL_STDS[i];
    }
    
    // Convert to TL2cgen Entry format
    Entry data[N_NORM_FEATURES];
    for (int i = 0; i < N_NORM_FEATURES; ++i) {
        data[i].missing_value = -1.0f;  // No missing values
        data[i].fvalue = static_cast<float>(normalized[i]);
    }
    
    // Call Treelite prediction
    float result[1];
    size_t num_output = predict_func(data, 1, result);
    if (num_output == 0) {
        return std::numeric_limits<double>::quiet_NaN();
    }
    
    // Denormalize target
    double pred_norm = static_cast<double>(result[0]);
    double pred = pred_norm * TARGET_SCALE + TARGET_MEAN;
    
    return pred;
}

} // namespace CascadeV
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit

// Wrapper struct for template parameter (C++ doesn't allow namespaces as template parameters)
// Must be outside the namespace to reference it
namespace RDKit {
namespace Descriptors {
namespace Osmordred {
namespace CascadeV {
struct Model {
    using Namespace = CascadeV;
};
} // namespace CascadeV
} // namespace Osmordred
} // namespace Descriptors
} // namespace RDKit
